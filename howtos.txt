How-Tos

Find if a user is in the AD group on a linux server:
1. getent group <name of the group>   eg. getent group sri
Note:  Not all CS analysts are allow on all groups.  You need to be authorized by the SM

Change linux user shell:
1. passwd <username>   	(change user password)
2. chsh -s /bin/bash <username>

Lock/deactivate user account:
1. passwd -l <username>
2. chsh -s /sbin/nologin <username>

Creating directory:
1. mkdir vcpprd--keep_until_2014_04_11						(create directory)
2. chown mtg:mtgsol vcpprd--keep_until_2014_04_11/				(change owner)
3. chmod 770 vcpprd--keep_until_2014_04_11/					(change permission)
4. cp -R d* /CUST/HNI01/retention/hnidb17/vcpprd--keep_until_2014_04_11/	(copy from one directory to another directory on va-ash-ns04)


MTG Networks:
access-list hni_out extended permit tcp 10.201.100.240 255.255.255.240 10.92.102.0 255.255.255.192 eq 8030 	(terminal network)
access-list hni_out extended permit tcp 10.202.100.240 255.255.255.240 10.92.102.0 255.255.255.192 eq 8030 	(terminal network)
access-list hni_out extended permit tcp 10.201.98.128 255.255.255.128 10.92.102.0 255.255.255.192 eq 8030 	(VPN network)
access-list hni_out extended permit tcp 10.202.98.128 255.255.255.128 10.92.102.0 255.255.255.192 eq 8030 	(VPN network)
access-list hni_out extended permit tcp 10.201.94.0 255.255.255.0 10.92.102.0 255.255.255.192 eq 8030 		(CUST VPN network)
access-list hni_out extended permit tcp 192.168.82.0 255.255.255.0 10.92.102.0 255.255.255.192 eq 8030 		(customer network)


Replacing text in vi:
:g/10.201.105.33/s//10.202.105.33/g


Look for available IP Addresses:
1. Login to a linux server as root
2. nmap -sP 10.201.103.129-142


Blocking external IPs on the ASAs:

Request - Block
64.39.96.0/20 (64.39.96.1-64.39.111.254) 
167.216.252.0/26 (167.216.252.1-167.216.252.62) 
62.210.136.128/25 (62.210.136.129-62.210.136.254) 

CA ASA01
access-list ATT_access_in line 1 deny ip 64.39.96.0 255.255.240.0 any
access-list ATT_access_in line 1 deny ip 167.246.252.0 255.255.255.192 any
access-list ATT_access_in line 1 deny ip 62.210.136.128 255.255.255.128 any
access-list TWT_access_in line 1 deny ip 64.39.96.0 255.255.240.0 any
access-list TWT_access_in line 1 deny ip 167.246.252.0 255.255.255.192 any
access-list TWT_access_in line 1 deny ip 62.210.136.128.0 255.255.255.128 any

CA ASA02
access-list TWT_access_in line 1 deny ip 64.39.96.0 255.255.240.0 any
access-list TWT_access_in line 1 deny ip 167.246.252.0 255.255.255.192 any
access-list TWT_access_in line 1 deny ip 62.210.136.128 255.255.255.128 any


VA ASA01
access-list ATT_outside_in line 1 deny ip 64.39.96.0 255.255.240.0 any
access-list ATT_outside_in line 1 deny ip 167.246.252.0 255.255.255.192 any
access-list ATT_outside_in line 1 deny ip 62.210.136.128 255.255.255.128 any
access-list CL_outside_in line 1 deny ip 64.39.96.0 255.255.240.0 any
access-list CL_outside_in line 1 deny ip 167.246.252.0 255.255.255.192 any
access-list CL_outside_in line 1 deny ip 62.210.136.128 255.255.255.128 any

VA ASA02
access-list CL_outside_in line 1 deny ip 64.39.96.0 255.255.240.0 any
access-list CL_outside_in line 1 deny ip 167.246.252.0 255.255.255.192 any
access-list CL_outside_in line 1 deny ip 62.210.136.128 255.255.255.128 any



ASA Failover Testing:
CA ASA01

peer 74.124.39.164 ATT
peer 70.166.236.246 ATT
peer 50.200.42.110 ATT

no crypto map mtg-vpn 665 set peer 74.124.39.164
no crypto map mtg-vpn 666 set peer 70.166.236.246
no crypto map mtg-vpn 667 set peer 50.200.42.110

twt - verify tunnels
sh cry ips sa peer 74.124.39.164
sh cry ips sa peer 70.166.236.246
sh cry ips sa peer 50.200.42.110

VA ASA01

peer 74.124.39.164 ATT
peer 70.166.236.246 ATT
peer 50.200.42.110 ATT

no crypto map mtg-va-att 665 set peer 74.124.39.164
no crypto map mtg-va-att 666 set peer 70.166.236.246
no crypto map mtg-va-att 667 set peer 50.200.42.110


twt - verify tunnels
sh cry ips sa peer 74.124.39.164
sh cry ips sa peer 70.166.236.246
sh cry ips sa peer 50.200.42.110






Softlink:
ln -s /u01/shared/prd/interface /u01/shared/prd//interface/infscani/PSCANI   		(you need the full path for both)



Del users:
userdel -rf <username>

Print issues:
1. echo "test" | lp -d HP2015dn
2. service cups stop
3. service cups start
4. cancel <printer name>


Locked/hung servers
1. umount /mnt/backups
2. umount /mnt/rman


Adding access for new Compellent:

CA-SNA-6509vss01:
access-list 2698 permit tcp any host 10.201.93.132 gt 1023 established
access-list 2698 permit tcp any host 10.201.93.133 gt 1023 established
access-list 2698 permit tcp any host 10.201.93.134 gt 1023 established

access-list 2699 permit tcp host 10.201.93.132 any eq www
access-list 2699 permit tcp host 10.201.93.132 any eq 22
access-list 2699 permit tcp host 10.201.93.132 any eq 443

access-list 2699 permit tcp host 10.201.93.133 any eq www
access-list 2699 permit tcp host 10.201.93.133 any eq 22
access-list 2699 permit tcp host 10.201.93.133 any eq 443

access-list 2699 permit tcp host 10.201.93.134 any eq www
access-list 2699 permit tcp host 10.201.93.134 any eq 22
access-list 2699 permit tcp host 10.201.93.134 any eq 443


ca-asa-01:
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.132 any eq www 
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.132 any eq ssh 
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.132 any eq https 

access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.133 any eq www 
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.133 any eq ssh 
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.133 any eq https

access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.134 any eq www 
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.134 any eq ssh 
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.93.134 any eq https

nat (ca-sna-custnet) 100 10.201.93.132 255.255.255.255
nat (ca-sna-custnet) 100 10.201.93.133 255.255.255.255
nat (ca-sna-custnet) 100 10.201.93.134 255.255.255.255



Account Expire:
1. chage -l <username>
2. chage <username> 			>>> change username expiration >>>


Patch Server:
1. \\10.201.99.15\u01\patch\CER		(for customer CER on patch01)
2. \\10.202.99.12\u01\patch\CER		(for customer CER on ns02)
3. Verify patch server exports 		(ca-sna-patch01)
4. cat /etc/exports | grep GTI
5. verify customer server ip exists
6. vi /etc/exports
7. service nfs reload


Sudo - from one account to another account: Apply to the local linux server
1. sudo -u appltst -i /bin/bash


Link and unlink:
Example:
# unlink /usr/lib/libXtst.so.6
# ln -s /usr/X11R6/lib/libXtst.so.6.1 /usr/lib/libXtst.so.6


Inbound SFTP Access:  Push from the Internet to client side and travels throught vpn tunnel to us

VA ASA's
access-list va-custnet-in permit ip 10.202.105.144 255.255.255.240 host 98.179.146.2
access-list vpn-nonat permit ip 10.202.105.144 255.255.255.240 host 98.179.146.2
access-list oxa-ar-tunnel permit ip 10.202.105.144 255.255.255.240 host 98.179.146.2

va fwsm1
access-list outside_in permit ip host 98.179.146.2 host 10.202.105.147

access-list oxa_out permit tcp host 98.179.146.2 host 10.202.105.147 eq 22


Account Expire:
1. chage -l cipherprd		>>> account info >>>
2. passwd -S <username>		>>> verify if account is locked "L" means it's locked>>>
3. passwd -l <username>		>>> lock user account >>>
4. passwd -u <username>         >>> unlock user account >>>


Sendmail:			
1. echo test | mail chi.vasko@mecurtytechnology.com
2. tail -f /var/log/maillog				>>> verify if the host is correct >>>
3. cat /etc/hosts					>>> verify >>>
4. cat /etc/resolv.conf					>>> verify >>>
5. cd /etc/mail/
6. cat /etc/mail/sendmail.mc
7. service sendmail restart
8. service sendmail stop
9. service sendmail start


Allow MTG client servers to access Internet destinations:
DPI:
ca-sna-fwsm01:
access-list dpi_in extended permit tcp host 10.201.105.19 host 159.53.78.18 eq 22

ca-sna-asa:
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.105.19 host 159.53.78.18 eq 22
nat (ca-sna-custnet) 100 10.201.105.19 255.255.255.255

va-ash-fwsm01:
access-list dpi_in extended permit tcp host 10.202.105.19 host 159.53.78.18 eq 22

va-ash-asa:
access-list va-custnet-in extended permit tcp host 10.202.105.19 host 159.53.78.18 eq 22
nat (va-ash-custnet) 100 10.202.105.19 255.255.255.255



Client server to server communications between VA and CA:

CA-ASA01:
access-list ca-sna-custnet_access_in extended permit ip 10.201.101.64 255.255.255.240 10.202.101.64 255.255.255.240 
access-list vpn-nonat extended permit ip 10.201.101.64 255.255.255.240 10.202.101.64 255.255.255.240 
access-list mtg_ca_to_att_vpn10 extended permit ip 10.201.101.64 255.255.255.240 10.202.101.64 255.255.255.240 

ca-sna-fwsm1:
access-list outside_in extended permit ip 10.202.101.64 255.255.255.240 10.201.101.64 255.255.255.240 
access-list acf_out extended permit ip 10.202.101.64 255.255.255.240 10.201.101.64 255.255.255.240 
access-list acf_in extended permit ip 10.201.101.64 255.255.255.240 10.202.101.64 255.255.255.240


VA-ASA01:
access-list vpn-nonat extended permit ip 10.202.101.64 255.255.255.240 10.201.101.64 255.255.255.240 
access-list va-custnet-in extended permit ip 10.202.101.64 255.255.255.240 10.201.101.64 255.255.255.240
access-list mtg_att_to_ca_vpn10 extended permit ip 10.202.101.64 255.255.255.240 10.201.101.64 255.255.255.240 

VA-FWSM01:
access-list outside_in extended permit ip 10.201.101.64 255.255.255.240 10.202.101.64 255.255.255.240 
access-list acf_out extended permit ip 10.201.101.64 255.255.255.240 10.202.101.64 255.255.255.240 
access-list acf_in extended permit ip 10.202.101.64 255.255.255.240 10.201.101.64 255.255.255.240 


BTSuns
1. BTSAPP01
2. BTSDB01
3. BTSHYP01
4. BTSWIN01


Bypassing the proxy:
va-ash-fwsm1:
access-list pom_in extended permit tcp host 10.202.103.133 any eq http
access-list pom_in extended permit tcp host 10.202.103.133 any eq https

va-ash-asa
access-list va-custnet-in extended permit tcp host 10.202.103.133 any eq 80
access-list va-custnet-in extended permit tcp host 10.202.103.133 any eq 443
nat (va-ash-custnet) 100 10.202.103.133 255.255.255.255
route CL-outside 23.43.182.0 255.255.255.0 72.165.204.1


Sendmail:
1. ps -ef | grep sendmail
2. service sendmail start
3. ps -ef | grep postfix


Postfix:
cd /var/spool/postfix/pid/
 1024  11/19/13 16:40:43 ls
 1025  11/19/13 16:40:44 ls -la
 1026  11/19/13 16:40:55 rm master.pid 
 1027  11/19/13 16:41:07               service postfix status
 1028  11/19/13 16:41:12               service postfix start
 1029  11/19/13 16:41:19 postqueue -p
 1030  11/19/13 16:41:24 postqueue -f
 1031  11/19/13 16:41:29 postqueue -q
 1032  11/19/13 16:41:34 postqueue -p
 1033  11/19/13 16:42:31 ps -ef | grep postfix
 1034  11/19/13 16:49:12 service postfix status

[root@va-ash-ns04 pid]# 



Running scripts:
1. lsattr /etc/sysctl.conf (eg. ----i-------- /etc/sysctl.conf)
2. chattr +i /etc/sysctl.conf
3. Run script (accept all defaults)
4. Send out to users


NFS:
1. uptime 			>> to see the load
2. cd /CUST/AMI01    		>>> to test if you can get into the NFS
3. cd /mnt/backups		>>> see if you can mount backups
4. cat /etc/auto.nfs
5. service autofs reload	>>> reload NFS (auto.nfs file)

Move to NFS to another VS Server
1. cp auto.nfs autobkdate.nfs	>>>
2. vi /etc/auto.nfs 		>>> rearrange vs server list under "backup"
3. service autofs reload

REMOUNT FSTAB:
1. df 				>>> view all mounts >>>
2. cat /etc/fstab		>>> make sure mount(s) are not commented >>>
3. mount -a 			>>> remounts all mounts in fstab  >>>
4. service autofs restart	>>> restarts autofs >>>
5. du -sh *			>>> directory sizes >>>
6. du -sh /var * 		>>> all directories and subdirectories under /var >>>
7. du -sh * | grep G		>>> look for all gigabit size directories/files >>>


Check for backup is running on the linux server

[root@amidb08 backups]# ps -ef | grep zip 
root      2959  1518  0 01:01 ?        00:00:00 sudo -H -u oraascd1 /usr/local/mtg/control/MTG_RunCommand.sh /usr/local/mtg/control/MTG_TarDirectory.sh ascd1data /u01/ascd1 /mnt/backups/hot/ascd1/db/hot_backup.amidb08.u01.ascd1.ascd1data.XXXDATEXXX /bin/gzip
oraascd1  2984  2959  0 01:01 ?        00:00:00 /bin/ksh /usr/local/mtg/control/MTG_RunCommand.sh /usr/local/mtg/control/MTG_TarDirectory.sh ascd1data /u01/ascd1 /mnt/backups/hot/ascd1/db/hot_backup.amidb08.u01.ascd1.ascd1data.XXXDATEXXX /bin/gzip
oraascd1  3113  2984  0 01:01 ?        00:00:00 /bin/ksh /usr/local/mtg/control/MTG_TarDirectory.sh ascd1data /u01/ascd1 /mnt/backups/hot/ascd1/db/hot_backup.amidb08.u01.ascd1.ascd1data.XXXDATEXXX /bin/gzip
oraascd1  3341  3113  0 01:01 ?        00:04:09 tar -cvf /mnt/backups/hot/ascd1/db/hot_backup.amidb08.u01.ascd1.ascd1data.20131117_010142.tar.gzip --use-compress-program /bin/gzip ascd1data
oraascd1  3346  3341 10 01:01 ?        01:40:39 /bin/gzip
oraasc   19379 18293  0 17:06 ?        00:00:00 gunzip -f /u01/asc/ascarch/asc_1_296793_755796250.arc.gz

Look for anything that says MTG_Command and/or "hot" "snapshot"


FORWARD PROXY SETUP:
Log in to both SSL servers (CA-SNA-SSL01 and CA-SNA-SSL02 (10.201.215.226 or 10.202.215.226 - va-ash-ssl02))
1. type vp (Edit /usr/local/apache2/conf/httpd-proxy.conf)
2. search for the destination ip address or url  (make sure the destination doesn't already exisst)
3. copy an existing section and paste

	<ProxyMatch "66.185.180.11">
	Order deny,allow
	Deny from all
	#HNI - permanent
	Allow from 10.92.102.9
	Allow from 10.92.102.14
	Allow from 10.92.102.13
	Allow from 10.92.102.2
	</ProxyMatch>


3. Modify new section
	1. add desintation in the pararethesis area
	2. add internal source ip addresses
4. save 
5. type sp (restart ssl)
6. test curl -x 10.201.215.226:8080 <destination ip>     (for CA)
7. test curl -x 10.202.215.226:8080 <destination ip>     (for VA)


The above file should contain the IP address of the server you wish to allow access to the forward proxy.

Stop and start the proxy service on both servers by running
service httpd-proxy stop
service httpd-proxy start

Edit the ACL for the customer to allow for the proxy connection.
(Example for SNO)

   112 = outbound	|	SSL Server IP	| SNO Range		     | port 1023
access-list 112 permit tcp host 10.201.215.226 10.201.101.112 0.0.0.15 gt 1023 est
access-list 112 permit tcp host 10.201.215.210 10.201.101.112 0.0.0.15 gt 1023 est

   113 = inbound	|	SNO Range		| SSL Server IP     | port 8080
access-list 113 permit tcp 10.201.101.112 0.0.0.15 host 10.201.215.210 eq 8080
access-list 113 permit tcp 10.201.101.112 0.0.0.15 host 10.201.215.226 eq 8080

Test by logging into the server via VNC and starting a web browser. Configure the web browser to use an http proxy over port 8080 via the SSL servers. Verify that you can access a web site.



BB server:
1. Add static routes to wAN on servers
2. Modify ACL (in/out) on ports (RTR01)
3. Test ping from servers
4. client host
	su - bb
        cat etc/fping-hosts
	vi etc/fping-hosts
5. su -bb
	vi bb-hosts
	vi etc/bb-hosts


ADDing new BB entries:
1. ps -ef | grep fping 
2. cd /usr/local/bbc/bin
3. ll
4. chown root fping		>> make root the owner of fping <<
5. chmod 4555 fping 		>> set sticky bit for fping <<
6. su - bb
7. vi etc/bb-bbexttab
8. localhost :  : bb-memory.sh bb-iostat.sh bb-last.sh bb-top.pl fping.sh     >> add fping to the end <<
--------------------------------------------------------------------------------------------------------------
9. vi etc/fping-hosts
10. 0.0.0.0 tur-hq-va-conn # list 192.168.137.1,192.168.137.2 best    >> add ips and name the bb entry >>
11. ./runbb.sh stop
12. tail BBOUT			>> verify no errors >>
13. ./runbb.sh			restarts BB client on application server
----------------------------------------------------------------------------------------------------------------
BB Server:
14. su - bb
15. vi etc/bb-hosts
15.5 bbrm <server name>
16. search for client 
17. 184.23.147.62 tur-hq-va-conn #		>> name has to match the other and you need # >>
18. Test ping from BB server 			>> if not able to ping add "no conn" after the # >>


BB Config Example:
hni-hq-va-conn
hni-hq-va-RTR
hni-hq-va-mpls-DS3-LAN
hni-hq-va-mpls-TU464-LAN
hni-hq-va-mpls-TU464-WAN
hni-hq-va-mpls-TU465-LAN
hni-hq-va-mpls-TU465-WAN


10.92.102.30 hni-hq-va-RTR # noconn
192.168.32.214 hni-hq-va-mpls-DS3-LAN # noconn
192.168.33.213 hni-hq-va-mpls-TU464-LAN # noconn
192.168.33.214 hni-hq-va-mpls-TU464-WAN # noconn
192.168.34.213 hni-hq-va-mpls-TU465-LAN # noconn
192.168.34.214 hni-hq-va-mpls-TU465-WAN # noconn



interface Port-channel164

no ip access-group 2465 in
no ip access-group 2464 out

ip access-group 2465 in
ip access-group 2464 out


/sbin/route add -net 192.168.32.212 netmask 255.255.255.252 gw 10.92.102.30
/sbin/route add -net 192.168.33.212 netmask 255.255.255.252 gw 10.92.102.30
/sbin/route add -net 192.168.34.212 netmask 255.255.255.252 gw 10.92.102.30





Restart Mount
ps -ef | grep nfs ( to see if it is up)
service nfs start


Printer Tar:
scp -P 24 printer.tgz f5ndb11:/root

TAR:
 1001  10/17/13 12:34:47 lpstat -t | more 
 1002  10/17/13 12:35:35 cd /etc
 1003  10/17/13 12:35:48 service cups stop
 1004  10/17/13 12:36:16 tar -czvf printer.tgz cups
 1005  10/17/13 12:36:23 service cups start
 1006  10/17/13 12:37:05 scp -P 24 printer.tgz f5ndb11:/root
 1007  10/17/13 12:37:35 scp -P 24 printer.tgz f5ndb12:/root

UNTAR:
1002  10/17/13 12:38:47 cd /etc
 1003  10/17/13 12:38:52 service cups stop
 1004  10/17/13 12:39:19 tar -xzvf /root/printer.tgz 
 1005  10/17/13 12:39:28 service cups start
 1006  10/17/13 12:39:40 lpstat -t


/sbin/route add -net 192.168.100.0 netmask 255.255.255.0 gw 10.201.104.174

/sbin/route delete -net 192.168.100.0 netmask 255.255.255.0 gw 10.201.104.174

These are the steps I am doing: 
cp /etc/rc.local /etc/rc.local.20131013.cv 

vi /etc/rc.local
#/sbin/route add -net 192.168.100.0 netmask 255.255.255.0 gw 10.201.104.174 

Then at the cmd promt:
/sbin/route del -net 192.168.100.0 netmask 255.255.255.0 gw 10.201.104.174

lpstat -t


VS - Reboots
[root@btsvs11 ~]# xm top		
[root@btsvs11 ~]# xm list
Name                                        ID   Mem VCPUs      State   Time(s)
1170_btsapp11                                2 16000     8     -b---- 31125300.9
1172_btsdb11                                 1 16000     8     -b---- 26250464.1
1192_btswin11                                4 15000     8     r----- 25281793.2
Domain-0                                     0  1024    32     r----- 3479955.5

[root@btsvs11 ~]# xm con 5		console into the vm
[root@btsvs11 ~]# xm shut 5		shuts down vm

[root@btsvs11 ~]# xm destroy 5		force shut down vm (like pulling the plug)
				or

[root@btsvs11 ~]# xm destroy <vm instance> 


[root@btsvs11 ~]# xm create /OVS/running_pool/111170_btsapp11/ 1172_btsdb11/  1174_btshyp11/ 1192_btswin11/ 
[root@btsvs11 ~]# xm create /OVS/running_pool/111170_btsapp11/ 1172_btsdb11/  1174_btshyp11/ 1192_btswin11/ 
[root@btsvs11 ~]# xm create -c /OVS/running_pool/1174_btshyp11/vm.cfg

[root@btsvs11 ~]# -c			displays vm boot up process after destroy or shutdown

cat /OVS/running_pool/1530_ymeapp01/vm.cfg	(find password for vnc - vm configuration file)


Client Network to Single server FWSM Example:
access-list sri_out permit tcp host 192.168.204.1 host 10.202.103.102 eq 7021
access-list sri_out permit tcp host 192.168.204.1 host 10.202.103.102 eq 9724

access-list sri_out permit tcp host 192.168.205.1 host 10.202.103.102 eq 7021
access-list sri_out permit tcp host 192.168.205.1 host 10.202.103.102 eq 9724

access-list sri_out permit tcp host 192.168.207.1 host 10.202.103.102 eq 7021
access-list sri_out permit tcp host 192.168.207.1 host 10.202.103.102 eq 9724

access-list sri_out permit tcp host 192.168.209.1 host 10.202.103.102 eq 7021
access-list sri_out permit tcp host 192.168.209.1 host 10.202.103.102 eq 9724

access-list sri_out permit tcp 10.201.100.240 255.255.255.240 10.202.103.96 255.255.255.240 eq 7021
access-list sri_out permit tcp 10.201.100.240 255.255.255.240 10.202.103.96 255.255.255.240 eq 9724
access-list sri_out permit tcp 10.202.100.240 255.255.255.240 10.202.103.96 255.255.255.240 eq 7021
access-list sri_out permit tcp 10.202.100.240 255.255.255.240 10.202.103.96 255.255.255.240 eq 9724

access-list sri_out permit tcp 10.201.98.128 255.255.255.128 10.202.103.96 255.255.255.240 eq 7021
access-list sri_out permit tcp 10.201.98.128 255.255.255.128 10.202.103.96 255.255.255.240 eq 9724
access-list sri_out permit tcp 10.202.98.128 255.255.255.128 10.202.103.96 255.255.255.240 eq 7021
access-list sri_out permit tcp 10.202.98.128 255.255.255.128 10.202.103.96 255.255.255.240 eq 9724

access-list sri_out permit tcp 10.201.94.0 255.255.255.0 10.202.103.96 255.255.255.240 eq 7021
access-list sri_out permit tcp 10.201.94.0 255.255.255.0 10.202.103.96 255.255.255.240 eq 9724




[root@pomapp03 ~]# chage DI_Emps-Assets_CareOne
Changing the aging information for DI_Emps-Assets_CareOne
Enter the new value, or press ENTER for the default

        Minimum Password Age [0]: 
        Maximum Password Age [90]: 0
        Last Password Change (YYYY-MM-DD) [2013-06-11]: 
        Password Expiration Warning [7]: 0
        Password Inactive [-1]: 
        Account Expiration Date (YYYY-MM-DD) [1969-12-31]: 
[root@pomapp03 ~]# chage -l DI_Emps-Assets_CareOne
Last password change                                    : Jun 11, 2013
Password expires                                        : Jun 11, 2013
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 0
Number of days of warning before password expires       : 0
[root@pomapp03 ~]# 



ASA How-tos:
sh run cry | grep epe
sh run cry | grep 110
sh cryp ip sa peer 204.238.72.2


sh run | grep mtg-vpn
sh run | grep epe-tunnel

sh run cryp | grep pom
sh run access-l | grep pom-hq-tunnel



Adding Linux Printer: ONLY ON APP SERVERS
1. Verify VNC is running (ps -ef | grep vnc)
2. Local Port Forwarding:
	a. name = vnc
	b. local port = 5974
	c. remote port = 5901
3. Change port for remote until you can connect
4. Add/change/modify printer (don't forget "Apply")
5. Verify with lpstat -t | grep <printer name>

Note: you may need to change "vncpasswd" by typing vncpasswd

Testing Printer:
1. lpstat -t | grep ixca-ship-lp2844z (verified printer exists)
	device for ixca-ship-lp2844z: socket://10.200.4.39:9100
	ixca-ship-lp2844z accepting requests since Mon 07 Oct 2013 01:53:07 PM PDT
	printer ixca-ship-lp2844z is idle.  enabled since Mon 07 Oct 2013 01:53:07 PM PDT

2. Testing to 10.200.4.39:9100 from linux server

3. lpstat -o - view print queue
	[root@ixaapp01 ~]# echo test | lp -d ixca-ship-lp2844z
	request id is ixca-ship-lp2844z-177886 (1 file(s))
	[root@ixaapp01 ~]# lpstat -o 

4. vncserver :1

5. vncpasswd 


6. lpstat -a 
Anue-North accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Anue-SalesOps accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Anue-Shipping accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld2-Flr1-East-8950 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld2-Flr1-North-4345 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld2-Flr2-Central-3005 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld2-Flr2-Central-8950 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld2-Flr2-South-8950 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld2-Flr2-West-4345 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld2-Flr2-West-8950 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld2-Flr2-West-9500 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
bld2west-hp3015 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
Bld3-A-North-4345 accepting requests since Mon 07 Oct 2013 01:57:32 PM PDT
BLD3-B-WEST-8950 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
ixca-ship-lp2844z accepting requests since Mon 07 Oct 2013 01:53:07 PM PDT
USAU-Bld1-Flr1-Central-C2030 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
USAU-Bld1-Flr1-Shipping accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
USCA-Bld2-Flr1-North-4345 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
USCA-Bld2-Flr2-Central-3005 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
USCA-Bld2-Flr2-West-4345 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
USCA-Bld2-Flr2-West-9050 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
USCA-Bld2-Flr2-West-9500 accepting requests since Mon 07 Oct 2013 01:08:58 PM PDT
USCA-Bld3-B-North-3015 accepting requests since Mon 07 Oct 2013 01:53:08 PM PDT
USCA-Bld3-B-West-3015 accepting requests since Mon 07 Oct 2013 01:37:35 PM PDT
[root@ixaapp01 ~]# 





Add User to Linux:
useradd -c "`hostname -s` Vinod Dosapati" -u 1035 -g 100 vDosapati (group 100 = normal users)

useradd -c "`hostname -s` Ron Brown" -u 2566 -g 100 brownr
passwd brownr

53&g4lM7

Lock user account in Linux:
usermod -L <username>


FTP User:
cat /etc/vsftpd/vsftpd.chroot_list
grep DI_Emps-Assets_CareOne /etc/passwd
vi user_list vsftpd.chroot_list
service vsftpd restart
cat /etc/group
vi group
useradd -c "`hostname -s` PI_Emps-Assets_CareOne FTP chroot" -u 5269 -g 2867 -s /bin/true -d /u01/FTP/Production/Inbound/Emps-Assets/CareOne/Process PI_Emps-Assets_CareOne

PI_Emps-Assets_CareOne:x:5269:2867:pomapp03 PI_Emps-Assets_CareOne:/u01/FTP/Production/Inbound/Emps-Assets/CareOne/Process:/bin/true




SFTP:
cat /etc/security/chroot.conf



group:

ipsec-office/q^3AYO9=uI;

ipsec-remote/XNH4c7yD9FO

mtg-admin/*Vt!dQj:OKl



Reset CA to VA tunnel
1.

ATT CA:

no crypto map mtg-vpn 11 set peer 199.108.193.5 
no crypto map mtg-vpn 11 match address mtg_ca_to_att_vpn6


ATT-VA:

no crypto map mtg-va-att 10 set peer 12.130.203.12 
no crypto map mtg-va-att 10 match address mtg_att_to_ca_vpn6



2.  Add new match address:


ATT-VA

crypto map mtg-va-att 10 match address mtg_att_to_ca_vpn7
crypto map mtg-va-att 10 set peer 12.130.203.12



ATT-CA:


crypto map mtg-vpn 11 match address mtg_ca_to_att_vpn7
crypto map mtg-vpn 11 set peer 199.108.193.5


New Cust ASA
CA ASA
access-list ca-sna-custnet_access_in extended permit tcp 10.201.100.192 255.255.255.192 host XXX eq ssh 
access-list ATT_access_in extended permit udp host XXX host 12.130.200.23 eq tftp
access-list ATT_access_in extended permit udp host XXX host 12.130.200.23 eq syslog


Savvis ASA
access-list acl-out extended permit icmp host XXX any echo-reply


1) Dial-In to the Toll-Free#........…… 1-888-887-0127
2) Enter your Conference Bridge#…. 669004
3) Enter your Moderator PIN………… 6551


Network Card not recognized after clone

rm -f /etc/udev/rules.d/70-persistent-net.rules
reboot


PPI Router
pass: MTG321%*
ena: _@gBdaKD

telnet from ca-sna-6509-rtr01
telnet 192.168.195.26 /vrf PPI /source-interface po216

Wireless
m$t$g@caWlan  / M$T$G@wlan890


HTTP Redirect
RAM,SPC,SDT

https://apps.sdta.biz/  to https://sdtapp01.sdta.biz:8000 http://apps.sdta.biz/  to https://sdtapp01.sdta.biz:8000
https://apps.sdta.biz/discoverer/viewer  to  https://apps.sdta.biz:4444/discoverer/viewer 
https://apps.sdta.biz/discoverer/plus    to   https://apps.sdta.biz:4444/discoverer/plus

/etc/http/conf/httpd.conf

<VirtualHost 10.201.96.243:80>
    ServerAdmin sdt.ITinfo@mtgalert.com
    DocumentRoot /var/www/html
    ServerName apps.sdta.biz
RewriteEngine On
RewriteLog "logs/apps.sdta.biz-rewrite.log"
RewriteRule ^/discoverer/(.*)$ https://apps.sdta.biz:4444/discoverer/$1 [R]
RewriteRule ^/(.*)$ https://apps.sdta.biz:8000/$1 [R]
    ErrorLog logs/apps.sdta.biz-error_log
    CustomLog logs/apps.sdta.biz-access_log common
</VirtualHost>


/etc/http/conf.d/ssl.conf

<VirtualHost>
RewriteEngine On
RewriteLog "logs/apps.sdta.biz-rewrite.log"
RewriteRule ^/discoverer/(.*)$ https://apps.sdta.biz:4444/discoverer/$1 [R]
RewriteRule ^/(.*)$ https://apps.sdta.biz:8000/$1 [R]
    ErrorLog logs/apps.sdta.biz-error_log
    CustomLog logs/apps.sdta.biz-access_log common


#   Per-Server Logging:
#   The home of a custom SSL log file. Use this when you want a
#   compact non-error SSL logfile on a virtual host basis.
CustomLog logs/ssl_request_log \
          "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"

</VirtualHost>


Example #2

/etc/httpd/conf/http.conf:

<VirtualHost 10.201.96.163:80>
    ServerAdmin mrv.ITinfo@mtgalert.com
    DocumentRoot /var/www/html
    ServerName mrvapp11.int.mrv.com
RewriteEngine On
RewriteLog "logs/mrvapp11.int.mrv.com-rewrite.log"
RewriteRule ^/(.*)$ https://erptst.int.mrv.com:8004/$1 [R]
    ErrorLog logs/erptst.int.mrv.com-error_log
    CustomLog logs/erptst.int.mrv.com-access_log common
</VirtualHost>



/etc/httpd/conf.d/ssl.conf

RewriteEngine On
RewriteLog "logs/erptst.int.mrv.com-rewrite.log"
RewriteRule ^/(.*)$ https://erptst.int.mrv.com:8004/$1 [R]
    ErrorLog logs/erptst.int.mrv.com-error_log
    CustomLog logs/erptst.int.mrv.com-access_log common

#   Per-Server Logging:
#   The home of a custom SSL log file. Use this when you want a
#   compact non-error SSL logfile on a virtual host basis.
CustomLog logs/ssl_request_log \
          "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
</VirtualHost>

Make sure to point to the certs/key files in the ssl.conf file




New Office:
ASA: 192.168.190.1
DHCP pool: 192.168.190.160-175
ASA Logon: in keepass

AP: 192.168.190.6
SSID: m$t$g@caWlan2
Key (WPA2-Personal): Sh@R3DwpA2
Logon - root/pu


Notify Shift Change
Log into ca-sna-nfy01

Su - notify

/home/notify/tools/onduty_analyst_switch/AssignWeekendOnDutyAnalyst.IT.sh 'Devon Ainsworth'
/home/notify/tools/onduty_analyst_switch/AssignWeekendOnDutyAnalyst.IT.sh 'Steve Choo'
/home/notify/tools/onduty_analyst_switch/AssignWeekendOnDutyAnalyst.IT.sh 'John Liberty'

/home/notify/tools/onduty_analyst_switch/AssignCoverageOnDutyAnalyst.IT.sh 'Steve Choo' 

cd to dir
tar -czvf - . > /dir/to/backup/file.yymmdd.sc.tgz 

IP Address assignment STANDARDS for new customers

Network
1st IP is GW
2nd Ip is Stand-by Gateway

Next App servers
Then DB servers
Then HYP and DEM servers
Then Win servers

3rd to last is VS
2nd to last is VS
Lat useable IP is MPLS
Last Ip is broadcast


Find out which processes are using swap:

run top, then capital O, then p, enter


Multiple edit - search and replace in multiple files

grep -lr -e '10.202.215' * | xargs sed -i 's/10.202.215/10.202.216/g'


For existing customers, we need to migrate from VSS

Network
1st IP is GW

Nest App servers
Then DB servers
Then HYP and DEM servers
Then Win servers

3rd to last is VS
2nd to last is standby GW
Lat useable IP is MPLS
Last Ip is broadcast


Issue was resolved by doing a shut/no shut on port channels 60, 62, 63 and 64 in the vss.  

snmp-server host outside 12.130.200.23 community mtgmsp
snmp-server host outside 174.47.15.23 community mtgmsp 
snmp-server location IEI Gainsville, FL MTG Asset Tag #2264
snmp-server contact MTG IT 
snmp-server community mtgmsp 
snmp-server enable traps snmp authentication linkup linkdown coldstart

snmp-server host outside 12.130.200.23 community mtgmsp udp-port 163
snmp-server listen-port 163


Netbackup cleanup scripts

/usr/openv/netbackup/bin


Cisco Clients can be downloaded from:

64 bit:

https://demo.mercurytechnology.com/vpnclientx64.exe

32 bit:

https://demo.mercurytechnology.com/vpnclient.exe



IPS 

Unblock attacker
ca-sna-asa01# session 1
login: cisco
password: puVU password <enter>
ca-sna-ips02# sh statistics denied-attackers 
Statistics for Virtual Sensor vs0
   Denied Attackers and hit count for each.
      10.201.215.210 = 6963
      10.201.215.226 = 9115
   Denied Attackers with percent denied and hit count for each.
         Attacker Address   Victim Address   Port   Protocol   Requested Percentage   Actual Percentage   Hit Count   Reputation Action   
         10.201.215.210                                        100                    100                 6963        false               
         10.201.215.226      

ca-sna-ips02# clear denied-attackers ip-adddress 10.201.215.210
verify




CA Public SFTP server:

public IP: 12.130.200.82   (secureftp.mercurytechnology.com)
user: mtgftp
passwd: kn-)P<NE^zrQI6R


ftp://vsftpd.beasts.org/users/cevans/untar/vsftpd-2.3.4/EXAMPLE/VIRTUAL_USERS_2/README

ftp://vsftpd.beasts.org/users/cevans/untar/vsftpd-2.3.4/EXAMPLE/VIRTUAL_HOSTS/README

va-ash-vss01#sh etherchannel 3 detail

[root@ieidb02 ~]# who -b
         system boot  2011-12-29 09:15
[root@ieidb02 ~]# last reboot | less
reboot   system boot  2.6.32-100.28.17 Thu Dec 29 09:15         (1+06:47)   
[root@ieidb02 ~]# last -x|grep shutdown|head -1
[root@ieidb02 ~]# last -x|grep reboot|head -1


FTP via Proxy
export http_proxy=10.202.215.226:8080
lftp anonymous@ftp.oracle.com




32bit LImitations
OEL/RHEL5 x32 only supports 16GB RAM

OEL5 XEN only reliably support 8GB RAM

OLE UEK supposedly supports more than 16GB RAM but will not work on a PVM (poor IO in HVM mode) - now it works if you label the partitions see how-to in this doc


Steps i did to help Raju:

1. install MTG current gcc wrapper in /usr/local/bin
2.  install two RPm packages:
	openmotif21-2.1.30-11.EL5.i386.rpm
	xorg-x11-libs-compat-6.8.2-1.EL.33.0.1.i386.rpm
3. link libXtst to /usr/X11R6/lib
 	cd /usr/lib
  	rm /usr/lib/libXtst.so.6 
  	ln -s /usr/X11R6/lib/libXtst.so.6.1  /usr/lib/libXtst.so.6


chmod 666 /etc/oratab
chmod 666 /etc/oraInst.loc
chmod 777 /etc/oraInventory

chmod 777 /etc/oraInventory/;

cd /etc/oraInventory/;

pwd

find . -type d -exec chmod 777 {} \;

find . -type f -exec chmod 666 {} \;



sendmail stuff:

clear queue:
rm -f /var/spool/mqueue/*
or
find /var/spool/mqueue -name "*fn*" -delete
or
sendmail -v -q


sendmail.mc file:
LOCAL_DOMAIN(`elidb01.elance.com')dnl
dnl #
dnl # The following example makes mail from this host and any additional
dnl # specified domains appear to be sent from mydomain.com
dnl #
MASQUERADE_AS(`elance.com')dnl
dnl #
dnl # masquerade not just the headers, but the envelope as well
dnl #
FEATURE(masquerade_envelope)dnl
dnl #
dnl # masquerade not just @mydomainalias.com, but @*.mydomainalias.com as well
dnl #
FEATURE(masquerade_entire_domain)dnl
dnl #
dnl MASQUERADE_DOMAIN(localhost)dnl
dnl MASQUERADE_DOMAIN(localhost.localdomain)dnl
dnl MASQUERADE_DOMAIN(omd.hitachiomd.com)dnl
dnl MASQUERADE_DOMAIN(mydomainlan)dnl
FEATURE(`allmasquerade')dnl
FEATURE(`always_add_domain')dnl
MAILER(smtp)dnl
MAILER(procmail)dnl
dnl define(`LOCAL_RELAY', `mail.$m')
define(`SMART_HOST', `smtp1.mtgalert.com')
dnl define(`MAIL_HUB', `mail.$m')
LOCAL_USER(`root')


ntpq -p

free -g

net ads info

/bin/tar -czvf /mnt/backups/OS/OVS.tgz --exclude System.img /OVS/*  1>/dev/null

tar -cvzf /mnt/backup/ovs.tar *

10.202.101.227 is now 10.202.99.12

10.202.101.230 is now 10.202.99.9 (smb.conf and krb5.conf)

10.201.101.2 is 10.201.99.2

cat /dev/null > file
cp /dev/null file


scsi_id -g -u -s /block/sdg >> /etc/multipath.conf
then rearrange

echo "test"|mail steve.choo@mercurytechnology.com;
echo "test"|mail steve.choo@mtgsupport.com;
echo "test"|mail steve.choo@mtgalert.com;
echo "test"|mail stevechoo509@gmail.com;
echo "test"|mail root

cd /etc;
vi passwd shadow fstab hosts sysctl.conf sysconfig/network mail/sendmail.mc mail/sendmail.cf mail/mailertable sysconfig/network-scripts/ifcfg-bond0 resolv.conf pam.d/system-auth samba/smb.conf krb5.conf aliases ntp.conf issue issue.net motd ssh/sshd_config ssh/sshd_config.mtg login.defs rc.local snmp/snmpd.conf security/limits.conf /usr/local/bbc/etc/bb-hosts /usr/local/bbc/etc/bb-bbexttab /usr/local/bbc/etc/fping-hosts;visudo;crontab -e


change domain name
cd /etc;
vi hosts sysctl.conf sysconfig/network mail/sendmail.mc mail/sendmail.cf resolv.conf 
edit the host files on the ts servers


dkms build -m megaraid_sas -v v00.00.04.29 -k 2.6.9-101.ELhugemem

mkinitrd:
mv the initrd of the kernel you want to update to .bak, then run this
mkinitrd -v --omit-scsi-modules --with=xennet --with=xenblk --preload=xenblk /boot/initrd-2.6.18-194.11.4.0.1.el5xenpv.img 2.6.18-194.11.4.0.1.el5xen



VM BUilds Misc. after install

mkdir /mnt/tmp/var and /mnt/tmp/root
mount VM root and var on above

cd /mnt/tmp/root
restore -rf /mnt/backup/XXX/root.0.bkup
rm restoresymtable

cd /mnt/tmp/var
restore -rf /mnt/backup/XXX/var.0.bkup
rm restoresymtable

cd /mnt/tmp/root/etc
vi passwd shadow group fstab hosts sysctl.conf sysconfig/network mail/sendmail.mc mail/sendmail.cf mail/mailertable sysconfig/network-scripts/ifcfg-bond0 sysconfig/network-scripts/ifcfg-eth* resolv.conf pam.d/system-auth samba/smb.conf krb5.conf aliases ntp.conf issue issue.net motd ssh/sshd_config ssh/sshd_config.mtg login.defs rc.local snmp/snmpd.conf security/limits.conf 

cd /mnt/tmp/root/home
rm -rf *

cd /mnt/tmp/root/usr/local/
chown -R bb.bb bbc
vi bbc/etc/bb-hosts bbc/etc/bb-bbexttab

cd /mnt/tmp/var/spool/cron
remove all crons but root

cd /mnt/tmp/var/spool/mqueue
rm *

cd  /mnt/tmp/var/log
rm -rf boot.log* anaconda.* cron* maillog* messages* up2date* secure* spooler* Xorg.0.log* samba/* cups/*

service ovs-agent configure - to change the agent pwd (use 0 instead of special char e.g. Sse30ppi instead of Sse3=ppi)

go to VM manager. select VM, storage and delete 1GB system.img file




Here is a command I have been using to show processes that is causing the high load. 


top -b -n 1 | awk '{if (NR <=7) print; else if ($8 == "D") {print; count++} } END {print "Total status D: "count}'



umount -l /mnt/backups /mnt/failover /mnt/retention /mnt/rman;mount -a

fuser -u /u01

cd /etc; tar -czvf /mnt/backups/etc.tar mail/sendmail.mc mail/sendmail.cf mail/mailertable sysconfig/network-scripts/ifcfg-bond0 resolv.conf samba/smb.conf krb5.conf aliases ntp.conf issue issue.net motd ssh/sshd_config ssh/sshd_config.mtg ssh/sshd_config.sol init.d/sshd login.defs rc.local snmp/snmpd.conf nsswitch.conf pam.d/system-auth

Default User and group accounts

Groups

bb
mtgsol
dbaprd
dbagld
dbatst
dbavis
dbadev
dbauat
dbacrp1
dbacrp2
dbacrp3
dbaobid
dbaobd
dbaodev

Users

bb
mtg
applprd
applgld
appltst
applvis
appldev
appluat
applcrp1
applcrp2
applcrp3
obiadev
infadev
dacdev
oraprd
oragld
oratst
oravis
oradev
orauat
oracrp1
oracrp2
oracrp3
obidbdev

groupadd -g5700 bb;
groupadd -g5701 mtgsol;
groupadd -g5702 dbaprd;
groupadd -g5703 dbagld;
groupadd -g5704 dbatst;
groupadd -g5705 dbavis;
groupadd -g5706 dbadev;
groupadd -g5707 dbauat;
groupadd -g5708 dbacrp1;
groupadd -g5709 dbacrp2;
groupadd -g5710 dbacrp3;
groupadd -g5711 dbaobid;
groupadd -g5712 dbaobd;
groupadd -g5713 dbaodev

useradd -c "`hostname -s` bb" -u5700 	     -g5700 bb;
useradd -c "`hostname -s` mtg" -u5701        -g5701 mtg;
useradd -c "`hostname -s` applprd" -u5702  -G5701  -g5702 applprd;
useradd -c "`hostname -s` applgld" -u5703  -G5701   -g5703 applgld;
useradd -c "`hostname -s` appltst" -u5704   -G5701 -g5704 appltst;
useradd -c "`hostname -s` applvis" -u5705  -G5701   -g5705 applvis;
useradd -c "`hostname -s` appldev" -u5706  -G5701  -g5706 appldev;
useradd -c "`hostname -s` appluat" -u5707  -G5701   -g5707 appluat;
useradd -c "`hostname -s` applcrp1" -u5708 -G5701   -g5708 applcrp1;
useradd -c "`hostname -s` applcrp2" -u5709 -G5701    -g5709 applcrp2;
useradd -c "`hostname -s` applcrp3" -u5710  -G5701  -g5710 applcrp3;
useradd -c "`hostname -s` obiadev" -u5711  -G5701   -g5711 obiadev;
useradd -c "`hostname -s` infadev" -u5712 -G5701   -g5712 infadev;
useradd -c "`hostname -s` dacdev" -u5713 -G5701    -g5711 dacdev;
useradd -c "`hostname -s` oraprd" -u5714 -G5701  -g5702 oraprd;
useradd -c "`hostname -s` oragld" -u5715 -G5701   -g5703 oragld;
useradd -c "`hostname -s` oratst" -u5716 -G5701  -g5704 oratst;
useradd -c "`hostname -s` oravis" -u5717  -G5701  -g5705 oravis;
useradd -c "`hostname -s` oradev" -u5718 -G5701   -g5706 oradev;
useradd -c "`hostname -s` orauat" -u5719  -G5701  -g5707 orauat;
useradd -c "`hostname -s` oracrp1" -u5720 -G5701   -g5708 oracrp1;
useradd -c "`hostname -s` oracrp2" -u5721 -G5701   -g5709 oracrp2;
useradd -c "`hostname -s` oracrp3" -u5722 -G5701   -g5710 oracrp3;
useradd -c "`hostname -s` obidbdev" -u5723 -G5701   -g5713 obidbdev


Chmod 777 /etc/oraInventory/

Cd /etc/oraInventory/

find . -type d -exec chmod 777 {} \;

find . -type f -exec chmod 666 {} \;



OCFS2

: add new node to cluster on running ocfs nodes:
o2cb_ctl -C -i -n ppidb12 -t node -a number=6 -a ip_address=10.202.104.183 -a ip_port=7776 -a cluster=ocfs2


up2date --install ocfs2-`uname -r`
up2date ocfs2-tools ocfs2console
reboot to load modules
(modprobe ocfs2,modprobe ocfs2_dlmfs)
service o2cb configure
/etc/init.d/o2cb online
/etc/init.d/o2cb start (service o2cb start)
/etc/init.d/ocfs2 start (service ocfs2 start)
/etc/init.d/o2cb status (service o2cb status)
mount -t ocfs2 -a
/etc/ocfs2/cluster.conf
From the GUI
ocfs2console

configure file system with a 64k cluster size
mkfs.ocfs2 -C 64K -L a11_d11_share /dev/xvdNN
mkfs.ocfs2 -C 64K -b 4K -L u31 /dev/VG_MTG_BKUP/LogVolU31
mkfs.ocfs2 -C 64K -L u46 /dev/VG_VA_NS/LV_U46
mkfs.ocfs2 -C 64K -L EBS_SHARE /dev/sdf1

ISCSI
RH5
up2date --install iscsi-initiator-utils
up2date --install lsscsi
/sbin/iscsi-iname
vi /etc/iscsi/initiatorname.iscsi 
/sbin/iscsistart (or reload if you have mounted drives)
iscsiadm -m discovery -t sendtargets -p ip-or-resolveable-name-of-san

# iscsiadm -m discovery -t sendtargets -p 192.168.1.5
# /etc/init.d/iscsi restart (or reload if you have mounted drives)
Now there should be a block device under /dev directory. To obtain new device name, type:
# fdisk -l
or
# tail -f /var/log/messages
Add device to /etc/fstab:
/dev/sdd4 /u01                    ext4    _netdev,defaults        0 0

To remove target records if you typo the target IP:
iscsiadm -m discoverydb -t sendtargets -p 10.201.97.5 -o delete

Misc. Commands
iscsiadm -m session (to confirm sessions)
iscsiadm -m session --rescan
echo "c t l" >  /sys/class/scsi_host/hostH/scan (where H is the HBA number and c is the channel on the HBA, t is the target ID and l is the LUN)
echo "0 0 0" >  /sys/class/scsi_host/host6/scan

map dm devices to block devices:
sudo lvdisplay|awk  '/LV Name/{n=$3} /Block device/{d=$3; sub(".*:", "dm-", d); print d, n;}'

a new Virtual disk using the storage manager and it does not show, run the commands below
ls /sys/class/scsi_host/
echo "- - -" >/sys/class/scsi_host/host#/scan    -change host# to the hosts in the directory

tail /var/log/messsages

fdisk -l


RH4
iscsi-ls -l
/etc/initiatorname.iscsi
/etc/iscsi.conf


Troubleshooting iscsi

check sessions
 iscsiadm -m session
 iscsiadm -m iface
 iscsiadm -m node -l -I iscsi-xx
 iscsiadm -m session

[root@ca-sna-ns02 ~]# iscsiadm -m session
tcp: [5] 10.201.97.34:3260,1 iqn.1984-05.com.dell:powervault.md3600i.6782bcb000340cab000000004df169f7
tcp: [6] 10.201.97.36:3260,2 iqn.1984-05.com.dell:powervault.md3600i.6782bcb000340cab000000004df169f7

need all 4 so check iface

iscsiadm -m iface
[root@ca-sna-ns02 ~]# iscsiadm -m iface
default tcp,<empty>,<empty>,<empty>,<empty>
iser iser,<empty>,<empty>,<empty>,<empty>
bnx2i.00:1e:c9:4a:bc:72 bnx2i,00:1e:c9:4a:bc:72,<empty>,<empty>,<empty>
iscsi-3 tcp,<empty>,<empty>,eth3,<empty>
iscsi-2 tcp,<empty>,<empty>,eth2,<empty>
bnx2i.00:1e:c9:4a:bc:74 bnx2i,00:1e:c9:4a:bc:74,<empty>,<empty>,<empty>

So you can see from -m session above, the lower ip numbers are attached, so attach to the other controller:
[root@ca-sna-ns02 ~]# iscsiadm -m node -l -I iscsi-3
Logging in to [iface: iscsi-3, target: iqn.1984-05.com.dell:powervault.md3600i.6782bcb000340cab000000004df169f7, portal: 10.201.97.34,3260]
Logging in to [iface: iscsi-3, target: iqn.1984-05.com.dell:powervault.md3600i.6782bcb000340cab000000004df169f7, portal: 10.201.97.67,3260]
Logging in to [iface: iscsi-3, target: iqn.1984-05.com.dell:powervault.md3600i.6782bcb000340cab000000004df169f7, portal: 10.201.97.36,3260]
Logging in to [iface: iscsi-3, target: iqn.1984-05.com.dell:powervault.md3600i.6782bcb000340cab000000004df169f7, portal: 10.201.97.66,3260]


Add new iscsi volume to OS

echo "- - -" >/sys/class/scsi_host/host#/scan    -change host# to the hosts in the directory

tail /var/log/messsages

fdisk -l

May or may not find it, if it doesn't reboot


Pauls notes on ISCSI
Subject: iscsi setup on ns servers


1. Install dual port 10Gbps NIC 
2. configure Network - assign IP's from the 10.202.97 tab on the VSS doc. one nic in the 10.202.97.32 subnet and the other in the 10.202.97.48 subnet
3. active 10Gbps interfaces
4. Configure /etc/iscsi/initiatorname.iscsi using standards from other NS servers
5. Configure /etc/iscsi/iscsid.conf like other NS servers
6. Chkconfig on for iscsi and iscsid
7. test and verify 10G LAN 
8.add host to MD3620i in existing NS host group
9. make all /uNN directories
10. edit the /etc/fstab to match the /uNN entries from other NS servers
11. add new iscis interface - if eth2 and eth3 are new 10Gbps NIC then:
  iscsiadm --mode iface --op=new --interface=iscsi-2
  iscsiadm --mode iface --op=new --interface=iscsi-3
  iscsiadm --mode iface --op=update --interface iscsi-2 --name=iface.net_ifacename --value=eth2
 iscsiadm --mode iface --op=update --interface iscsi-3 --name=iface.net_ifacename --value=eth3
 iscsiadm --mode iface --interface iscsi-2
  iscsiadm --mode iface --interface iscsi-3
 iscsiadm -m node -I default -u
 iscsiadm --mode iface --op=delete --interface=default

12. Discover iscsi targets:
   iscsiadm -m discovery -t sendtargets -p 10.202.97.34 -I iscsi-2
   iscsiadm -m discovery -t sendtargets -p 10.202.97.50 -I iscsi-3
  service iscsid restart 
  service iscsi restart 

13  Verify all four iscsi SAN interfaces on MD3630i are logged into:  
	 iscsiadm -m session
	if not, manually log into hte missing interface ex: iscsiadm -m node -l -I iscsi-3
14. Install ocfs2 tools and kernel packages
15: add new node to cluster on all other servers:
	o2cb_ctl -C -i -n ca-sna-ns06 -t node -a number=3 -a ip_address=10.201.97.41 -a ip_port=7778 -a cluster=ocfs2
16: copy /etc/ocfs2/cluster from exidting SN server to new NS server
17,. add to rc.local: /sbin/iscsiadm -m node -l -I iscsi-3  where iscsi-X = the second interface listed in iscsadm -m iface
18 install md tools and drivers from dell
19 reboot new ns server
20 verify SAN mounts
21 link /etc/exports to /u20's export file
22. start NFS
23 adjust /mnt/backup to link to local SAN and remove NFS




lastlog
ls -lsh


vi sysconfig/network sysctl.conf samba/smb.conf hosts mail/sendmail.mc sysconfig/network-scripts/ifcfg-bond0

Purge VA-NS02 disk backups
cd /root/bin
[root@va-ash-ns02 bin]# ./purge_disk_backups 

Find out harware vendor information:
dmidecode
example:
dmidecode –t memory > mem.txt

omreport storage adisk controller=0
omreport storage vdisk

cp from one dir to another keeping all permissions and links intact:
tar -cvf - . | ( cd /new.dir; tar -xvf - )

Register OEL Server:
unset LANG;up2date --nox --register --proxy 10.201.215.226:8080

useradd -c "snoapp0x Vinod Dosapati" -d /home/vdosapa -m -s /bin/bash -u 1035 -g 100 vdosapa



Remove password aging for all accounts containing 'ora'and 'appl'
cat /etc/passwd | grep ora > /mnt/patch/u1
cat /etc/passwd | grep appl >> /mnt/patch/u1
for user in `cat /mnt/patch/u1`; do chage -M 99999 $user; done


Set Password Expiry Date for an user using chage option -M
# chage -M number-of-days username

Set the Account Expiry Date for an User
# chage -E "2009-05-31" username

Force the user account to be locked after X number of inactivity days
# chage -I 10 username

How to disable password aging for an user account
# chage -m 0 -M 99999 -I -1 -E -1 username
chage -I -1 -m 0 -M 99999 -E -1 rti_item_update




vi del remaining chars in a line
/: (enter)
go to line where you want to del and hit d$
then do a n and a .
n.n.n.n. etc.

find a process running on a particular port:
sudo lsof -i | grep PORT or sudo netstat -anp | grep PORT

netstat -atunp


vi edit multiple files
cd /home/
vi */.bash_profile
:wn to save and go to next file
:n to go to next file without modifying

NFS mount on AIX to LINUX NFS Share:
nfso -p -o nfs_use_reserved_ports=1
mount servername:/share /mnt/whatever
AIX Network config
mktcpip -h production -a 172.32.0.100 -m 255.255.0.0 -i en1 -n 172.32.0.1 -d hacla.org -g 172.32.254.254 -s -C 0 -A no


Troubleshoot AD Auth Issue
login local to the server as root trying logging in to the server via AD credentials at the same time service winbind stop
cd /var/cache/samba/
rm -f *.tdb
service winbind start
getent group meg 


/var
cd /var
du -sh * 

cd /var/log/samba/cores/winbindd
cd winbindd
rm -f core*
service winbind restart

Drastic winbind:			*** may have to do this twice ****
1. tail /var/log/secure			*** see if my account is locked. ***
2. service winbind stop
3. ps -ef | grep winbind		*** verify winbind has stopped ***
4. net ads join -U root-ad
5. service winbind restart

6. cd /var/cache/samba
7. rm -f *.tdb
8. cat /etc/krb5.conf
9. vi /etc/krb5.conf			>>> change the first two IPs to match CA or VA depending on server location >>>


Mount an iso
mount -o loop -t iso9660 file.iso /mnt/test


DMCRYPT:
cryptsetup create mtgcrypt /dev/VolGroup_ID_12428/LogVol_mtg 

Passphrase: prucef#U6ahA*eT

mount /dev/mapper/mtgcrypt /mnt/mtg/   (can mount any location)

copy data

 umount /mnt/mtg

 cryptsetup remove mtgcrypt


SunOS/Solaris:
show physical network devices
dladm show-dev 
show aggregate network devices
dladm show-aggr

check mirrors/disks
metastat | more
to detach and reattach a disk from a mirror to re-sync
metadetach -f d10 d12 (d10 is the disk mirror, d12 is the actual disk)
metattach d10 d12

managing services:
inetadm (non gui)
smc (gui)

Edit Crontab:
EDITOR=vi;export EDITOR=vi
crontab -e user_name

Changing passwords:
passwd -r files user_name

/etc/resolv.conf, /etc/hosts, /etc/samba/smb.conf on linux and /usr/local/samba/lib/sm.conf on Sun

krb5.conf files   /etc/ and /usr/local/etc on SUN

because sendmail.mc is not used on solaris like linux
you must go to the shar lib
cd to the cf difecotry
nad manually run make on the mc file
better just to edit the cf file

Check hardware:
/usr/platform/`uname -i`/sbin/prtdiag

Troubleshoot AD
9.	set LDAP passwd
a.	/usr/local/samba/bin/smbpasswd –w n0p@s$
10.	Join domain
a.	/usr/local/samba/bin/net ads join 
11.	Start winbind
a.	tar -xvf sam-init.tar
b.	/etc/init.d/samba start
12.	Verify AD communication – should see AD accounts
a.	getent passwd
b.	getent group
13.	edit /etc/pam.conf
a.	vi pam.conf – SET cust code
b.	cp /etc/pam.conf /etc/pam.conf.disti
c.	cp pam.conf /etc


MTG ASA Allow ping to a ct managed ASA:
access-list acl-out extended permit icmp host 206.135.37.161 any echo-reply


Updating mrtg and cisco backups:

On ca-sna-mgmt01:

Mrtg:  
vi /usr/local/mrtg-cfg/mrtg-config-build
add the following lines and edit:
#
/usr/local/mrtg-2/bin/cfgmaker --global 'WorkDir: /u01/www/html/mrtg/work/MSP'  \
          --global 'Options[_]: bits,growright' \
        -ifref=ip \
          --output /usr/local/mrtg-cfg/sri-az-asa01.cfg    \
           mtgmsp@24.119.181.187

/usr/local/mrtg-2/bin/indexmaker --output=/u01/www/html/mrtg/sri-az-asa01.html --prefix=work/MSP --title="SRI AZ Managed VPN" --sort=name --nolegend /usr/local/mrtg-cfg/sri-az-asa01.cfg

# /usr/local/mrtg-2/bin/mrtg /usr/local/mrtg-cfg/sri-az-asa01.cfg

then copy/paste each line in. You will need to add "env LANG=C" to the front of the last line. Run it until it returns no errors.

Edit crontab:
02,07,12,17,22,27,32,37,42,47,52,57 * * * * /usr/local/mrtg-2/bin/mrtg /usr/local/mrtg-cfg/sri-az-asa01.cfg > /dev/null 2>&1

Edit html intranet page:
Y:\Intranet\infrastructure\mrtg.htm
height="9">&nbsp;&nbsp;
          <a href="http://10.201.99.3/mrtg/sri-az-asa01.html">SRI AZ ASA</a>
          </td></tr>
	  <tr><td align="left"><strong><img src="/images/bullet_r_gray.png" alt="bullet" width="10"


Cisco backups:

cd /u01/net-scripts

Using TRI as an example:
Update tri-riv (tse-riv) IP in:
backuphosts/tri.rt
passwordfiles/cust_asa.pw 

Run these commands:
PATH=$PATH:/usr/local/net-sense/bin/;export PATH
cd /u01/net-scripts/
/usr/local/net-sense/bin/encrypt_logins -if passwordfiles/cust_asa.pw -of passwordfiles/cust_asa-en.pw -nokey

The cisco backups require the encrypted password file. Do not delete the unencrypted file when prompted.
Hit <enter> when prompted for a password. They type “no” when prompted to delete the un-encrypted password file.

add to asa in ca:
access-list ATT_access_in extended permit udp host xx.xx.xx.xx host 12.130.200.23 eq tftp 
access-list ATT_access_in extended permit udp host xx.xx.xx.xx host 12.130.200.23 eq syslog 

To make sure bb can ping host, add to va asa:
access-list acl-out extended permit icmp host router_IP any echo-reply


VPN

To get the the tunnel group no
sh run crypto | grep mun

to get the peer ip:
sh run crypto | grep <tunnel group no>

To see info about all tunnels security associations:
sh cry ipsec sa

To find the map for the IP
sh run cry | grep 216.201.150.110

To show phase 1 authenticated peers:
sh cry isa sa 

Check to see if IPSEC is established (tunnel is up passing traffic)
sh cry ips sa peer <peer IP>

To reset a VPN connection:
No crypto map mtg-savvis 124 set peer  74.102.38.10
crypto map mtg-savvis 124 set peer  74.102.38.10

To change from answer-only to bi-directional (won't show up as an entry):
crypto map mtg-vpn 375 set connection-type bi


To change peer address:
Add the new address to the tunnel-group

tunnel-group 208.47.23.178 type ipsec-l2l
tunnel-group 208.47.23.178 ipsec-attributes
pre-shared-key KdELiS7Dz1gMDEhyISzgNg4pQ2
isakmp keepalive threshold 11 retry 2


Remove the old peer ip
no crypto map mtg-vpn 95 set peer 68.16.217.35 

Add the new peer ip
crypto map mtg-vpn 95 set peer 208.47.23.178

clear out the old tunnel group:
clear configure tunnel-group 68.16.217.35


VPN Config Examples:
### MUN (PAT configuration)
access-list mun-nh-tunnel remark MUN VPN connection
access-list mun-nh-tunnel permit ip 10.201.102.240 255.255.255.240 host 64.60.145.18  

access-list vpn-nonat permit ip 10.201.102.240 255.255.255.240 host 64.60.145.18  

access-list ca-sna-custnet_access_in  permit ip 10.201.102.240 255.255.255.240 host 64.60.145.18  

crypto map mtg-vpn 375 match address mun-nh-tunnel
crypto map mtg-vpn 375 set connection-type answer-only
crypto map mtg-vpn 375 set peer 64.60.145.18
crypto map mtg-vpn 375 set transform-set ESP-AES-128-SHA ESP-AES-256-SHA ESP-3DES-MD5 ESP-3DES-SHA ESP-AES-256-MD5 ESP-DES-MD5 ESP-AES-192-SHA ESP-AES-192-MD5
crypto map mtg-vpn 375 set reverse-route

tunnel-group 64.60.145.18 type ipsec-l2l
tunnel-group 64.60.145.18 ipsec-attributes
 pre-shared-key MuN@5+u$pn
 isakmp keepalive threshold 11 retry 2

### AMI (NAT configuration)
access-list ami-tunnel remark AMI VPN connection
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240 192.168.52.0 255.255.255.0
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.16.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.17.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.18.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.19.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.20.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.21.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.22.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.23.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.24.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.25.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.26.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.27.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.28.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.29.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.30.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.31.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.152.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.153.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.154.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  198.186.155.0 255.255.255.0  
access-list ami-tunnel permit ip 10.201.102.224 255.255.255.240  146.1.1.0 255.255.255.0

access-list vpn-nonat permit ip 10.201.102.1224 255.255.255.240 192.168.52.0 255.255.255.0
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.16.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.17.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.18.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.19.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.20.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.21.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.22.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.23.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.24.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.25.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.26.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.27.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.28.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.29.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.30.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.31.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.152.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.153.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.154.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  198.186.155.0 255.255.255.0  
access-list vpn-nonat permit ip 10.201.102.224 255.255.255.240  146.1.1.0 255.255.255.0

crypto map mtg-vpn 355 match address ami-tunnel
crypto map mtg-vpn 355 set connection-type answer-only
crypto map mtg-vpn 355 set peer 208.253.165.20
crypto map mtg-vpn 355 set transform-set ESP-AES-128-SHA ESP-AES-256-SHA ESP-3DES-MD5 ESP-3DES-SHA ESP-AES-256-MD5 ESP-DES-MD5 ESP-AES-192-SHA ESP-AES-192-MD5
crypto map mtg-vpn 355 set reverse-route

tunnel-group 208.253.165.20 type ipsec-l2l
tunnel-group 208.253.165.20 ipsec-attributes
 pre-shared-key  @M!@5+u$pn
 isakmp keepalive threshold 11 retry 2




Global search and replace with vi
:g/stingtosearchfor/s//newstring/g






curl -x 10.201.215.226:8080 https://payflowpro.paypal.com
wget --proxy=on  https://payflowpro.paypal.com/
--09:47:40--  https://payflowpro.paypal.com/
           => `index.html'
Connecting to 10.202.215.226:8080... connected.
Proxy tunneling failed: ForbiddenUnable to establish SSL connection.




Using the ASA for packet capture:

access-list ixa_cap permit tcp host 10.200.31.74 host 10.202.102.178
access-list ixa_cap permit tcp host 10.202.102.178 host 10.200.31.74 

capture ixa-tcp access-list ixa_cap int inside

  
show capture

show capture ixa-tcp

clear capture ixa-tcp

no capture ixa-tcp




access-list loe-server-mon extended permit udp host 172.16.10.92 host 172.16.50.1 eq snmp 
access-list loe-server-mon extended permit udp host 172.16.50.1 host 172.16.10.92 eq 1223 


  capture loe-udp access-list loe-server-mon int loe-wan

  show capture loe-udp


no access-list loe-server-mon - to stop and save capture

clear capture loe-udp - to start over

no capture loe-udp - to remove the capture

https://192.168.192.33/capture/loe-udp/pcap


simple example:
access-list capture extended permit ip host 10.202.102.34 host 10.2.1.15 
access-list capture extended permit ip host 10.2.1.15 host 10.202.102.34  


capture new-cap access-list capture interface va-ash-custnet 

sh capture new-cap
clear capture new-cap

TwI capture
access-list twi_cap permit tcp 174.47.15.0 255.255.255.0 host 12.130.200.94
access-list twi_cap permit tcp host 10.201.215.82 any

capture twi-tcp access-list twi_cap int CA-SNA-DMZ



Packet-tracer
packet-tracer input va-ash-custnet icmp 20 10.202.102.34 20 20 10.2.1.15

MTU
Linux
ping -M do -s 1292 10.200.22.14

sets the DF (do not fragment flag) to see what MTU size can be negotiated

netstat -s to see stats on retransmits





Cron this to re-enable printers:
*/5 * * * * lpstat -p|grep disabled|while read a b c;\\
do /usr/bin/enable $b;done >/dev/null 2>&1

DUMP/RESTORE
[root@ggpdb02 image0-1]# restore -if home.0.bkup 
Dump tape is compressed.
restore > ls
.:
appldev/                 linux/                   serveradministrator/
applfal/                 lost+found/              serveradministrator-5.2/
applprd/                 mtg/                     serveradministrator.bak/
appltst/                 oradev/                  serveradministrator5.3/
discodev/                orafal/                  serveradministrator5.4/
discoprd/                oraprd/                  skancharla/
drivers/                 oratst/                  spinnamaneni/
gmayer/                  pguillen/
jgabay/                  rvadlamu/

restore > cd jgabay
restore > ls
./jgabay:
.bash_history     .emacs            date.lst          order_status.sh 
.bash_logout      .gtkrc            date_test.log     sysdate.sh 
.bash_profile     .kde/             date_test.sh      test_email.sh 
.bashrc           .viminfo          email_test.log 
.canna            .zshrc            order_status.lst 

restore > add order*
restore > ls
./jgabay:
 .bash_history      .emacs             date.lst          *order_status.sh 
 .bash_logout       .gtkrc             date_test.log      sysdate.sh 
 .bash_profile      .kde/              date_test.sh       test_email.sh 
 .bashrc            .viminfo           email_test.log 
 .canna             .zshrc            *order_status.lst 

restore > extract
You have not read any volumes yet.
Unless you know which volume your file(s) are on you should start
with the last volume and work towards the first.
Specify next volume # (none if no more volumes): 1
set owner/mode for '.'? [yn] y
restore > quit


manually run dump:
cd /u01
dump -0uz -f root.0.bkup /
or
/sbin/dump -0u -f /dev/st0 /usr/src


Reverse Proxy

IT:

steps to do this are:

1. assign public IP in mtg-public-ip-ass.xls
2. assign private IP on same doc
3. create static on savvis ASA01 for public to private
      one static on TWT interface
      one static on Savvis interface
4. Add access list to permit https on public IP for savvis interface
5. Add access list to permit https on public IP for twt interface
6. Open savvis asa01 DMZ interface to allow SSL01 and 02 access to esiapp11 ports 8004 and 8005
7. open 3130 ACL to allow SSL01 and 02 access to esiapp11 ports 8004 and 8005
8. Create bond0:XX, eth0:XX and eth1:XX fiels in the /etc/sysconfig/network-scripts dir. Use private IP assigned from step 2
9. run ifup bond0:XX
10, ping private IP to confirm it is active
11. edit the httpd-ssl-esi.conf on each ssl server. copy the dev1 virtual host section, paste at bottom and change to the new dev2 and dev2 port 
12 edit the httpd-ssl-esi.conf on each ssl server. copy the dev1 virtual section, paste at bottom  and change to the new dev3 and dev3 port
13. restart httpd-esi service
14 test access in web browser.


California
CA ASA Access-Groups
access-group ATT_access_in in interface ATT
access-group ca-sna-custnet_access_in in interface ca-sna-custnet
access-group TWT_access_in in interface TWT
access-group CA-SNA-DMZ_access_in in interface CA-SNA-DMZ


Infrastructure
First figure out what external IP and internal IP you are going to use for the connection, then setup
static nat for the proxy server
Public IP SSL01: 12.130.200.141 (ATT)
Public IP SSL01: 174.47.15.141 (TWT)
Public IP SSL02: 12.130.200.142 (ATT)
Public IP SSL02: 174.47.15.142 (TWT)
Virtual interface on SSL Server: 10.202.215.180
Virtual interface on SSL Server: 10.202.215.181

Real IP Address of server being accessed: 10.201.101.242

On ASA: (sh run static to see what nats are in place)
create nats
static (CA-SNA-DMZ,ATT) 12.130.200.141 10.201.215.180 netmask 255.255.255.255 
static (CA-SNA-DMZ,ATT) 12.130.200.142 10.201.215.181 netmask 255.255.255.255 
static (CA-SNA-DMZ,TWT) 174.47.15.141 10.201.215.180 netmask 255.255.255.255 
static (CA-SNA-DMZ,TWT) 174.47.15.142 10.201.215.181 netmask 255.255.255.255


create acls on ASA for required ports

access-list ATT_access_in extended permit tcp any host 12.130.200.141 eq 8001  
access-list ATT_access_in extended permit tcp any host 12.130.200.142 eq 8001 

access-list ATT_access_in extended permit tcp any host 12.130.200.141 eq 8000  
access-list ATT_access_in extended permit tcp any host 12.130.200.142 eq 8000 

access-list TWT_access_in extended permit tcp any host 174.47.15.141 eq 8001 
access-list TWT_access_in extended permit tcp any host 174.47.15.142 eq 8001 

access-list TWT_access_in extended permit tcp any host 174.47.15.141 eq 8000 
access-list TWT_access_in extended permit tcp any host 174.47.15.142 eq 8000 

create acls to allow inbound from ssl servers(DMZ) to internal hosts
access-list CA-SNA-DMZ_access_in extended permit tcp host 10.201.215.210 gt 1023 host 10.201.101.242 eq 8001 
access-list CA-SNA-DMZ_access_in extended permit tcp host 10.201.215.226 gt 1023 host 10.201.101.242 eq 8001 

access-list CA-SNA-DMZ_access_in extended permit tcp host 10.201.215.210 gt 1023 host 10.201.101.242 eq 8000 
access-list CA-SNA-DMZ_access_in extended permit tcp host 10.201.215.226 gt 1023 host 10.201.101.242 eq 8000 


On 6509:
Create acls to allow traffic inbound (out interface) to servers from dmz
access-list 2240 permit tcp host 10.201.215.210 host 10.201.101.242 eq 8001
access-list 2240 permit tcp host 10.201.215.226 host 10.201.101.242 eq 8001

access-list 2240 permit tcp host 10.201.215.210 host 10.201.101.242 eq 8000
access-list 2240 permit tcp host 10.201.215.226 host 10.201.101.242 eq 8000


allow traffic back out (in interface)
access-list 2241 permit tcp host 10.201.101.242 host 10.201.215.210 gt 1023 est
access-list 2241 permit tcp host 10.201.101.242 host 10.201.215.226 gt 1023 est


On Proxy Server:
ifconfig -a (see if it's there already)
create interface for internal IP
[root@va-ash-ssl01 network-scripts]# vi ifcfg-bond0:27
#IXA Customer
BOOTPROTO=static
DEVICE=bond0:27
ONBOOT=yes
USERCTL=no
PEERDNS=no
TYPE=Ethernet
IPADDR=10.202.215.192
NETMASK=255.255.255.0

[root@va-ash-ssl01 network-scripts]# vi ifcfg-eth0:27
BOOTPROTO=none
DEVICE=eth0:27
ONBOOT=yes
TYPE=Ethernet
USERCTL=no
PEERDNS=no
MASTER=bond0:27
SLAVE=yes

ifup ifcfg-bond0:27

ifconfig -a

bond0:27  Link encap:Ethernet  HWaddr 00:18:8B:2E:12:0F  
          inet addr:10.202.215.192  Bcast:10.202.215.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1

Add host file entry on both ssl servers
I.E.
10.202.101.146          adiapp04.americandawn.com       adiapp04
telnet to the port from both ssl servers to verify acls work



Virginia
VA ASA
access-group acl-out in interface savvis-outside
access-group va-custnet-in in interface va-ash-custnet
access-group xo-out in interface XO-outside
access-group acl-dmz in interface va-ash-dmz


Infrastructure
First figure out what external IP and internal IP you are going to use for the connection, then setup
static nat for the proxy server
Public IP SSL01: 209.67.192.60 (SAVVIS)
Public IP SSL01: 206.205.132.60 (XO)
Public IP SSL02: 209.67.192.61 (SAVVIS)
Public IP SSL02: 206.205.132.61 (XO)
Virtual interface on SSL Server: 10.202.215.192
Virtual interface on SSL Server: 10.202.215.193

Real IP address of server being accessed: 10.202.102.180

On ASA: (sh run static to see what nats are in place)
create nats
static (va-ash-dmz,savvis-outside) 209.67.192.60 10.202.215.192 netmask 255.255.255.255 
static (va-ash-dmz,savvis-outside) 209.67.192.61 10.202.215.193 netmask 255.255.255.255
static (va-ash-dmz,XO-outside) 206.205.132.60 10.202.215.192 netmask 255.255.255.255  
static (va-ash-dmz,XO-outside) 206.205.132.61 10.202.215.193 netmask 255.255.255.255


create acls for required ports

access-list acl-out extended permit tcp any host 209.67.192.60 eq 8001 
access-list acl-out extended permit tcp any host 209.67.192.61 eq 8001 

access-list twt-out extended permit tcp any host 50.58.68.60 eq 8001
access-list twt-out extended permit tcp any host 50.58.68.61 eq 8001  


create acls to allow inbound from ssl servers(DMZ) to internal hosts
access-list acl-dmz extended permit tcp host 10.202.215.210 gt 1023 host 10.202.102.180 eq 8001 
access-list acl-dmz extended permit tcp host 10.202.215.226 gt 1023 host 10.202.102.180 eq 8001 



On 6509:
Create acls to allow traffic inbound (out interface) to servers from dmz
access-list xxxx permit tcp host 10.202.215.210 host 10.202.102.178 range 8001 8003
access-list xxxx permit tcp host 10.202.215.226 host 10.202.102.178 range 8001 8003

access-list xxxx permit tcp host 10.202.215.210 host 10.202.102.180 eq 8000
access-list xxxx permit tcp host 10.202.215.226 host 10.202.102.180 eq 8000

allow traffic back out (in interface)
access-list xxxx permit tcp host 10.202.102.178 host 10.202.215.210 gt 1023 est
access-list xxxx permit tcp host 10.202.102.180 host 10.202.215.210 gt 1023 est


On Proxy Server:
ifconfig -a (see if it's there already)
create interface for internal IP
[root@va-ash-ssl01 network-scripts]# vi ifcfg-bond0:27
#IXA Customer
BOOTPROTO=static
DEVICE=bond0:27
ONBOOT=yes
USERCTL=no
PEERDNS=no
TYPE=Ethernet
IPADDR=10.202.215.192
NETMASK=255.255.255.0

[root@va-ash-ssl01 network-scripts]# vi ifcfg-eth0:27
BOOTPROTO=none
DEVICE=eth0:27
ONBOOT=yes
TYPE=Ethernet
USERCTL=no
PEERDNS=no
MASTER=bond0:27
SLAVE=yes

ifup ifcfg-bond0:27

ifconfig -a

bond0:27  Link encap:Ethernet  HWaddr 00:18:8B:2E:12:0F  
          inet addr:10.202.215.192  Bcast:10.202.215.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1

Add host file entry on both ssl servers
I.E.
10.202.101.146          adiapp04.americandawn.com       adiapp04
telnet to the port from both ssl servers to verify acls work





NAT Setup

#See what acls are there
RTA-ASA01# sh run access-list 
access-list vpn-va-mtg extended permit ip 169.0.0.0 255.255.0.0 10.202.101.16 255.255.255.240 
access-list vpn-va-mtg extended permit ip 169.1.0.0 255.255.0.0 10.202.101.16 255.255.255.240 
#Create a new one 
RTA-ASA01(config)# access-list vpn-client-nat extended permit ip 192.168.200.0 255.255.255.0 10.201.101.16 255.255.255.240 
RTA-ASA01(config)# access-list vpn-client-nat extended permit ip 192.168.200.0 255.255.255.0 10.202.101.16 255.255.255.240 
#See what nats are in place
RTA-ASA01(config)# sh run nat
nat (inside) 0 access-list vpn
nat (inside) 1 0.0.0.0 0.0.0.0
#Check global
RTA-ASA01(config)# sh run global
global (outside) 1 209.150.64.75-209.150.64.125 netmask 255.255.255.128
global (outside) 1 interface
global (outside) 1 209.150.64.126 netmask 255.255.255.128
#Change nat and global to a higher number
RTA-ASA01(config)# no nat (inside) 1 0.0.0.0 0.0.0.0
RTA-ASA01(config)# nat (inside) 150 0.0.0.0 0.0.0.0
RTA-ASA01(config)# global (outside) 100 169.0.0.170
INFO: Global 169.0.0.170 will be Port Address Translated
RTA-ASA01(config)# no global (outside) 1 209.150.64.75-209.150.64.125 netmask 255.255.255.128
RTA-ASA01(config)# no global (outside) 1 interface
RTA-ASA01(config)# no global (outside) 1 209.150.64.126 netmask 255.255.255.128
RTA-ASA01(config)# global (outside) 150 209.150.64.75-209.150.64.125 netmask 255.255.255.128
RTA-ASA01(config)# global (outside) 150 interface
RTA-ASA01(config)# global (outside) 150 209.150.64.126 netmask 255.255.255.128
RTA-ASA01(config)# nat (outside) 100 access-list vpn-client-nat

After config:
RTA-ASA01# sh run global
global (outside) 150 209.150.64.75-209.150.64.125 netmask 255.255.255.128
global (outside) 100 169.0.0.170
global (outside) 150 interface
global (outside) 150 209.150.64.126 netmask 255.255.255.128
RTA-ASA01# sh run nat
nat (inside) 0 access-list vpn
nat (inside) 150 0.0.0.0 0.0.0.0
nat (outside) 100 access-list vpn-client-nat
RTA-ASA01# sh run access-list vpn-client-nat
access-list vpn-client-nat extended permit ip 192.168.200.0 255.255.255.0 10.201.101.16 255.255.255.240 
access-list vpn-client-nat extended permit ip 192.168.200.0 255.255.255.0 10.202.101.16 255.255.255.240
RTA-ASA01# sh xlate
PAT Global 169.0.0.170(1025) Local 192.168.200.3(2467)


SSL Cert Install

To create a csr:
Create private key and create the password less PEM key from the private key:

openssl genrsa -des3 -out whomever.key 1024 or 2048 ( tigerf84 ) 


Create CSR:
openssl req -new -key cru.key -out whomever.com.csr


get the .key file from whomever created the csr
put it in the same dir as the crt file

run this command:
openssl rsa -in apex.twindragonmarketing.com.key -out apex.twindragonmarketing.com.pem

now you have a password-free key file

To install the cert and pem:
cp apex.twindragonmarketing.com.pem /usr/local/apache2/ssl/apex.twindragonmarketing.com.key
cp apex.twindragonmarketing.com.crt /usr/local/apache2/ssl/




Misc. SSL Stuff
Log into ssl01 or 02

CD to /u01/ca
mkdir /u01/ca/xxx (where xxx = company code)
cd to /u01/ca/xxx (where xxx = company code)

The following information must be provided by the customer before we can generate a CSR.

Country Name (2 letter code): US
State or Province Name (full name): California
Locality Name (eg, city):? Calabasas
Organization Name (eg, company):? IXIA Communications
Organizational Unit Name (eg, section): Information Technology
Common Name (eg, YOUR name): *.ixiacom.com

The following fields are optional and can be left blank (just press enter when answering them).

Email Address []:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:


Please note that if the Common Name starts with an ‘*’, as in the example above, the file name should be ‘star.COMMON_NAME.key’.  In the above example, it will be ‘star.ixiacom.com’.
But when you generate the key, enter ‘*.ixiacom.com’ as the Common Name.


Run the following:

1.	to generate a key: use xxx@tigerf84 as pass (or use xxx@tigerf84 where xxx = company code)

openssl genrsa -des3 -out CUSTOMER.COMMON_NAME.key 2048

2. To generate a CSR. Use information provided by customer 

openssl req -new -key CUSTOMER.COMMON_NAME.key -out CUSTOMER.COMMON_NAME.com.csr


3. To generate a password free key:

openssl rsa -in CUSTOMER.COMMON_NAME.key -out CUSTOMER.COMMON_NAME.pem


Cut and paste the contents of CUSTOMER.COMMON_NAME.csr and email to customer or alert


4. copy the contents of /u01/ca/xxx to all four ssl servers






IO Tests for block devices and nfs performance
cd to the mountpoint
time dd if=/dev/zero of=bigfile bs=64k count=65536
(approx 4.4GB file)
time dd if=/dev/zero of=bigfile bs=1024 count=1024000
(1GB file)







Chroot How-to (SFTP)
FTP is easy to configure for chroot. It does not require a special environment. Set the user shell to /bin/true and the users home directory to the chroot top. The edit the vsftp files to allow the user to connect and identify the user as a chroot.

Prep the server for chroot:
vi /etc/pam.d/sshd
add:session    required     pam_chroot.so

vi /etc/pam.d/su
add:session         required        /lib/security/$ISA/pam_chroot.so

vi /etc/shells
add:/usr/libexec/openssh/sftp-server

setup home directory with root.root 755 permissions and copy required chroot dirs

cp -p /etc/security/pam_env.conf /chroothome/etc/security/

cat /etc/passwd|grep useraccount >> /chroot_home_dir/etc/passwd

Make sure dev/null and dev/zero is 666 in chroot home

vi /etc/ssh/sshd_config
change UsePAM=no to UsePAM=YES and enable sftp
restart sshd




chroot2 script 32bit:

#!/bin/bash
#
# Usage: ./create_chroot_env username
#
# Here specify the apps you want into the enviroment
##APPS="/usr/bin/env /usr/bin/wget /usr/bin/ftp /usr/bin/dig /usr/bin/traceroute /usr/bin/host /bin/sh /bin/grep /bin/cat /usr/bin/pico /bin/gzip /bin/gunzip /bin/bash /bin/ls /bin/mkdir /bin/mv /bin/pwd /bin/rm /usr/bin/id /usr/bin/ssh /bin/ping /usr/bin/dircolors /usr/bin/less /usr/bin/tail /usr/bin/nslookup /usr/bin/resolveip"
APPS="/usr/bin/env /bin/sh /bin/grep /bin/cat /bin/gzip /bin/gunzip /bin/bash /bin/ls /bin/mkdir /bin/mv /bin/pwd /bin/rm /usr/bin/id /usr/bin/dircolors /usr/bin/less /usr/bin/tail /usr/libexec/openssh/sftp-server"
#
# Sanity check
if [ "$1" = "" ] ; then
echo " Usage: ./chroot2 username CHROOT_HOME"
exit
fi
if [ "$2" = "" ] ; then
echo " Usage: ./chroot2 username CHROOT_HOME"
exit
fi

# Obtain username and HomeDir
CHROOT_USERNAME=$1
CHROOT_TOP=$2
#HOMEDIR=`grep /etc/passwd -e "^$CHROOT_USERNAME" | cut -d':' -f 6`
#cd $HOMEDIR
cd $CHROOT_TOP

# Create Directories no one will do it for you
mkdir etc
mkdir etc/terminfo
mkdir bin
mkdir lib
mkdir usr
mkdir usr/lib
mkdir usr/libexec
mkdir usr/bin
mkdir dev
mknod dev/null c 1 3
mknod dev/zero c 1 5


# Create short version to /usr/bin/groups
# On some system it requires /bin/sh, generally unnessesary in a chroot cage

echo "#!/bin/bash" > usr/bin/groups
echo "id -Gn" >> usr/bin/groups

# Add some users to ./etc/paswd
grep /etc/passwd -e "^root" -e "^$CHROOT_USERNAME" > etc/passwd
grep /etc/group -e "^root" -e "^$CHROOT_USERNAME" > etc/group

for prog in $APPS; do
echo "===========";
echo $prog;
#sleep 1
cp $prog ./ --parents

# obtain a list of related libraries
ldd $prog > /dev/null
if [ "$?" = 0 ] ; then
LIBS=`ldd $prog | awk '{ print $3 }' | grep -v \(`
echo $LIBS
for l in $LIBS; do
#mkdir -p ./`dirname $l` > /dev/null 2>&1
cp $l ./ --parents
done
fi
done

# For strange reason, these 3 libraries are not in the ldd output, but without # them some stuff will not work, like usr/bin/groups
cp /lib/libnss_compat.so.2 /lib/libnsl.so.1 /lib/libnss_files.so.2 /lib/ld-linux.so.2 /lib/libresolv.so.2 /lib/libnss_dns.so.2 /lib/libcwait.so /lib/libssl.so.4 ./lib/
cp /usr/lib/libdns.so.16 /usr/lib/libisc.so.7 /usr/lib/libncurses.so.5 /usr/lib/libreadline.so.4 ./usr/lib/

cp /etc/host.conf ./etc/
cp /etc/hosts ./etc/
cp /etc/nsswitch.conf ./etc/
cp /etc/localtime ./etc/
cp /etc/resolv.conf ./etc/
cp /etc/services ./etc/
cp /etc/protocols ./etc/
cp -R /etc/terminfo/* ./etc/terminfo/

###### end ######
Chroot using the script
1. create account with home directory as top of chroot environment.
2. copy chroot2 to /mnt/ad_hoc/ verify it includes sftp-server
3. run chroot2 USERNAME
4. edit /etc/pam.d/sshd  add: session    required     pam_chroot.so
5. edit /etc/ssh/sshd_config add: DenyGroups and UsePAM yes
6. chown root.root for the top of the chroot env.
7. edit the passwd file and make the home dir what it should be in the chroot env (/ or /incoming)
8. ensure sftp is enabled
9. restart ssshd
10. remove chroot2 from /mnt/ad_hoc
11 test by sftp to server to verify you are in the chroot jail
s

chroot2 script 64bit:

#!/bin/bash
#
# Usage: ./create_chroot_env username
#
# Here specify the apps you want into the enviroment
##APPS="/usr/bin/env /usr/bin/wget /usr/bin/ftp /usr/bin/dig /usr/bin/traceroute /usr/bin/host /bin/sh /bin/grep /bin/cat /usr/bin/pico /bin/gzip /bin/gunzip /bin/bash /bin/ls /bin/mkdir /bin/mv /bin/pwd /bin/rm /usr/bin/id /usr/bin/ssh /bin/ping /usr/bin/dircolors /usr/bin/less /usr/bin/tail /usr/bin/nslookup /usr/bin/resolveip"
APPS="/usr/bin/env /bin/sh /bin/grep /bin/cat /bin/gzip /bin/gunzip /bin/bash /bin/ls /bin/mkdir /bin/mv /bin/pwd /bin/rm /usr/bin/id /usr/bin/dircolors /usr/bin/less /usr/bin/tail /usr/libexec/openssh/sftp-server"
#
# Sanity check
if [ "$1" = "" ] ; then
echo " Usage: ./chroot2 username CHROOT_HOME"
exit
fi
if [ "$2" = "" ] ; then
echo " Usage: ./chroot2 username CHROOT_HOME"
exit
fi

# Obtain username and HomeDir
CHROOT_USERNAME=$1
CHROOT_TOP=$2
#HOMEDIR=`grep /etc/passwd -e "^$CHROOT_USERNAME" | cut -d':' -f 6`
#cd $HOMEDIR
cd $CHROOT_TOP

# Create Directories no one will do it for you
mkdir etc
mkdir etc/terminfo
mkdir bin
mkdir lib
mkdir lib64
mkdir usr
mkdir usr/lib
mkdir usr/lib64
mkdir usr/libexec
mkdir usr/bin
mkdir dev
mknod dev/null c 1 3
mknod dev/zero c 1 5


# Create short version to /usr/bin/groups
# On some system it requires /bin/sh, generally unnessesary in a chroot cage

echo "#!/bin/bash" > usr/bin/groups
echo "id -Gn" >> usr/bin/groups

# Add some users to ./etc/paswd
grep /etc/passwd -e "^root" -e "^$CHROOT_USERNAME" > etc/passwd
grep /etc/group -e "^root" -e "^$CHROOT_USERNAME" > etc/group

for prog in $APPS; do
echo "===========";
echo $prog;
#sleep 1
cp $prog ./ --parents

# obtain a list of related libraries
ldd $prog > /dev/null
if [ "$?" = 0 ] ; then
LIBS=`ldd $prog | awk '{ print $3 }' | grep -v \(`
echo $LIBS
for l in $LIBS; do
#mkdir -p ./`dirname $l` > /dev/null 2>&1
cp $l ./ --parents
done
fi
done

# For strange reason, these 3 libraries are not in the ldd output, but without # them some stuff will not work, like usr/bin/groups
cp /lib/libnss_compat.so.2 /lib/libnsl.so.1 /lib/libnss_files.so.2 /lib/ld-linux.so.2 /lib/libresolv.so.2 /lib/libnss_dns.so.2 /lib/libcwait.so /lib/libssl.so.4 ./lib/
cp /usr/lib/libdns.so.16 /usr/lib/libisc.so.7 /usr/lib/libncurses.so.5 /usr/lib/libreadline.so.4 ./usr/lib/

cp /lib64/libnss_compat.so.2 /lib64/libnsl.so.1 /lib64/libnss_files.so.2 /lib64/ld-linux.so.2 /lib64/libresolv.so.2 /lib64/libnss_dns.so.2 /lib64/libcwait.so /lib64/libssl.so.4 ./lib64/
cp /usr/lib64/libdns.so.16 /usr/lib64/libisc.so.7 /usr/lib64/libncurses.so.5 /usr/lib64/libreadline.so.4 ./usr/lib64/
cp /lib64/ld-linux-x86-64.so.2 ./lib64/
cp /etc/host.conf ./etc/
cp /etc/hosts ./etc/
cp /etc/nsswitch.conf ./etc/
cp /etc/localtime ./etc/
cp /etc/resolv.conf ./etc/
cp /etc/services ./etc/
cp /etc/protocols ./etc/
cp -R /etc/terminfo/* ./etc/terminfo/

###### end ######



[root@rtiapp12 chroot]# pwd
/u01/shared/crp1/xxifdat/inbound/cost_update/chroot
[root@rtiapp12 chroot]# mkdir -p u01/shared/crp1/xxifdat/inbound/cost_update/chroot
[root@rtiapp12 chroot]# cd u01/shared/crp1/xxifdat/inbound/cost_update/chroot
[root@rtiapp12 chroot]# ln -s ../../../../../../../cost_update cost_update
[root@rtiapp12 chroot]# sftp rti_cost_update_crp1@localhost
Connecting to localhost...
rti_cost_update_crp1@localhost's password: 
sftp> pwd
Remote working directory: /cost_update
sftp> ls
sftp> cd ..
sftp> ls
bin          cost_update  dev          etc          lib          lib64        u01          usr          
sftp> cd ..
sftp> ls
bin          cost_update  dev          etc          lib          lib64        u01          usr          
sftp> quit
[root@rtiapp12 chroot]# 







[root@adiapp04 devds]# pwd
/u01/dev/devds

[root@adiapp04 devds]# cd /etc/pam.d

[root@adiapp04 pam.d]# vi sshd 

#%PAM-1.0
auth       required     pam_stack.so service=system-auth
auth       required     pam_nologin.so
account    required     pam_stack.so service=system-auth
password   required     pam_stack.so service=system-auth
session    required     pam_stack.so service=system-auth
session    required     pam_loginuid.so
session    required     pam_chroot.so

[root@adiapp04 pam.d]# more su
#%PAM-1.0
auth       sufficient   /lib/security/$ISA/pam_rootok.so
# Uncomment the following line to implicitly trust users in the "wheel" group.
#auth       sufficient   /lib/security/$ISA/pam_wheel.so trust use_uid
# Uncomment the following line to require a user to be in the "wheel" group.
#auth       required     /lib/security/$ISA/pam_wheel.so use_uid
auth       required     /lib/security/$ISA/pam_stack.so service=system-auth
account    sufficient   /lib/security/$ISA/pam_succeed_if.so uid = 0 use_uid quiet
account    required     /lib/security/$ISA/pam_stack.so service=system-auth
password   required     /lib/security/$ISA/pam_stack.so service=system-auth
# pam_selinux.so close must be first session rule
session    required     /lib/security/$ISA/pam_selinux.so close
session    required     /lib/security/$ISA/pam_stack.so service=system-auth
# pam_selinux.so open and pam_xauth must be last two session rules
session    required     /lib/security/$ISA/pam_selinux.so open 
session    optional     /lib/security/$ISA/pam_xauth.so
session    required     /lib/security/$ISA/pam_chroot.so

[root@adiapp04 pam.d]# vi /etc/ssh/sshd_config

# default value.

Port 22

# Authentication:

#LoginGraceTime 2m
PermitRootLogin yes
#StrictModes yes
#MaxAuthTries 6
AllowGroups users
DenyUsers mtg oratst oradev appltst appldev applupg oraupg oraprd applprd bb apexprd apextst gistst cvs

#UsePAM no
UsePAM yes

AllowTcpForwarding no
#GatewayPorts no
#X11Forwarding no
X11Forwarding no
#X11DisplayOffset 10
#X11UseLocalhost yes
PrintMotd yes
#PrintLastLog yes
#TCPKeepAlive yes
#UseLogin no
#UsePrivilegeSeparation yes
#PermitUserEnvironment no
#Compression yes
#ClientAliveInterval 0
#ClientAliveCountMax 3
#UseDNS yes
#PidFile /var/run/sshd.pid
#MaxStartups 10
#ShowPatchLevel no

# no default banner path
#Banner /some/path

# override default of no subsystems
Subsystem       sftp    /usr/libexec/openssh/sftp-server


find files owned by one user and chown to another user/group
find / -user username -exec chown newuser:group '{}' \;
find * -uid 4101 -exec rm -rf {} \;

RPM

Install multiple RPM's at once:
for file in `ls`;do rpm -ivh $file;done


RPM Query:
rpm -q -a | grep packagename

rpm -qa --last|grep package (to see installation dates/times)

Downgrade an RPM:
rpm -Uvh --oldpackage binutils-2.17.50.0.6-6.0.1.el5.x86_64.rpm

Find out when all packages are installed
rpm -qa --queryformat '%{installtime} (%{installtime:date}) %{name}\n' | sort
rpm -qa --queryformat '%{installtime} %{name}-%{version}-%{release} %{installtime:date}\n' | sort -nr --key=2| sed -e 's/^[^ ]* //'|more

see changed files when a later version is installed:
rpm --verify -p old.package.rpm

Remove both x64 and i386 version
rpm -e --allmatches libcmpiCppImpl0-2.0.0Dell-1.3.el5

if you want to see rpm install times:

rpm -qa   --queryformat '%{installtime} (%{installtime:date}) %{name}\n' |    sort -n | tail -20

Check for architecture
rpm -qa  --queryformat %-{name}-%{version}-%{release}-%{arch}"\n" | grep binutils





LVM

Activate Logical VOlumes LVM
vgchange -ay

Expand VG
1. fdisk and create new partition (LVM)
2. Create physical volume on new partition
	pvcreate /dev/sdd1
3. Extend VG to include new PV
	vgextend VG_MEGDB02_U01 /dev/sdd1
4. Verify
	vgs
	lvs
5. Extend Logical volumes
	lvextend -L +400G /dev/VG_MEGDB02_U01/Log_Vol_U01
	lvextend -l +100%FREE /dev/VG_MEGDB02_U01/Log_Vol_U01_PRD 

6. Expand file system
	resize4fs -p /dev/VG_MEGDB02_U01/Log_Vol_U01
	resize4fs -p /dev/VG_MEGDB02_U01/Log_Vol_U01_PRD
(may need to run e4fsck on the filesystems first)


VPN Logs
On ca-sna-ns01:/var/log
Grep and Redirect output of archive log to file:

grep gal netdev.log | grep -i disconnected > gal.out


for file in `ls netdev.log.*.gz`; do zgrep gal- $file | grep -i disconnected >> gal.out; done

sort -M gal.out > gal.out2

cat  gal.out2 |mail -s "gal logs"  eric.schmitz@mercurytechnology.com


Console stuff:
editdev --name=xxxxx 10
10 is the port number

SAVE in all caps to save the config.

serveraction -m server-xx powercycle
connect server-xx

editdev commands:
Usage: devices <n|device name> (n can be 1 to 48) - 
                 display/change device settings
-v|--version     show version information
-h|--help show this help information
-u   update settings to config, startup, and set hardware if something has changed
-U   update settings to config, startup, and set hardware
--save-startup lci.conf to rc.lciserial (perform even if no changes detected)
--all          do all channels otherwise you must enter a server number or name
--test         show changes only (don't actually modify any files/hardware)

Command line mode:
 devices --name=devname n
  Set name of device n to devname
 devices --baud=2400|4800|9600|19200|38400|57600|115200 n
  Set baudrate of device n to 2400, 4800, 9600, 19200, 38400, 57600,
              or 115200
 devices --baud=0|1|2|3|4|5|6 n
  Set baudrate of device n to 0=2400 1=4800, 2=9600, 3=19200,
              4=38400, 5=57600, or 6=115200  devices --stop=1|2 n
  Set stop bits of device n to 1=1, 2=2
 devices --parity=None|Odd|Even|Mark|Space n
  Set parity of device n to None, Odd, Even, Mark, or Space  devices --parity=0|1|2|3|4 n
  Set parity of device n to 0=None, 1=Odd, 2=Even, 3=Mark, or 4=Space  devices --data=6|7|8 n
  Set number of data bits of device n to 6, 7, or 8  devices --type=OFF|DCE|DTE n
  Set port type of device n to OFF, DCE, or DTE  devices --type=0|1|2 n
  Set port type of device n to 0=OFF, 1=DCE, or 2=DTE  devices --flow=XON|RTS n
  Set flow control of device n to XON/OFF, or RTS/CTS  devices --flow=0|1 n
  Set flow control of device n to 0=XON/OFF, or 1=RTS/CTS  devices --inhibitbuffer=No|Yes n
  Set inhibit buffering of device n to No, or Yes  devices --inhibitbuffer=0|1 n
  Set inhibit buffering of device n to 0=No, or 1=Yes

 devices --query [[--name] [--baud] [--stop] [...]] n
  Show current settings for device n.  Defaults to showing all settings.
  Particular settings can be specified, eg. 'devices --query --baud 1'
   shows the baud rate for device 1.






BB - Remove an alert when normal bbrm doesn't work

[bb@va-ash-ns01 ~]$ cd ../bbvar/
[bb@va-ash-ns01 bbvar]$ rm logs/spedb02.printers 
[bb@va-ash-ns01 bbvar]$ rm hist/spedb02.printers
[bb@va-ash-ns01 bbvar]$ rm -r histlogs/spedb02/printers/

Add printer to queue for monitoring:
On the client (asgapp01, asgadb03 etc), you need to add queue to the /usr/local/bbc/etc/bb-hosts file

For app01 I added:

10.201.103.18 asgapp01 # ssh queue


Monitor a process in BB:
[root@megdb06 /]# su - bb
[bb@megdb06 ~]$ cd etc/
[bb@megdb06 etc]$ ls -la *proc*
-rw-r--r-- 1 bb bb 1819 Jul  8  2005 bb-proctab.DIST
[bb@megdb06 etc]$ cp bb-proctab.DIST bb-proctab
[bb@megdb06 etc]$ vi bb-proctab

delete the BS

: sshd :
localhost: sendmail;<=2 bbrun !xntpdd : httpd;>=16 localhost : :snmpd "sleep 30;<6"
www.bobo.com : inetd : bbd
www: inetdd : bbdd

add process you want to monitor localhost: YELLOW : RED

localhost: : ntpd syslogd winbind sshd


Change alert color to yellow for fping VPN outage
vi /usr/local/bbc/ext/fping.sh
search for COLOR="red"
three places change to COLOR="yellow"

---------------------------------------------------------------------------------

BB - Remove an alert when normal bbrm doesn't wor PART II

If they don’t go away you have to cd ../bbvar and remove them manually:

1. [bb@va-ash-bb01 ~]$ bbrm cbl-ca-vpn-sanols.conn
	Removing history host file: cbl-ca-vpn-sanols.conn
2. [bb@va-ash-bb01 ~]$ bbrm cbl-ca-vpn-sanols.conn
3. [bb@va-ash-bb01 ~]$ bbrm cbl-ca-vpn-houols.conn
	Removing history host file: cbl-ca-vpn-houols.conn
4. [bb@va-ash-bb01 ~]$ bbrm cbl-ca-vpn-houols.conn


[bb@va-ash-bb01 ~]$ cd ../bbvar			>> histlogs, hist, logs >>
1. [bb@va-ash-bb01 bbvar]$ rm -rf hist/cbl-ca-vpn-sanols.conn
2. [bb@va-ash-bb01 bbvar]$ rm -rf hist/cbl-ca-vpn-houols.conn
3. [bb@va-ash-bb01 bbvar]$ rm -rf histlogs/cbl-ca-vpn-sanols/conn/
4. [bb@va-ash-bb01 bbvar]$ rm -rf histlogs/cbl-ca-vpn-houols/conn/
5. [bb@va-ash-bb01 bbvar]$ rm -rf logs/cbl-ca-vpn-houols.conn 
6. [bb@va-ash-bb01 bbvar]$ rm -rf logs/cbl-va-vpn-houols.conn 



VPN Logs
1. cd /var/log on ca-sna-ns01
2. grep gal netdev.log | grep -i disconnected > gal.out 
3. for file in `ls netdev.log.*.gz`; do zgrep gal- $file | grep -i disconnected >> gal.out; done
 - or "zgrep gal- netdev.log*.gz | grep disconnected  >> gal.out"
4. sort -M gal.out > gal.out2
5. cat  gal.out2 |mail -s "gal logs"  steve.choo@mercurytechnology.com



FTP Acls

Standard mode:
c --> s permit tcp 20 and 21
c <-- s permit gt 1023
deny access to 5800 - 5999 and 6000 -6099 - as long as those ports are not already opened, put that above the gt 1023 acl

Pasv mode:
c --> s permit tcp 21 (sends PASV command)
c --> s permit gt 1023 (sends PORT command)
c <-- s permit gt 1023 est 

example (will allow both standard and pasv) - this in an inbound conn from an ct LAN
access-list 2226 permit tcp host 198.186.30.135 host 10.202.102.226 eq 20
access-list 2226 permit tcp host 198.186.30.135 host 10.202.102.226 eq 21
access-list 2226 permit tcp host 198.186.30.135 host 10.202.102.226 gt 1023

access-list 2227 permit tcp host 10.202.102.226 host 198.186.30.135 gt 1023

example of outbound from ct lan (passive mode only):
access-list 122 permit tcp host 164.109.34.220 host 10.201.103.19 gt 1023 est

access-list 123 permit tcp host 10.201.103.19 host 164.109.34.220 gt 1023
access-list 123 permit tcp host 10.201.103.19 host 164.109.34.220 eq 21

if going to an Internet host, be sure to allow port 21 outbound via custnet-in acl



Force a umount when -f doesnt work:
umount -l device




ACL's for New VS Server
va
permit ip from VM to VS
access-list 2140 permit ip host 10.202.101.233 host 10.202.102.254
permit ip from VS to VM
access-list 2141 permit ip host 10.202.102.254 host 10.202.101.233
permit ip from  VS to VM
access-list 104 permit ip host 10.202.102.254 host 10.202.101.233

ca
permit ip from VM to VS
access-list 166 permit ip host 10.201.99.5 host 172.16.66.126
permit ip from VS to VM
access-list 167 permit ip host 172.16.66.126 host 10.201.99.5
permit ip from  VS to VM
access-list 104 permit ip host 172.16.66.126 host 10.201.99.5

Oracle VM
Form the oracle VM manual – to resolve the state issue, ensure twd is still off  - before manually starting. Then log into va-ash-vm01 (NOTE **V**M**  not vs).

Vm_name = the server we are fixing twddb04 or whatever you named it in the VM

export ORACLE_HOME='/usr/lib/oracle/xe/app/oracle/product/10.2.0/server' 
export ORACLE_SID=XE 
$ORACLE_HOME/bin/sqlplus / as sysdba 
SQL> update ovs.ovs_vm_img t set t.status='Powered Off' where t.img_name like 'vm_name'; 
SQL> commit; 
SQL> quit

SQL> select img_name from ovs.ovs_vm_img;

IMG_NAME
--------------------------------------------------------------------------------
galapp02
galdb04
spcdb10
twddb02
twddb04
mundb04

6 rows selected.

SQL>

So your sql comman will be:

update ovs.ovs_vm_img t set t.status='Powered Off' where t.img_name like 'twddb04';

commit;

Connect to vm server via vnc: connect to vs server via ssh, then check the vm manager to see what port the vnc server is listening on for each vm host (click the server name to see). Then vnc to the vs server on the port that the vm host is listening.
Connect to vm server via console: on the vs server, do an "xm list". Then you can type "xm console server_ID"


PS Command
for top 15 process by percentage of memory

ps aux | head -1;ps aux | sort -nr -k 4 | head -16

to see virtual memory and real memory

ps aux --sort -vsz | head -16
ps aux --sort -rss | head -16


VRF
Telnet 192.168.194.3 /vrf ASG


Passwd change after next logon
chage -d 0 username


Oracle VM:
to restart repository - when ocfs2 partition dissappears
/opt/ovs-agent-2.3/utils/repos.py –init

reset the agent password
service ovs-agent configure

UP2DATE with a proxy
up2date --nox -u --proxy=10.202.215.226:8080 

up2date --nox --register


Printing - export/import

For RHEL4
Printconf-Tui: export and import
printconf-tui --Xexport >> printers.xml
printconf-tui --Ximport --merge < printers.xml


For RHEL5
[root@nsidb01 ~]# cd /etc
[root@nsidb01 etc]# service cups stop
Stopping cups: [  OK  ]
[root@nsidb01 etc]# tar -czvf cups.tar cups/


Remove all jobs for a particular printer:
lprm -P printername -
Remove all jobs for a particular user:
cancel -u username


Paul: enven though Heath turned out to be wrong and the gateway was the FW and not the rotuer
what i said about ICMP redirect to HP printers and XP machines is still valid
if a HP printer has a GW of .1 and there is a router at .2 to the MLS
MPLS
all traffic not local goes t othe GW
the GW sends an ICMP rediret to tell XP the real gw to MPLS is another local router
XP will never re-check that
Steve: makes sense
Paul: that was a big issue for ACF
when they fail over to VPN
their XP machines need to renew the IP
and printers rebooted
I think they finally added it to their process
Steve: good to know




Cisco Password Recovery

ASA 5500 Password recovery

Cisco Systems ROMMON Version (1.0(12)13) #0: Thu Aug 28 15:55:27 PDT 2008

Platform ASA5505
Ethernet0/0
MAC Address: 2894.0fd4.6074
Link is DOWN

Use BREAK or ESC to interrupt boot
<esc>

Use ? for help.
rommon #0> confreg

Current Configuration Register: 0x00000000
Configuration Summary: 
  boot ROMMON

Do you wish to change this configuration? y/n [n]: n

rommon #1> confreg 0x41

Update Config Register (0x41) in NVRAM...

rommon #2> boot

ciscoasa>ena
<enter>
ciscoasa#conf t
ciscoasa(config)# clear configure all
ciscoasa(config)# config-register 0x01
ciscoasa(config)# wr
ciscoasa(config)# reload


Procedure 1

Complete these steps in order to recover your password:

   1.

      Attach a terminal or PC with terminal emulation to the console port of the router.

      Use these terminal settings:
          *

            9600 baud rate
          *

            No parity
          *

            8 data bits
          *

            1 stop bit
          *

            No flow control

      Refer to these documents for information on how to cable and connect a terminal to the console port or the AUX port:
          *

            Cabling Guide for Console and AUX Ports
          *

            Connecting a Terminal to the Console Port on Catalyst Switches
          *

            Connect a Terminal to Catalyst 2948G-L3, 4908G-L3, and 4840G Series Switches
   2.

      If you can access the router, type show version at the prompt, and record the configuration register setting. See Example of Password Recovery Procedure in order to view the output of a show version command.

      Note: The configuration register is usually set to 0x2102 or 0x102. If you can no longer access the router (because of a lost login or TACACS password), you can safely assume that your configuration register is set to 0x2102.
   3.

      Use the power switch in order to turn off the router, and then turn the router back on.

      Important Notes:
          *

            In order to simulate this step on a Cisco 6400, pull out and then plug in the Node Route Processor (NRP) or Node Switch Processor (NSP) card.
          *

            In order to simulate this step on a Cisco 6x00 with NI-2, pull out and then plug in the NI-2 card.
   4.

      Press Break on the terminal keyboard within 60 seconds of power up in order to put the router into ROMmon.

      If the break sequence does not work, refer to Standard Break Key Sequence Combinations During Password Recovery for other key combinations.
   5.

      Type confreg 0x2142 at the rommon 1> prompt in order to boot from Flash.

      This step bypasses the startup configuration where the passwords are stored.
   6.

      Type reset at the rommon 2> prompt.

      The router reboots, but ignores the saved configuration.
   7.

      Type no after each setup question, or press Ctrl-C in order to skip the initial setup procedure.
   8.

      Type enable at the Router> prompt.

      You are in enable mode and should see the Router# prompt.
   9.

      Type configure memory or copy startup-config running-config in order to copy the nonvolatile RAM (NVRAM) into memory.

      warning Warning: Do not type copy running-config startup-config or write. These commands erase your startup configuration.
  10.

      Type show running-config.

      The show running-config command shows the configuration of the router. In this configuration, the shutdown command appears under all interfaces, which indicates all interfaces are currently shut down. In addition, the passwords (enable password, enable secret, vty, console passwords) are in either an encrypted or unencrypted format. You can reuse unencrypted passwords. You must change encrypted passwords to a new password.
  11.

      Type configure terminal.

      The hostname(config)# prompt appears.
  12.

      Type enable secret <password> in order to change the enable secret password. For example:

          hostname(config)#enable secret cisco

  13.

      Issue the no shutdown command on every interface that you use.

      If you issue a show ip interface brief command, every interface that you want to use should display up up.
  14.

      Type config-register <configuration_register_setting>. Where configuration_register_setting is either the value you recorded in step 2 or 0x2102 . For example:

          hostname(config)#config-register 0x2102

  15.

      Press Ctrl-z or end in order to leave the configuration mode.

      The hostname# prompt appears.
  16.

      Type write memory or copy running-config startup-config in order to commit the changes.

Procedure 2

Complete these steps in order to recover your password:

   1.

      Shut down the router.
   2.

      Remove the compact flash that is at the back of the router.
   3.

      Power on the router.
   4.

      Once the Rommon1> prompt appears, enter this command:

          confreg 0x2142

   5.

      Insert the compact flash.
   6.

      Type reset.
   7.

      When you are prompted to enter the initial configuration, type No, and press Enter.
   8.

      At the Router> prompt, type enable.
   9.

      At the Router# prompt, enter the configure memory command, and press Enter in order to copy the startup configuration to the running configuration.
  10.

      Use the config t command in order to enter global configuration mode.
  11.

      Use this command in order to create a new user name and password:

          router(config)#username cisco privilege 15 password
          		cisco

  12.

      Use this command in order to change the boot statement:

          config-register
          		0x2102

  13.

      Use this command in order to save the configuration:

          write
          	 memory

  14.

      Reload the router, and then use the new user name and password to log in to the router.






OPENMANAGE
omreport about
cd /home
mv serveradministrator serveradministrator5.4 or whatever version it is
tar -xvzf /mnt/patch/srvadmin6.2-rhel4.tgz or /mnt/patch/srvadmin-6.2-rhel5.tgz
cd serveradministrator/supportscripts/
./srvadmin-install.sh

if this fails because of dependancies, do this:
cd /home/serveradministrator5.4/supportscripts/
./srvadmin-uninstall.sh 
cd /home/serveradministrator/RPMS/supportRPMS/opensource-components/RHEL4
for file in `ls` ; do rpm -ihv $file; done
for file in `ls` ; do rpm -ihv $file; done

then try again:
cd /home/serveradministrator/supportscripts/
./srvadmin-install.sh

cp /usr/local/bbc/ext/bb-omsa-raid.sh /usr/local/bbc/ext/bb-omsa-raid.sh.bak
cp /mnt/patch/bb-omsa-raid.sh /usr/local/bbc/ext/

ln -s /opt/dell/srvadmin/bin/omreport /usr/bin/omreport
/opt/dell/srvadmin/bin/omconfig chassis info index=0 tag=

vi /etc/ntp.conf /etc/resolv.conf /etc/snmp/snmpd.conf

snmp.conf:
com2sec notConfigUser  default       mtgserver

service snmpd restart


RESTART OPENMANAGE:
1. cd /home/serveradministrator/linux/supportscripts
2. ./srvadmin-services.sh stop
3. ./srvadmin-services.sh start



su - bb
./runbb.sh stop
 ./runbb.sh start


verify BB RAID and Dell report correct for the server


Notes:

ntp.conf:

server ca-sna-ns01
restrict ca-sna-ns01 mask 255.255.255.255 nomodify notrap noquery
server va-ash-ns01
restrict va-ash-ns01 mask 255.255.255.255 nomodify notrap noquery



Server Updates:

1. DNS (/etc/resolv.conf): make sure the file resembles this:

domain aclines.com
nameserver 10.201.99.2
nameserver 10.202.101.226
options attempts:5
options timeout:15
search mercurytechnology.com aclines.com 

2. Samba (/etc/samba/smb.conf)

password server = 10.202.99.9 10.201.99.9
  idmap backend = ldap:"ldap://10.201.99.2,ldap://10.201.99.12,ldap://10.202.101.226" (for ca servers)
  idmap backend = ldap:"ldap://10.202.99.2,ldap://10.201.99.2,ldap://10.201.99.12" (for va servers)

3. SSH (/etc/ssh/sshd_config)

	AllowGroups users

* Comment out any "Deny" statements
* make sure all chroot accounts are in users group otherwise you will break them
* If you make changes, do a 'service sshd restart'


4. Services (copy/paste the following command on each server)

chkconfig pcmcia off;chkconfig iptables off;chkconfig isdn off;chkconfig  arptables_jf off;chkconfig  iiim off;chkconfig  canna off;chkconfig avahi-daemon off;chkconfig avahi-dnsconfd off;chkconfig bluetooth off;chkconfig rhnsd off;chkconfig hplip off;chkconfig hidd off;chkconfig yum-updatesd;chkconfig smartd off;chkconfig openwsmand off;chkconfig pcscd off;chkconfig haldaemon off; service haldaemon stop;pkill hald; mv /usr/sbin/hald /usr/sbin/hald.bak;service pcscd stop;chkconfig pcscd off


5. Upgrade Dell OM 6.3 on all >RHEL5.5 and latest version available on all RHEL5.5 and up.
* Make sure you do this after: 'ln -s /opt/dell/srvadmin/bin/omreport /usr/bin/omreport'

6. NTP (/etc/ntp.conf)

server ca-sna-ns01
restrict ca-sna-ns01 mask 255.255.255.255 nomodify notrap noquery server va-ash-ns01
server va-ash-ns01
restrict va-ash-ns01 mask 255.255.255.255 nomodify notrap noquery

7. SNMP (/etc/snmp/snmp.conf)

snmp.conf:
com2sec notConfigUser  default       mtgserver

service snmpd restart

8. Edit /etc/login.defs to setup password aging:

PASS_MAX_DAYS   90
PASS_MIN_DAYS   0
PASS_MIN_LEN    8
PASS_WARN_AGE   7

chage -M 90 username for all regular users


RHN/Oracle Up2date Stuff
When you get the error "This system has already been registered"
Do this;
[root@sridb02 rhn]# uuidgen 
b8275e08-825f-49b7-b863-d84095653c05
[root@sridb02 rhn]# vi up2date-uuid

uuid[comment]=Universally Unique ID for this server
rhnuuid=b8275e08-825f-49b7-b863-d84095653c05

and paste in the new uuid b8275e08-825f-49b7-b863-d84095653c05 replacing the old one



Using GZIP
the -x omits a file or directory. -9 is maximum compression, r is recursive
zip -9r `hostname -s`-`date +%F`-osw.zip /var/osw/archive /var/log/ -x /var/log/lastlog


Cisco ASA Upgrade Procedure
8.2 software is located on badger, tftp from 12.130.200.23
copy tftp disk0:/
To boot the new image:
boot system disk0:/asa824-1-k8.bin
Update asdm the same way, then delete the old asdm image
dir
delete disk0:/asdm-621.bin

From ct ASA copy startup config from badger:
copy the config file in txt format to /u01/cisco-backups
copy tftp start
12.130.200.23

Radius:
test aaa group radius mtgit crug$wrA port 1645 legacy
ca-sna-asa01# test aaa authentication MTG-DC username mtgit password crug$wrA
Server IP Address or name: 10.201.99.9 

Below are the commands for NTP, logging, DNS and RADIUS for routers and switches.

Routers and switches

aaa new-model
aaa authentication login MTG group radius line


radius-server host 10.202.99.9 auth-port 1645 acct-port 1646 key n0p@s$
radius-server host 10.202.99.4 auth-port 1645 acct-port 1646 key n0p@s$
radius-server host 10.201.99.4 auth-port 1645 acct-port 1646 key n0p@s$
radius-server host 10.201.99.9 auth-port 1645 acct-port 1646 key n0p@s$


Cisco AD Authentication

6509:
aaa new-model
!
!
aaa authentication login MTG group radius line

radius-server host 10.202.99.9 auth-port 1645 acct-port 1646 key n0p@s$
radius-server host 10.202.99.4 auth-port 1645 acct-port 1646 key n0p@s$
radius-server host 10.201.99.4 auth-port 1645 acct-port 1646 key n0p@s$
radius-server host 10.201.99.9 auth-port 1645 acct-port 1646 key n0p@s$


line vty 0 4
 login authentication MTG

line vty 5 15
 login authentication MTG



#ASA
aaa-server MTG-DC protocol radius
aaa authentication http console MTG-DC LOCAL
aaa authentication ssh console MTG-DC LOCAL
aaa authentication telnet console MTG-DC LOCAL
aaa authentication secure-http-client

ca-sna-asa03-att(config)# aaa-server MTG-DC (ATT) host 10.202.99.4
ca-sna-asa03-att(config-aaa-server-host)# key n0p@s$
ca-sna-asa03-att(config-aaa-server-host)# exit
ca-sna-asa03-att(config)# aaa-server MTG-DC (ATT) host 10.202.99.9
ca-sna-asa03-att(config-aaa-server-host)# key n0p@s$
ca-sna-asa03-att(config-aaa-server-host)# 

aaa-server MTG-DC protocol radius
no  aaa-server MTG-DC protocol radius

Setup Radius client on Windows server in Network Policy Server / IAS

Test it
va-ash-fwsm01# test aaa-server authentication MTG-DC host 10.201.99.4 username mtgit password crug$wrA
INFO: Attempting Authentication test to IP address <10.202.99.9> (timeout: 12 seconds)
INFO: Authentication Successful
va-ash-fwsm01# 


Cisco Local Authentication and local users
On 5505
aaa authentication ssh console LOCAL 
aaa authorization command LOCAL

username cust_user password Y4B*L2H^MgIR5qd7 privilege 3
username mtgit password jxFv*3RZs4H$jUM privilege 15

service-policy global_policy global
privilege show level 3 mode exec command running-config
privilege show level 3 mode exec command conn
prompt hostname context 


Cisco same-security traffic
same-security-traffic permit inter-interface
same-security-traffic permit intra-interface


Sh cisco asa failover serial number
failover exec standby sh inv


on 5510
aaa-server MTG-DC protocol radius
aaa-server MTG-DC (va-ash-custnet) host 10.202.90.44 n0p@s$
aaa-server MTG-DC (va-ash-custnet) host 10.202.90.4 n0p@s$
aaa authentication telnet console MTG-DC 
aaa authentication ssh console MTG-DC 
aaa authentication secure-http-client



YUM
yum erase samba
yum erase samba-common
yum install samba3x



.bash_profile
HOST=`/bin/hostname -s`
export PS1='$HOST:$PWD > '
export EDITOR=vi


Determine cause of High IO (io wait i/o wait)
I would use ps -auxww and look under the "Start" column to see what actual command has been running the longest.

Get the PID of that command and look for it in /proc

cd /proc/"PID"

then

watch 'ls -l fd' (Will actually show files being process in realtime)
I like to use watch instead of strace ( My eyes can't keep up with all the fast moving text

Maybe have a seperate xterm pulled up with iostat -d 2 (disk)and iostat -c 2 (cpu)


It will be cat and mouse for awhile but eventually you will find the culprit

Driver installs 
in RH is simple - download the driver, untar, run rpm -Uhv on the dkms and then rpm-Uhv on the megaraid rpm


TimeZone

Redhat procedure:

In order to change the timezone of your system you will need to access the file /etc/sysconfig/clock directly:

 
#ZONE="America/New_York"
ZONE="GMT"
UTC=false
ARC=false
Note: If your system's BIOS has UTC set to true, then set UTC to true. If it has it set to false, set it to false. UTC in the configuration file must always reflect your BIOS settings.

In order to get the particular zone you wish to use you must associate ZONE with a file located in /usr/share/zoneinfo. It is wise to note the directory structure because if you need to set the timezone to that of Shanghai which is located in the Asia directory you will then have to set your ZONE variable to the following :

ZONE="Asia/Shanghai"
Or perhaps you need to set the timezone to that of East Brazil :
ZONE="Brazil/East"
Finally save the file /etc/sysconfig/clock and on next reboot the system will be set to the defined timezone.

For the time on the machine to reflect the change timezone we need to link the zoneinfo file to /etc/localtime. This can be done as follows :

If you are setting your timezone to "Brazil/East" link the following file to /etc/localtime :
# ln -sf /usr/share/zoneinfo/Brazil/East /etc/localtime
Now by typing the date command to display the time you should see if reflect the newly linked timezone :
 # date
Thu Sep 30 10:06:23 BRT 2004

Other Linux
Set timezone to PDT:
$ export TZ=America/Los_Angeles
$ date

[root@esiapp03 ~]# mv /etc/localtime  /etc/localtime-old
[root@esiapp03 ~]# ln -sf /usr/share/zoneinfo/US/Mountain /etc/localtime
[root@esiapp03 ~]# date
Thu Mar 31 16:20:32 MDT 2011
[root@esiapp03 ~]# hwclock --systohc
[root@esiapp03 ~]# date
Thu Mar 31 16:20:41 MDT 2011
[root@esiapp03 ~]# vi /etc/sysconfig/clock


# Logged in as root, check which timezone your machine is currently using by executing `date`. You'll see something like Mon 17 Jan 2005 12:15:08 PM PST, PST in this case is the current timezone.
#
3
Change to the directory /usr/share/zoneinfo here you will find a list of time zone regions. Choose the most appropriate region, if you live in Canada or the US this directory is the "America" directory.
#
4
If you wish, backup the previous timezone configuration by copying it to a different location. Such as

mv /etc/localtime  /etc/localtime-old

#
5
Create a symbolic link to the appropriate timezone from /etc/localtime. Example:

ln -sf /usr/share/zoneinfo/Europe/Amsterdam /etc/localtime 

#
6
If you have the utility rdate, update the current system time by executing

/usr/bin/rdate -s time-a.nist.gov

#
7
Set the ZONE entry in the file /etc/sysconfig/clock file (e.g. "America/Los_Angeles")
#
8
Set the hardware clock by executing:

/sbin/hwclock --systohc



Remount a FS as rw
mount -0 remount, rw /filesystem

LVM:
10.	Create VM Volume group for root: use a descriptive name: i.e. "VG_ SERVERNAME _OS" 
	vgcreate VG_ SERVERNAME _OS /dev/sda7
11.	Create VM Volume Group for U01: use a descriptive name: i.e. "VG_ SERVERNAME _U01" 
	vgcreate VG_ SERVERNAME _OS /dev/sda8
12.	Create VM /var logical volume: 
	lvcreate /dev/VG_SERVERNAME_OS -n Log_Vol_Var -L 10G

13.	Create VM /root logical Volume for root, boot, home, usr
	lvcreate /dev/VG_SERVERNAME_OS -n Log_Vol_Root -l 100%FREE

14.	Create VM /u01 Logical Volume
	lvcreate /dev/VG_SERVERNAME_U01 -n Log_VolU01 -l 90%FREE


Snapshots
/usr/sbin/lvs --noheadings --separator , -o lv_name,origin,snap_percent


Netbackup
Look up netbackup bp_end and bp_end scripts.

They are on each client. When a backup starts on a client, is looks for a bp_start script that matches the policy. If found, it runs the script and then starts the backup.

Bp_start.POLICYNAME

When a backup finishes on the client, it looks for a bp_end script on the client. If found, it runs it.

Bp_end.POLICYNAME

Start and end scripts are on the client. Master and media servers are also clients if backing up local data.

Scripts are in /usr/openv/netbackup/bin

Admin guides for netbackup are in the mtg IT vendor folder.




/usr/openv/netbackup/bin on ns server
edit the bpend files

Netbackup Purging

**** bpend_notify.va-ash-ns02_u01
#!/bin/ksh
# ================================================================================
# Change History:
# ================================================================================

DAYS=5

PURGE_DIR="/u01/backup/MTG/netbackup"

# Find ALL Veritas Netbackup Disk backups files older than 5 days and delete them
/bin/date > /root/logs/u08-purge.log
echo "\n--------- Purging hot backup directories from $PURGE_DIR older than $DAYS days ...\n" >> /root/l
ogs/u08-purge.log

/bin/df -hl /u01
echo "find $PURGE_DIR -type f -mtime +$DAYS -ls" >> /root/logs/u01-purge.log
      find $PURGE_DIR -type f -mtime +$DAYS -ls >> /root/logs/u01-purge.log
      find $PURGE_DIR -type f -mtime +$DAYS -print | xargs rm -rf





ntp server 10.201.99.2
ntp server 10.202.99.2
clock timezone PST -8
clock summer-time PDT recurring 
show clock        


ip domain-name mercurytechnology.com

ip domain lookup

ip  name-server 10.201.99.2
ip  name-server 10.202.99.2

crypto key generate rsa      

 !--- use 1024 on the key


ip ssh time-out 60
ip ssh authentication-retries 2


line vty 0 15

login authentication MTG
transport input ssh


logging on
logging monitor informational
logging history informational
logging facility local6






Rsync
[root@acldb01 ~]# vi /etc/xinetd.d/rsync 

# default: off
# description: The rsync server is a good addition to an ftp server, as it \
#       allows crc checksumming etc.
service rsync
{
        disable = no
        socket_type     = stream
        wait            = no
        user            = root
        server          = /usr/bin/rsync
        server_args     = --daemon
        log_on_failure  += USERID
}

Change disable = yes to no

Verify settings in /etc/rsyncd.conf (set hosts allow IP address and shared data dir for sync client)

Restart xinetd.d (service xinetd restart)

example or rsync config:
[root@sriapp01 boot]# vi /etc/rsyncd.conf 

max connections = 6
log file = /var/log/rsync.log
timeout = 300

[u01_applprd]
comment = shared data stored here
path = /u01
read only = true # chg to true if you want read only
list = no
uid = applprd
gid = dbaprd
#auth users = adminname
#secrets file = /etc/rsyncd.secrets
hosts allow = 10.201.103.98

[u01_applobip]
comment = shared data stored here
path = /u01
read only = true # chg to true if you want read only
list = no
uid = applobip
gid = dbaobi
#auth users = adminname
#secrets file = /etc/rsyncd.secrets
hosts allow = 10.201.103.98

Once we have rsync server setup, we can run rsync client from a client machine. To run a particular target defined in the /etc/rsyncd.conf configuration file, you will run rsync in the following manner: 


bash# rsync -a scott@rsync_server::target /opt/rsync/backup 

Password: ****** 

FAQ: How to you bypass password prompt? 
If you wish to automate rsync with cron, you must bypass password prompt. If you're running rsync on TCP port 873, you may use RSYNC_PASSWORD environment variable. Just write a simple bash script that sets the RSYNC_PASSWORD variable just before invoking the rsync command as shown below. When you're supplying clear-text password in a file, it's important to protect your file with a permission mode of (chmod 600) so that no one except for you (an root) can see it. 


#!/bin/bash 
RSYNC="/usr/bin/rsync -a --delete" 
export RSYNC_PASSWORD=helloworld 

$RSYNC scott@192.168.0.2::target /path/to/local/filesystem 



Paul's rsync method using script instead of the xinetd rsync service:


crontab entry for rsync
41 19,23,03,06,10,15 * * * /root/bin/u01-copy.sh >> /root/logs/run_rsync.cron.log 2>&1

/root/bin/u01-copy.sh script contents:

#!/bin/ksh

MAIL=root

LOGFILE=/root/logs/sync.$(date +%y%b%d)

for FS in /u01 ; do
  echo "\n-------------------- $FS ----------------------\n" >> $LOGFILE
  cd $FS
  /usr/bin/rsync -avlz --delete --exclude 'nite/' /u01_app21/ /u01 >> $LOGFILE 2>/dev/null#done

cat $LOGFILE | mail -s "snoapp21_new rsync" $MAIL

























RAMSAN

To check that the RamSan hardware has been properly identified by the operating system, run:
lspci -D -d 15b6:
If the hardware is correctly installed, the output should be similar to:
0000:07:00.0 FLASH memory: Texas Memory Systems Inc RamSan-70 Flash SSD (rev 05)

There are three RPMs that must be installed in order: driver, utils, then firmware. Run the
following command to install a RamSan package:

To rebuild for newer kernel:
cd /root/ cd RAMSAN.DRIVER/
rpmbuild --rebuild tms-rsXX-driver-3.1.0.2-520.x86_64.src.rpm

	*** output from above will show you the two RPM packages it creates, for me the packages are listed below.

rpm -Uhv /usr/src/redhat/RPMS/x86_64/tms-rsXX-driver-3.1.0.2-520.2.6.32.x86_64.rpm
rpm -Uhv /usr/src/redhat/RPMS/x86_64/tms-rsXX-driver-debuginfo-3.1.0.2-520.2.6.32.x86_64.rpm


Old Card
  285  rpm -ivh tms-rs-2.1.0.3-2540.2.6.18.x86_64.rpm 
  286  lspci | grep "Texas Memory Systems"
  287  rpm -q tms-rs
  288  /opt/texmemsys/tms-rs/bin/rsvalidate -gw
  289  cd /opt/texmemsys/tms-rs/bin/
  290  ls
  291  cd /dev/rs20
  292  rpm -e tms-rs-2.1.0.3-2540.2.6.18.x86_64
  293  ls
  294  cd /root
  295  ls
  296  rpm -ivh tms-rs-2.1.0.3-2540.2.6.18.x86_64.rpm 
  297  ls /dev
  298  cd /dev/tms-rs/
  299  ls
  300  /opt/texmemsys/tms-rs/bin/rsvalidate -gw
  301  ls
  302  cd 5.0.0 
  303  cd /
  304  mkfs.ext4 /dev/tms-rs/5.0.0


If you upgrade the kernel to 2.6.32 you will need to remove the tms-rs package currently installed, and then rebuild the source rpm.  To do this, run the following commands:

1. Uninstall the rpm currently installed:
# rpm -ev tms-rs

2. Navigate to the /tms_cdrom/linux/rhel_5 directory and run this command using the source rpm: *(please make sure you have the kernel-devel and kernel-headers installed before running the rpmbuild command.)
# rpmbuild --rebuild tms-rs-2.1.0.3-2540.x86_64.src.rpm

Look for the 'wrote: .../*.rpm' near the bottom of the output. That is the binary to install.
cd into that directory and install the binary rpm:
# rpm -ihv <binary_rpm>

Watch the output and wait for the prompt to completely shutdown the server.
After you shutdown the server, wait 20 seconds and power-on.  The server should register the RamSan-20 and make it available in /dev/tms-rs/




Fixing the NFS "authenticated mount request issue"

first try: mount -o nolock /mount/point

On the exporting server, put these lines in the /etc/fstab file:

nfsd /proc/fs/nfsd nfsd auto,defaults 0 0
sunrpc /var/lib/nfs/rpc_pipefs rpc_pipefs auto,defaults 0 0

Then "mount -a"

On client mount -t nfs


Bonding

[root@oratestdb ~]# modprobe bonding
[root@oratestdb ~]# less /proc/net/bonding/bond0

NIC bonding procedure
Multiple bonding setup is different for Red Hat Enterprise Linux 4 and Red Hat Enterprise Linux 5.

For Red Hat Enterprise Linux 5:
In Red Hat Enterprise Linux 5.3 (or update to initscripts-8.45.25-1.el5) and later, configuring multiple bonding channels is similar to configuring a single bonding channel. Setup the ifcfg-bondN and ifcfg-ethX files as if there were only one bonding channel. You can specify different BONDING_OPTS for different bonding channels so that they can have different mode and other settings.
For example, you can add the following line to /etc/modprobe.conf:
Code:

alias bond0 bonding
alias bond1 bonding

And here is an example for ifcfg-bond0 and ifcfg-bond1:

Code:

ifcfg-bond0:
DEVICE=bond0
IPADDR=192.168.50.111
NETMASK=255.255.255.0
USERCTL=no
BOOTPROTO=none
ONBOOT=yes
BONDING_OPTS="mode=0 miimon=100"


For example, you can add the following line to /etc/modprobe.conf:
[CODE]
alias bond0 bonding
alias bond1 bonding

And here is an example for ifcfg-bond0 and ifcfg-bond1:
Code:

ifcfg-bond0:
DEVICE=bond0
IPADDR=192.168.50.111
NETMASK=255.255.255.0
USERCTL=no
BOOTPROTO=none
ONBOOT=yes
BONDING_OPTS="mode=0 miimon=100"
ifcfg-bond1:
DEVICE=bond1
IPADDR=192.168.30.111
NETMASK=255.255.255.0
USERCTL=no
BOOTPROTO=none
ONBOOT=yes
BONDING_OPTS="mode=1 miimon=50"


For Red Hat Enterprise Linux 4 (doesn't actually work, but it's a start):
To configure multiple bonding channels, first setup the ifcfg-bondN and ifcfg-ethX files as if there were only one bonding channel.
The change comes in setting up /etc/modprobe.conf. If the two bonding channels have the same bonding option, such as bonding mode, monitoring frequency, etc, add the max_bonds option. For example:

Code:

alias bond0 bonding
alias bond1 bonding
options bonding max_bonds=2 mode=balance-rr miimon=100

If the two bonding channels have different bonding options (for example, one is using round-robin mode and one is using active-backup mode), the bonding modules have to load twice with different options. For example, in /etc/modprobe.conf (don't use the max_bonds option):

Code:

install bond0 /sbin/modprobe --ignore-install bonding -o bond0 mode=0 miimon=100 primary=eth0
install bond1 /sbin/modprobe --ignore-install bonding -o bond1 mode=1 miimon=50 primary=eth2


do a 
modprobe bonding
service network restart

or a reboot

Boot by UUID
Get the UUID of the device:

ls -l /dev/disk/by-uuid/  or
tunefs.ocfs2 -Q "%U \n" /dev/whatever or
blkid

add the output to /etc/fstab
UUID=output*
you will need to add - after the first 8 char, then 4 char, 4 char, 4char. Remaining char should be 12
Also, make sure all letters lowercase
Example:
UUID=bbd253f6-5dd5-4bff-a4de-be882c70ff2a       /u01/prd/prdintf                  ocfs2   _netdev 0 0



Cd /etc/blkid

Fs was in readonly so I had to do this:

mount –o remount, rw /

Mv blkid.tab blkid.tab.bak113





This server has 24GB RAM however, 32 bit OS can only address 4GB RAM. 

Memory beyond 4GB is mapped through virtual memory

OOM killer happens for three technical reasons:

1. No more pages are available in the VM. 
2. No more user address space is available. 
3. Both #1 and #2. 


Misc. TAR
Tar up one partition and untar to another (clone partition):
mount both partitions to something, then cd to the one you want to clone:
tar -cvzf - . | ( cd /mnt/xxx; tar -xvzf - )
tar -cvf - . | ( cd /new.dir; tar -xvf - )

Tar up a dir:
cd /dir (the one you want to back up)
tar -cvzf /mnt/backup/name.tar *

so let’s say db11 /mnt/tmp is mounted to db10 /u01
on db11, cd to /mnt/tmp
tar –czvf - . | (cd /u01; tar –xzvf - )



Mount an ocfs2 image file
lomount -diskimage Shared_VD01.img -partition 1 /mnt/tmp





IPERF
Iperf can be downloaded from http://iperf.sourceforge.net/  I have attached a zip file with the windows exe.
We have a server process running on port 8000 of pomdb02. To connect use: iperf.exe -c pomdb02 -b 1M -p 8000.  –b is the bandwidth command. We can start at 1and work our way up.
Please let me know if you have any questions.

We run a server process on our server:

iperf -s -u -i 1 –p NNNN

NNNN=port


from the client:


iperf.exe -c pomdb02 -b 1M -p NNNN

M=Mbps can set to what ever you need for testing

Ping testing with do-not-fragment set
ping -s 1410 ixaapp03 -M do

./iperf -c 10.202.102.178 -p 5001 -b 3M


Webpage article http://iperf.fr/#tuningtcp


 French forum for Iperf

What is Iperf?

While tools to measure network performance. Iperf was orginally developed by NLANR/DAST as a modern alternative for measuring TCP and UDP bandwidth performance.

Iperf is a tool to measure maximum TCP bandwidth, allowing the tuning of various parameters and UDP characteristics. Iperf reports bandwidth, delay jitter, datagram loss.


Iperf features

TCP
Measure bandwidth
Report MSS/MTU size and observed read sizes.
Support for TCP window size via socket buffers.
Multi-threaded if pthreads or Win32 threads are available. Client and server can have multiple simultaneous connections.
UDP
Client can create UDP streams of specified bandwidth.
Measure packet loss
Measure delay jitter
Multicast capable
Multi-threaded if pthreads are available. Client and server can have multiple simultaneous connections. (This doesn't work in Windows.)

Tuning a TCP connection

The primary goal of Iperf is to help in tuning TCP connections over a particular path. The most fundamental tuning issue for TCP is the TCP window size, which controls how much data can be in the network at any one point. If it is too small, the sender will be idle at times and get poor performance. The theoretical value to use for the TCP window size is the bandwidth delay product,
bottleneck bandwidth * round trip time
In the below modi4/cyclops example, the bottleneck link is a 45 Mbit/sec DS3 link and the round trip time measured with ping is 42 ms. The bandwidth delay product is
45 Mbit/sec * 42 ms 
= (45e6) * (42e-3) 
= 1890000 bits 
= 230 KByte
That is a starting point for figuring the best window size; setting it higher or lower may produce better results. In our example, buffer sizes over 130K did not improve the performance, despite the bandwidth delay product of 230K.
Note that many OSes and hosts have upper limits on the TCP window size. These may be as low as 64 KB, or as high as several MB. Iperf tries to detect when these occur and give a warning that the actual and requested window sizes are not equal (as below, though that is due to rounding in IRIX). PSC has a list detailing how to change the default and maximum window sizes for various OSes. For more information on TCP window sizes, see the LaFibre.info.

Here is an example session, between node1 in Illinois and node2 in North Carolina. These are connected via the vBNS backbone and a 45 Mbit/sec DS3 link. Notice we improve bandwidth performance by a factor of 3 using proper TCP window sizes. Use the adaptive window sizes feature on platforms which allow setting window sizes in the granularity of bytes.

node2> iperf -s
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 60.0 KByte (default)
------------------------------------------------------------
[  4] local <IP Addr node2> port 5001 connected with <IP Addr node1> port 2357
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0-10.1 sec   6.5 MBytes   5.2 Mbits/sec

node1> iperf -c node2
------------------------------------------------------------
Client connecting to node1, TCP port 5001
TCP window size: 59.9 KByte (default)
------------------------------------------------------------
[  3] local <IP Addr node1> port 2357 connected with <IP Addr node2> port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0-10.0 sec   6.5 MBytes   5.2 Mbits/sec
node2> iperf -s -w 130k
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size:  130 KByte
------------------------------------------------------------
[  4] local <IP Addr node 2> port 5001 connected with <IP Addr node 1> port 2530
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0-10.1 sec  19.7 MBytes  15.7 Mbits/sec

node1> iperf -c node2 -w 130k
------------------------------------------------------------
Client connecting to node2, TCP port 5001
TCP window size:  129 KByte (WARNING: requested  130 KByte)
------------------------------------------------------------
[  3] local <IP Addr node1> port 2530 connected with <IP Addr node2> port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0-10.0 sec  19.7 MBytes  15.8 Mbits/sec
Another test to do is run parallel TCP streams. If the total aggregate bandwidth is more than what an individual stream gets, something is wrong. Either the TCP window size is too small, or the OS's TCP implementation has bugs, or the network itself has deficiencies. See above for TCP window sizes; otherwise diagnosing which is somewhat difficult. If Iperf is compiled with pthreads, a single client and server can test this, otherwise setup multiple clients and servers on different ports. Here's an example where a single stream gets 16.5 Mbit/sec, but two parallel streams together get 16.7 + 9.4 = 26.1 Mbit/sec, even when using large TCP window sizes:
node2> iperf -s -w 300k
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size:  300 KByte
------------------------------------------------------------
[  4] local <IP Addr node2> port 5001 connected with <IP Addr node1> port 6902
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0-10.2 sec  20.9 MBytes  16.5 Mbits/sec

[  4] local <IP Addr node2> port 5001 connected with <IP Addr node1> port 6911
[  5] local <IP Addr node2> port 5001 connected with <IP Addr node2> port 6912
[ ID] Interval       Transfer     Bandwidth
[  5]  0.0-10.1 sec  21.0 MBytes  16.7 Mbits/sec
[  4]  0.0-10.3 sec  12.0 MBytes   9.4 Mbits/sec

node1> ./iperf -c node2 -w 300k
------------------------------------------------------------
Client connecting to node2, TCP port 5001
TCP window size:  299 KByte (WARNING: requested  300 KByte)
------------------------------------------------------------
[  3] local <IP Addr node2> port 6902 connected with <IP Addr node1> port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0-10.2 sec  20.9 MBytes  16.4 Mbits/sec

node1> iperf -c node2 -w 300k -P 2
------------------------------------------------------------
Client connecting to node2, TCP port 5001
TCP window size:  299 KByte (WARNING: requested  300 KByte)
------------------------------------------------------------
[  4] local <IP Addr node2> port 6912 connected with <IP Addr node1> port 5001
[  3] local <IP Addr node2> port 6911 connected with <IP Addr node1> port 5001
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0-10.1 sec  21.0 MBytes  16.6 Mbits/sec
[  3]  0.0-10.2 sec  12.0 MBytes   9.4 Mbits/sec
A secondary tuning issue for TCP is the maximum transmission unit (MTU). To be most effective, both hosts should support Path MTU Discovery. PSC has a list detailing what OSes support Path MTU Discovery. Hosts without Path MTU Discovery often use 536 as the MSS, which wastes bandwidth and processing time. Use the -m option to display what MSS is being used, and see if this matches what you expect. Often it is around 1460 bytes for ethernet.
node3> iperf -s -m
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 60.0 KByte (default)
------------------------------------------------------------
[  4] local <IP Addr node3> port 5001 connected with <IP Addr node4> port 1096
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0- 2.0 sec   1.8 MBytes   6.9 Mbits/sec
[  4] MSS size 1448 bytes (MTU 1500 bytes, ethernet)
[  4] Read lengths occurring in more than 5% of reads:
[  4]   952 bytes read   219 times (16.2%)
[  4]  1448 bytes read  1128 times (83.6%)
Here is a host that doesn't support Path MTU Discovery. It will only send and receive small 576 byte packets.
node4> iperf -s -m
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 32.0 KByte (default)
------------------------------------------------------------
[  4] local <IP Addr node4> port 5001 connected with <IP Addr node3> port 13914
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0- 2.3 sec   632 KBytes   2.1 Mbits/sec
WARNING: Path MTU Discovery may not be enabled.
[  4] MSS size 536 bytes (MTU 576 bytes, minimum)
[  4] Read lengths occurring in more than 5% of reads:
[  4]   536 bytes read   308 times (58.4%)
[  4]  1072 bytes read    91 times (17.3%)
[  4]  1608 bytes read    29 times (5.5%)
Iperf supports other tuning options, which were added for exceptional network situations like HIPPI-to-HIPPI over ATM. 
Tuning a UDP connection

Iperf creates a constant bit rate UDP stream. This is a very artificial stream, similar to voice communication but not much else.
You will want to adjust the datagram size (-l) to the size your application uses.

The server detects UDP datagram loss by ID numbers in the datagrams. Usually a UDP datagram becomes several IP packets. Losing a single IP packet will lose the entire datagram. To measure packet loss instead of datagram loss, make the datagrams small enough to fit into a single packet, using the -l option. The default size of 1470 bytes works for ethernet. Out-of-order packets are also detected. (Out-of-order packets cause some ambiguity in the lost packet count; Iperf assumes they are not duplicate packets, so they are excluded from the lost packet count.) Since TCP does not report loss to the user, I find UDP tests helpful to see packet loss along a path.

Jitter calculations are continuously computed by the server, as specified by RTP in RFC 1889. The client records a 64 bit second/microsecond timestamp in the packet. The server computes the relative transit time as (server's receive time - client's send time). The client's and server's clocks do not need to be synchronized; any difference is subtracted out in the jitter calculation. Jitter is the smoothed mean of differences between consecutive transit times.

node2> iperf -s -u -i 1
------------------------------------------------------------
Server listening on UDP port 5001
Receiving 1470 byte datagrams
UDP buffer size: 60.0 KByte (default)
------------------------------------------------------------
[  4] local <IP Addr node2> port 5001 connected with <IP Addr node1> port 9726
[ ID] Interval       Transfer     Bandwidth       Jitter   Lost/Total Datagrams
[  4]  0.0- 1.0 sec   1.3 MBytes  10.0 Mbits/sec  0.209 ms    1/  894 (0.11%)
[  4]  1.0- 2.0 sec   1.3 MBytes  10.0 Mbits/sec  0.221 ms    0/  892 (0%)
[  4]  2.0- 3.0 sec   1.3 MBytes  10.0 Mbits/sec  0.277 ms    0/  892 (0%)
[  4]  3.0- 4.0 sec   1.3 MBytes  10.0 Mbits/sec  0.359 ms    0/  893 (0%)
[  4]  4.0- 5.0 sec   1.3 MBytes  10.0 Mbits/sec  0.251 ms    0/  892 (0%)
[  4]  5.0- 6.0 sec   1.3 MBytes  10.0 Mbits/sec  0.215 ms    0/  892 (0%)
[  4]  6.0- 7.0 sec   1.3 MBytes  10.0 Mbits/sec  0.325 ms    0/  892 (0%)
[  4]  7.0- 8.0 sec   1.3 MBytes  10.0 Mbits/sec  0.254 ms    0/  892 (0%)
[  4]  8.0- 9.0 sec   1.3 MBytes  10.0 Mbits/sec  0.282 ms    0/  892 (0%)
[  4]  0.0-10.0 sec  12.5 MBytes  10.0 Mbits/sec  0.243 ms    1/ 8922 (0.011%)

node1> iperf -c node2 -u -b 10m
------------------------------------------------------------
Client connecting to node2, UDP port 5001
Sending 1470 byte datagrams
UDP buffer size: 60.0 KByte (default)
------------------------------------------------------------
[  3] local <IP Addr node1> port 9726 connected with <IP Addr node2> port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0-10.0 sec  12.5 MBytes  10.0 Mbits/sec
[  3] Sent 8922 datagrams
Notice the higher jitter due to datagram reassembly when using larger 32 KB datagrams, each split into 23 packets of 1500 bytes. The higher datagram loss seen here may be due to the burstiness of the traffic, which is 23 back-to-back packets and then a long pause, rather than evenly spaced individual packets.
node2> iperf -s -u -l 32k -w 128k -i 1
------------------------------------------------------------
Server listening on UDP port 5001
Receiving 32768 byte datagrams
UDP buffer size:  128 KByte
------------------------------------------------------------
[  3] local <IP Addr node2> port 5001 connected with <IP Addr node1> port 11303
[ ID] Interval       Transfer     Bandwidth       Jitter   Lost/Total Datagrams
[  3]  0.0- 1.0 sec   1.3 MBytes  10.0 Mbits/sec  0.430 ms    0/   41 (0%)
[  3]  1.0- 2.0 sec   1.1 MBytes   8.5 Mbits/sec  5.996 ms    6/   40 (15%)
[  3]  2.0- 3.0 sec   1.2 MBytes   9.7 Mbits/sec  0.796 ms    1/   40 (2.5%)
[  3]  3.0- 4.0 sec   1.2 MBytes  10.0 Mbits/sec  0.403 ms    0/   40 (0%)
[  3]  4.0- 5.0 sec   1.2 MBytes  10.0 Mbits/sec  0.448 ms    0/   40 (0%)
[  3]  5.0- 6.0 sec   1.2 MBytes  10.0 Mbits/sec  0.464 ms    0/   40 (0%)
[  3]  6.0- 7.0 sec   1.2 MBytes  10.0 Mbits/sec  0.442 ms    0/   40 (0%)
[  3]  7.0- 8.0 sec   1.2 MBytes  10.0 Mbits/sec  0.342 ms    0/   40 (0%)
[  3]  8.0- 9.0 sec   1.2 MBytes  10.0 Mbits/sec  0.431 ms    0/   40 (0%)
[  3]  9.0-10.0 sec   1.2 MBytes  10.0 Mbits/sec  0.407 ms    0/   40 (0%)
[  3]  0.0-10.0 sec  12.3 MBytes   9.8 Mbits/sec  0.407 ms    7/  401 (1.7%)

node1> iperf -c node2 -b 10m -l 32k -w 128k
------------------------------------------------------------
Client connecting to node2, UDP port 5001
Sending 32768 byte datagrams
UDP buffer size:  128 KByte
------------------------------------------------------------
[  3] local <IP Addr node2> port 11303 connected with <IP Addr node1> port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0-10.0 sec  12.5 MBytes  10.0 Mbits/sec
[  3] Sent 401 datagrams
Multicast

To test multicast, run several servers with the bind option (-B, --bind) set to the multicast group address. Run the client, connecting to the multicast group address and setting the TTL (-T, --ttl) as needed. Unlike normal TCP and UDP tests, multicast servers may be started after the client. In that case, datagrams sent before the server started show up as losses in the first periodic report (61 datagrams on arno below).

node5> iperf -c 224.0.67.67 -u --ttl 5 -t 5
------------------------------------------------------------
Client connecting to 224.0.67.67, UDP port 5001
Sending 1470 byte datagrams
Setting multicast TTL to 5
UDP buffer size: 32.0 KByte (default)
------------------------------------------------------------
[  3] local <IP Addr node5> port 1025 connected with 224.0.67.67 port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0- 5.0 sec   642 KBytes   1.0 Mbits/sec
[  3] Sent 447 datagrams

node5> iperf -s -u -B 224.0.67.67 -i 1
------------------------------------------------------------
Server listening on UDP port 5001
Binding to local address 224.0.67.67
Joining multicast group  224.0.67.67
Receiving 1470 byte datagrams
UDP buffer size: 32.0 KByte (default)
------------------------------------------------------------
[  3] local 224.0.67.67 port 5001 connected with <IP Addr node5> port 1025
[ ID] Interval       Transfer     Bandwidth       Jitter   Lost/Total Datagrams
[  3]  0.0- 1.0 sec   131 KBytes   1.0 Mbits/sec  0.007 ms    0/   91 (0%)
[  3]  1.0- 2.0 sec   128 KBytes   1.0 Mbits/sec  0.008 ms    0/   89 (0%)
[  3]  2.0- 3.0 sec   128 KBytes   1.0 Mbits/sec  0.010 ms    0/   89 (0%)
[  3]  3.0- 4.0 sec   128 KBytes   1.0 Mbits/sec  0.013 ms    0/   89 (0%)
[  3]  4.0- 5.0 sec   128 KBytes   1.0 Mbits/sec  0.008 ms    0/   89 (0%)
[  3]  0.0- 5.0 sec   642 KBytes   1.0 Mbits/sec  0.008 ms    0/  447 (0%)

node6> iperf -s -u -B 224.0.67.67 -i 1
------------------------------------------------------------
Server listening on UDP port 5001
Binding to local address 224.0.67.67
Joining multicast group  224.0.67.67
Receiving 1470 byte datagrams
UDP buffer size: 60.0 KByte (default)
------------------------------------------------------------
[  3] local 224.0.67.67 port 5001 connected with <IP Addr node5> port 1025
[ ID] Interval       Transfer     Bandwidth       Jitter   Lost/Total Datagrams
[  3]  0.0- 1.0 sec   129 KBytes   1.0 Mbits/sec  0.778 ms   61/  151 (40%)
[  3]  1.0- 2.0 sec   128 KBytes   1.0 Mbits/sec  0.236 ms    0/   89 (0%)
[  3]  2.0- 3.0 sec   128 KBytes   1.0 Mbits/sec  0.264 ms    0/   89 (0%)
[  3]  3.0- 4.0 sec   128 KBytes   1.0 Mbits/sec  0.248 ms    0/   89 (0%)
[  3]  0.0- 4.3 sec   554 KBytes   1.0 Mbits/sec  0.298 ms   61/  447 (14%)
Start multiple clients or servers as explained above, sending data to the same multicast server. (If you have multiple servers listening on the multicast address, each of the servers will be getting the data)







System Auth
Uname -a if 64-bit

1.	Backup system-auth file. 
	a.	Delete contents of system-auth file
	b.	Copy from good source, paste into empty file 
2.	Stop winbind service
3.	Cd into /var/log/cache/samba
	a.	Mkdir bak
b.	Mv all *.tdb files to the bak directory
	c.	Rm winbind_privileged/pipe file
4.	Run net ads join
5.	Set smbpasswd
6.	Start winbind service 
7.	Test getent passwd username (AD username)


Good system-auth 64-bit :

# This file is auto-generated.
# User changes will be destroyed the next time authconfig is run.
auth        required      pam_env.so
auth        sufficient    pam_unix.so nullok try_first_pass
auth        sufficient    pam_winbind.so use_first_pass
auth        required      pam_deny.so
#
account     required      pam_unix.so
account     sufficient    pam_succeed_if.so uid < 100 quiet
account     sufficient    pam_succeed_if.so uid < 3003
account     [default=bad success=ok user_unknown=ignore] pam_winbind.so
account     required    pam_succeed_if.so user ingroup CORP+SRI
#
password    required      pam_cracklib.so retry=3 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1
password    sufficient    pam_unix.so nullok use_authtok md5 shadow remember=10
password    sufficient    pam_krb5.so use_authtok
password    required      pam_deny.so

session     required      pam_limits.so
session     required      pam_unix.so
session     optional      pam_krb5.so

Good system-auth 32-bit:

#%PAM-1.0
# This file is auto-generated.
# User changes will be destroyed the next time authconfig is run.
auth        required      /lib/security/$ISA/pam_env.so
auth        sufficient    /lib/security/$ISA/pam_unix.so likeauth nullok
auth        sufficient    /lib/security/$ISA/pam_winbind.so use_first_pass
auth        sufficient    /lib/security/$ISA/pam_krb5.so use_first_pass
auth        sufficient    /lib/security/$ISA/pam_smb_auth.so use_first_pass nolocal
auth        required      /lib/security/$ISA/pam_deny.so

account     required      /lib/security/$ISA/pam_unix.so
account     sufficient    /lib/security/$ISA/pam_succeed_if.so uid < 100 quiet
account     sufficient    /lib/security/$ISA/pam_succeed_if.so uid < 2500
account     [default=bad success=ok user_unknown=ignore] /lib/security/$ISA/pam_winbind.so
account     required    /lib/security/$ISA/pam_succeed_if.so user ingroup CORP+MUN
password    required      /lib/security/$ISA/pam_cracklib.so retry=3 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 ocredit=-1
password    sufficient    /lib/security/$ISA/pam_unix.so nullok use_authtok md5 shadow remember=10
password    sufficient    /lib/security/$ISA/pam_krb5.so use_authtok
password    required      /lib/security/$ISA/pam_deny.so

session     required      /lib/security/$ISA/pam_limits.so
session     required      /lib/security/$ISA/pam_unix.so
session     optional      /lib/security/$ISA/pam_krb5.so



Cups remote admin
1. make a new group - like cups - add Ben and yourself (testing) to the cups group


2. Add the new groups to the line below in the /etc/cups/cupsd.conf:

change

# Administrator user group...
SystemGroup sys root

to

# Administrator user group...
SystemGroup sys root cups


3.  Allow access to the web interface:

Listen localhost:631
Listen 10.201.103.146:631
Listen /var/run/cups/cups.sock


# Restrict access to the server...
<Location />
  Order deny,allow
  Deny from All
  Allow 10.201.103.144/28 (need the network the server resides in)
  Allow 10.201.100.0/24 	(mtg net)
  Allow 192.168.66.0/24	(ct net)
  Allow 10.1.12.0/24	(ct net)
  Allow 10.20.12.0/24	(ct net)
</Location>

# Restrict access to the admin pages...
<Location /admin>
  Encryption Required
  AuthType Basic
  Order deny,allow
  Deny from All
  Allow 10.201.103.144/28
  Allow 10.201.100.0/24
  Allow 192.168.66.0/24
  Allow 10.1.12.0/24
  Allow 10.20.12.0/24
</Location>

to  allow MTG 10.201.100.0/24  (testing)  and allow IP range for CT 

4. Open 6509 ACL;s to allow TRI and MTG access to port 631

5. Open web browser and point  to http:/.tridb01:631
      test if you can access and make changes




VISUDO
#
# Sample /etc/sudoers file.
#
# This file MUST be edited with the 'visudo' command as root.
#
# See the sudoers man page for the details on how to write a sudoers file.
#

##
# User alias specification

##
User_Alias	FULLTIMERS = millert, mikef, dowdy
User_Alias	PARTTIMERS = bostley, jwfox, crawl
User_Alias	WEBMASTERS = will, wendy, wim

##
# Runas alias specification
##
Runas_Alias	OP = root, operator

Runas_Alias	DB = oracle, sybase

##
# Host alias specification
##
Host_Alias	SPARC = bigtime, eclipse, moet, anchor:\
		SGI = grolsch, dandelion, black:\
		ALPHA = widget, thalamus, foobar:\
		HPPA = boa, nag, python

Host_Alias	CUNETS = 128.138.0.0/255.255.0.0
Host_Alias	CSNETS = 128.138.243.0, 128.138.204.0/24, 128.138.242.0
Host_Alias	SERVERS = master, mail, www, ns

Host_Alias	CDROM = orion, perseus, hercules

##
# Cmnd alias specification
##
Cmnd_Alias	DUMPS = /usr/sbin/dump, /usr/sbin/rdump, /usr/sbin/restore, \
			/usr/sbin/rrestore, /usr/bin/mt
Cmnd_Alias	KILL = /usr/bin/kill

Cmnd_Alias	PRINTING = /usr/sbin/lpc, /usr/bin/lprm
Cmnd_Alias	SHUTDOWN = /usr/sbin/shutdown
Cmnd_Alias	HALT = /usr/sbin/halt, /usr/sbin/fasthalt
Cmnd_Alias	REBOOT = /usr/sbin/reboot, /usr/sbin/fastboot
Cmnd_Alias	SHELLS = /usr/bin/sh, /usr/bin/csh, /usr/bin/ksh, \

			 /usr/local/bin/tcsh, /usr/bin/rsh, \
			 /usr/local/bin/zsh
Cmnd_Alias	SU = /usr/bin/su
Cmnd_Alias	VIPW = /usr/sbin/vipw, /usr/bin/passwd, /usr/bin/chsh, \
		       /usr/bin/chfn

##
# Override built-in defaults

##
Defaults               syslog=auth
Defaults:FULLTIMERS    !lecture
Defaults:millert       !authenticate
Defaults@SERVERS       log_year, logfile=/var/log/sudo.log

##
# User specification
##


# root and users in group wheel can run anything on any machine as any user
root		ALL = (ALL) ALL
%wheel		ALL = (ALL) ALL

# full time sysadmins can run anything on any machine without a password
FULLTIMERS	ALL = NOPASSWD: ALL


# part time sysadmins may run anything but need a password
PARTTIMERS	ALL = ALL

# jack may run anything on machines in CSNETS
jack		CSNETS = ALL

# lisa may run any command on any host in CUNETS (a class B network)

lisa		CUNETS = ALL

# operator may run maintenance commands and anything in /usr/oper/bin/
operator	ALL = DUMPS, KILL, PRINTING, SHUTDOWN, HALT, REBOOT,\
		/usr/oper/bin/

# joe may su only to operator

joe		ALL = /usr/bin/su operator

# pete may change passwords for anyone but root on the hp snakes
pete		HPPA = /usr/bin/passwd [A-z]*, !/usr/bin/passwd root

# bob may run anything on the sparc and sgi machines as any user

# listed in the Runas_Alias "OP" (ie: root and operator)
bob		SPARC = (OP) ALL : SGI = (OP) ALL

# jim may run anything on machines in the biglab netgroup
jim		+biglab = ALL

# users in the secretaries netgroup need to help manage the printers

# as well as add and remove users
+secretaries	ALL = PRINTING, /usr/bin/adduser, /usr/bin/rmuser

# fred can run commands as oracle or sybase without a password
fred		ALL = (DB) NOPASSWD: ALL

# on the alphas, john may su to anyone but root and flags are not allowed

john		ALPHA = /usr/bin/su [!-]*, !/usr/bin/su *root*

# jen can run anything on all machines except the ones
# in the "SERVERS" Host_Alias
jen		ALL, !SERVERS = ALL

# jill can run any commands in the directory /usr/bin/, except for

# those in the SU and SHELLS aliases.
jill		SERVERS = /usr/bin/, !SU, !SHELLS

# steve can run any command in the directory /usr/local/op_commands/
# as user operator.
steve		CSNETS = (operator) /usr/local/op_commands/


# matt needs to be able to kill things on his workstation when
# they get hung.
matt		valkyrie = KILL

# users in the WEBMASTERS User_Alias (will, wendy, and wim)
# may run any command as user www (which owns the web pages)

# or simply su to www.
WEBMASTERS	www = (www) ALL, (root) /usr/bin/su www

# anyone can mount/unmount a cd-rom on the machines in the CDROM alias
ALL		CDROM = NOPASSWD: /sbin/umount /CDROM,\
		/sbin/mount -o nosuid\,nodev /dev/cd0a /CDROM

intfit ALL = (applhypt) PASSWD: /u01/hypt/hyperion/Middleware/user_projects/epmsystem1/Planning/planning1/OutlineLoad.sh
#
intfglo ALL = (applhypt) PASSWD: /u01/hypt/hyperion/Middleware/user_projects/epmsystem1/Planning/planning1/OutlineLoad.sh



Allow a user to sudo su - (**** ADDING ACCOUNT TO SUDO IS FOR SOLUTIONS!!!!)
%mtgnet ALL = PASSWD: /bin/su - notify, /bin/su



Console Server
[ca-sna-con01]> sh connections
 Id Port/Service              Flow Port/Service              User       Uptime
=== ========================= ==== ========================= ========== ========
  8*SSH In 10.201.100.250     <--> Command Line              sysadmin   00:19:09
  5 SSH In 10.201.100.250     <--> Command Line              sysadmin   78:26:40
  3 SSH In 10.201.100.249     <--> Command Line              sysadmin   105:27:28
  4 SSH In 10.201.100.250     <--> Command Line              sysadmin   526:32:34
  7 SSH In 10.201.100.250     <--> Command Line              sysadmin   629:07:44
  2 Console Port              <--> Command Line                         1972:28:17
  6 Command Direct            <--> Device Port 19            sysadmin   28:20:11

[ca-sna-con01]> connect terminate 6
  6 Command Direct            <--> Device Port 19            sysadmin   28:20:28
Delete these connection(s)? [no] yes


VSFTPD Chroot

/etc/vsftpd/vsftpd.conf file:

# Example config file /etc/vsftpd/vsftpd.conf
#
# The default compiled in settings are fairly paranoid. This sample file
# loosens things up a bit, to make the ftp daemon more usable.
# Please see vsftpd.conf.5 for all compiled in defaults.
#
# READ THIS: This example file is NOT an exhaustive list of vsftpd options.
# Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd's
# capabilities.
#
# Allow anonymous FTP? (Beware - allowed by default if you comment this out).
anonymous_enable=NO
#
# Uncomment this to allow local users to log in.
local_enable=YES
#
# Uncomment this to enable any form of FTP write command.
write_enable=YES
#
# Default umask for local users is 077. You may wish to change this to 022,
# if your users expect that (022 is used by most other ftpd's)
local_umask=022
#
# Uncomment this to allow the anonymous FTP user to upload files. This only
# has an effect if the above global write enable is activated. Also, you will
# obviously need to create a directory writable by the FTP user.
#anon_upload_enable=YES
#
# Uncomment this if you want the anonymous FTP user to be able to create
# new directories.
#anon_mkdir_write_enable=YES
#
# Activate directory messages - messages given to remote users when they
# go into a certain directory.
dirmessage_enable=YES
#
# Activate logging of uploads/downloads.
# The target log file can be vsftpd_log_file or xferlog_file.
# This depends on setting xferlog_std_format parameter
xferlog_enable=YES
#
# Make sure PORT transfer connections originate from port 20 (ftp-data).
connect_from_port_20=YES
#
# If you want, you can arrange for uploaded anonymous files to be owned by
# a different user. Note! Using "root" for uploaded files is not
# recommended!
#chown_uploads=YES
#chown_username=whoever
#
# The name of log file when xferlog_enable=YES and xferlog_std_format=YES
# WARNING - changing this filename affects /etc/logrotate.d/vsftpd.log
#xferlog_file=/var/log/xferlog
#
# Switches between logging into vsftpd_log_file and xferlog_file files.
# NO writes to vsftpd_log_file, YES to xferlog_file
xferlog_std_format=YES
#
# You may change the default value for timing out an idle session.
#idle_session_timeout=600
#
# You may change the default value for timing out a data connection.
#data_connection_timeout=120
#
# It is recommended that you define on your system a unique user which the
# ftp server can use as a totally isolated and unprivileged user.
#nopriv_user=ftpsecure
#
# Enable this and the server will recognise asynchronous ABOR requests. Not
# recommended for security (the code is non-trivial). Not enabling it,
# however, may confuse older FTP clients.
#async_abor_enable=YES
#
# By default the server will pretend to allow ASCII mode but in fact ignore
# the request. Turn on the below options to have the server actually do ASCII
# mangling on files when in ASCII mode.
# Beware that turning on ascii_download_enable enables malicious remote parties
# to consume your I/O resources, by issuing the command "SIZE /big/file" in
# ASCII mode.
# These ASCII options are split into upload and download because you may wish
# to enable ASCII uploads (to prevent uploaded scripts etc. from breaking),
# without the DoS risk of SIZE and ASCII downloads. ASCII mangling should be
# on the client anyway..
ascii_upload_enable=YES
ascii_download_enable=YES
#
# You may fully customise the login banner string:
#ftpd_banner=Welcome to blah FTP service.
#
# You may specify a file of disallowed anonymous e-mail addresses. Apparently
# useful for combatting certain DoS attacks.
#deny_email_enable=YES
# (default follows)
#banned_email_file=/etc/vsftpd.banned_emails
#
# You may specify an explicit list of local users to chroot() to their home
# directory. If chroot_local_user is YES, then this list becomes a list of
# users to NOT chroot().
chroot_list_enable=YES
# (default follows)
chroot_list_file=/etc/vsftpd/vsftpd.chroot_list
#
# You may activate the "-R" option to the builtin ls. This is disabled by
# default to avoid remote users being able to cause excessive I/O on large
# sites. However, some broken FTP clients such as "ncftp" and "mirror" assume
# the presence of the "-R" option, so there is a strong case for enabling it.
#ls_recurse_enable=YES

pam_service_name=vsftpd
userlist_enable=YES
userlist_deny=NO
userlist_file=/etc/vsftpd/user_list
#enable for standalone mode
listen=YES
tcp_wrappers=YES
reverse_lookup_enable=NO


user_list file contains users allowed to ftp










vsftpd.conf file
add users (non-chroot)
userlist_enable=YES
userlist_deny=NO
userlist_file=/etc/vsftpd/user_list

add users to the user_list file

FTP Chroot config:
add user to user_list and vsftpd.chroot_list files

Edit the vsftp.conf file and add:
chroot_local_user=YES
#chroot_list_enable=YES
# (default follows)
chroot_list_file=/etc/vsftpd/vsftpd.chroot_list

pam_service_name=vsftpd
userlist_enable=YES
userlist_deny=NO
#enable for standalone mode
listen=YES
tcp_wrappers=YES

If SELINUX is enabled do:
do a "chcon -R -t public_content_rw /ftp/directory"
and also do 
setsebool -P allow_ftpd_anon_write=1

vsftpd.conf options for chroot
listen_address=10.201.215.90
anonymous_enable=no
local_enable=YES
write_enable=YES
anon_upload_enable=no
anon_mkdir_write_enable=no
anon_other_write_enable=no
dirmessage_enable=YES
xferlog_enable=YES
connect_from_port_20=YES
chroot_local_user=YES
chroot_list_file=/etc/vsftpd/vsftpd.chroot_list
local_root=/u01/ftp/esiftp
listen=YES
tcp_wrappers=YES
pasv_enable=YES
pasv_min_port=11000
pasv_max_port=11010
log_ftp_protocol=YES
xferlog_enable=YES
xferlog_file=/var/log/vsftpd.esi.log
pam_service_name=vsftpd
userlist_enable=YES
userlist_deny=NO
userlist_file=/etc/vsftpd/user_list
#enable for standalone mode
listen=YES
tcp_wrappers=YES

contents of user_list has users that are allowed access



FC SAN Configuration (Fiberchannel) MD36xxF

1. Logon as local root to the powervault disk manager
2. setup physical array
3. setup tab

	setup disk group - name will be DG-ASA (cust name is ASA)
	pick the disks to be used for this customer select and choose raid 5 then add
	

4. setup host mappings
	create virtual disk (under logical tab, right-click on the free space under your disk 	group)

5. map zones
	on fc switches (both)
	select zone admin create a new alias - asavs10
	add member (choose correct id) and add to identifier
	create a new zone (asavs10)
	add both member id and storage to the zone

6. setup interfaces on the host to boot the lun 00


VS Build

VS Host Config after install

Setup Bonding (see below for examples)
vi /etc/modprobe.conf 

add: 	alias bond0 bonding
	options bnx2 disable_msi=1
	options bond0 mode=4 miimon=100 lacp_rate=1

vi /etc/xen/xend-config.sxp
# (network-script 'network-bridge netdev=eth1')
(network-script 'network-bridge netdev=bond0')

vi /etc/xen/scripts/network-bridges
        #if [[ $netdev =~ "^eth[0-9]+$" ]]; then
        if [[ $netdev =~ "^bond[0-9]+$" ]]; then

vi /etc/xen/scripts/vif-common.sh
  #local nd=${netdev:-eth0}
  local nd=${netdev:-bond0}

Turn on multipath daemon
chkconfig multipathd on
service multipathd start

Now install multipath driver (get from S:\IT-Software\Dell\Dell_MD36xxf_RDVD_1.0.0.21_A00_R304253\linux) - scp linux dir to /root of server
cd /root/linux
chmod 700 md36xxf_install.bin
./md36xxf_install.bin 

Install ramdisk (loads multipath on boot)
cd dm
sh install_dm.sh 

Reboot

Setup Bond0 interface
DEVICE=bond0
BOOTPROTO=static
BROADCAST=10.202.103.255
IPADDR=10.202.103.253
NETMASK=255.255.255.240
NETWORK=10.202.103.240
ONBOOT=yes
USERCTL=no
PEERDNS=no
TYPE=Ethernet

Make sure multipathd is running

Setup mpath partition for OS
	cd /dev
   	ls mapper/
   	fdisk -l /dev/mapper/mpath1 
   	fdisk /dev/mapper/mpath1 
   	reboot
After reboot verify the partition 
ls /dev/mapper/
format the partition:
 mkfs.ocfs2 /dev/mapper/mpath1p1 


Setup OVS repository  (make sure name of server and IP are setup correctly first)
/opt/ovs-agent-latest/utils/repos.py -l (verify no repository)
Create new (-n) repo on new partition (this is the /OVS)
/opt/ovs-agent-latest/utils/repos.py -n /dev/mapper/mpath1p1 
/opt/ovs-agent-latest/utils/repos.py -r a3b9bf25-ae30-46f6-bd0b-d6aa23e15a01 (paste in from above command)
/opt/ovs-agent-latest/utils/repos.py -l (lists the repository)
/opt/ovs-agent-latest/utils/repos.py -i (initialize the repository)


Multipath boot VS

do a df to find what device is /root
/dev/sdb3      14853792   1968616  12118476  14% /
/sbin/scsi_id -g -u -s /block/sdb (or sda or whatever it is)
cp the uuid
edit /sbin/mkinitrd
	add multipath=1
	add wwid fom above

example: search for "36"
if [ "$use_multipath" == "1" ]; then
    emit "echo Creating multipath devices"
    for wwid in $root_wwids ; do
        emit "/bin/multipath -v 0 $wwid"
    done
        emit "/bin/multipath -v 0 36000d3100042a3000000000000000016"
    if [ "$use_xdr" == "1" ]; then
    emit "echo Setting up XDR dm device"
    emit "/bin/multipath -v 0"
    fi
    emit "dmsetup ls --target multipath --exec 'kpartx -a -p p'"
fi


VS Server ext4 and e2label
mkfs.ext4 –L LABEL_BNAME /dev/VG_NAME/LV_NAME from the VS

The present the label to the vm.cfg



label root
e2label /dev/sdb3 /root
label boot
e2label /dev/sdb1 /boot

edit /etc/fstab for labels

edit /etc/sysconfig/mkintrd/multipath
MULTIPATH=yes

mkinitrd -f --rootdev LABEL=/root --with=dm-rdac /boot/initrd-2.6.18-128.2.1.4.44.el5xenmp.img 2.6.18-128.2.1.4.44.el5xen

edit grub - add new section for new ram disk


If you get uuid error when booting vs after changing SAN mappings, remove the /etc/blkid/blkid file and let it recreate it




Subject: MP boot

/etc/lvm/lvm.conf
#preferred_names = [ ]

# Try to avoid using undescriptive /dev/dm-N names, if present.
preferred_names = [ "^/dev/mpath/", "^/dev/mapper/mpath", "^/dev/[hs]d" ]
filter = [ "a|/dev/mapper/mpath.*|", "a|/dev/mpath/mpath.*|", "r|/dev/sd.*|" ]
types = [ "device-mapper", 253 ]


[root@twivs12 ~]# mkinitrd -f --rootdev=/dev/sd? --with=dm-multipath --with=dm-rdac /boot/initrd-2.6.18-128.2.1.4.44.el5xenmp2.img `uname -r`

Use df to find out what the ? device name is 

   300  fdisk /dev/mapper/mpath5 
  301  partprobe /dev/mapper/mpath5
  302  mkswap -L swap /dev/mapper/mpath5p1
  303  pvcreate /dev/mapper/mpath5p2
  304  vgcreate VG_TWIAPP03_OS /dev/mapper/mpath5p2
  305  lvcreate /dev/VG_TWIAPP03_OS -L 10G -n LV_ROOT
  306  lvcreate /dev/VG_TWIAPP03_OS -L 10G -n LV_TMP
  307  lvcreate /dev/VG_TWIAPP03_OS -L 15G -n LV_VAR
  308  lvcreate /dev/VG_TWIAPP03_OS -L 15G -n LV_USR
  309  lvcreate /dev/VG_TWIAPP03_OS -l 100%FREE -n LV_HOME
  310  mkfs.ext3 -L /root /dev/VG_TWIAPP03_OS/LV_ROOT 
  311  mkfs.ext3 -L /var /dev/VG_TWIAPP03_OS/LV_VAR 
  312  mkfs.ext3 -L /usr /dev/VG_TWIAPP03_OS/LV_USR 
  313  mkfs.ext3 -L /home /dev/VG_TWIAPP03_OS/LV_HOME 
  315  mkfs.ext3 -L /tmp /dev/VG_TWIAPP03_OS/LV_TMP


vm.cfg entries - example

change:

bootargs = 'bridge=xenbr0,mac=00:16:3E:4A:17:97,type=netfront'
bootloader = '/usr/bin/pypxeboot'
disk = []

to:

disk = ['phy:/dev/VG_TWIAPP04_OS/LV_ROOT,sdh1,w',
'phy:/dev/mapper/mpath1p1,sdh2,w',
'phy:/dev/VG_TWIAPP04_OS/LV_VAR,sdh3,w',
'phy:/dev/VG_TWIAPP04_OS/LV_USR,sdh6,w',
'phy:/dev/VG_TWIAPP04_OS/LV_HOME,sdh4,w',
'phy:/dev/VG_TWIAPP04_OS/LV_TMP,sdh5,w',
'phy:/dev/mapper/mpath6,sdg,w!',
]
extra = 'xen_emul_unplug=never'
kernel = '/OVS/boot_pool/vmlinuz-2.6.32-300.32.1.el5uek'
ramdisk = '/OVS/boot_pool/initrd-2.6.32-300.32.1.el5uek.img'
root = 'LABEL=/root ro'
cpus = '16-23'


Bonding on VS server

/etc/modprobe.conf
alias eth0 bnx2
alias eth1 bnx2
alias scsi_hostadapter ata_piix
alias scsi_hostadapter1 lpfc
alias scsi_hostadapter2 usb-storage
options bnx2 disable_msi=1 (only if broadcom)
alias bond0 bonding
#options bond0 mode=4 miimon=100 lacp_rate=1 (not using this anymore)
options bond0 mode=1 miimon=100 (this needs to be before the other alias)
options bond0 max_bonds=2 (if you have more than one VM)
alias bond1 bonding 


ifcfg-bond0
# Broadcom Corporation NetXtreme II BCM5709S Gigabit Ethernet
DEVICE=bond0
BOOTPROTO=static
BROADCAST=10.201.103.223
IPADDR=10.201.103.219
NETMASK=255.255.255.240
NETWORK=10.201.103.208
ONBOOT=yes
USERCTL=no
PEERDNS=no
TYPE=Ethernet

DEVICE=bond1
ONBOOT=yes
BOOTPROTO=none
USERCTL=no
PEERDNS=no
TYPE=Ethernet

ifcfg-eth0 and eth1
# Broadcom Corporation NetXtreme II BCM5709S Gigabit Ethernet
DEVICE=eth0 or eth1
BOOTPROTO=none
HWADDR=14:FE:B5:6D:9D:91 (make sure you preserve the hw addresses)
ONBOOT=yes
TYPE=Ethernet
USERCTL=no
PEERDNS=no
MASTER=bond0
SLAVE=yes


ifcfg-eth2 and eth3
# Broadcom Corporation NetXtreme II BCM5709S Gigabit Ethernet
DEVICE=eth2 or eth3
BOOTPROTO=none
HWADDR=14:FE:B5:6D:9D:91 (make sure you preserve the hw addresses)
ONBOOT=yes
TYPE=Ethernet
USERCTL=no
PEERDNS=no
MASTER=bond1
SLAVE=yes


cd /etc/xen/scripts/
if only one vm, then:
vi network-bridges file:
        #if [[ $netdev =~ "^eth[0-9]+$" ]]; then
        if [[ $netdev =~ "^bond[0-9]+$" ]]; then
		devnum=${netdev:4}

if more than one vm, then:
cp network-bridges network-bridges.orig

vi network-bridges make it this exactly:

#!/bin/bash
#
# Runs network-bridge against each ethernet card.
#

dir=$(dirname "$0")

run_all_ethernets()
{
    for f in /sys/class/net/*; do
        netdev=$(basename $f)
        #if [[ $netdev =~ "^eth[0-9]+$" ]]; then
        if [[ $netdev =~ "^bond[0-9]+$" ]]; then
            devnum=${netdev:4}
            $dir/network-bridge "$@" "netdev=${netdev}" "bridge=xenbr${devnum}"
        fi
    done
}

run_all_ethernets "$@"


Edit vif-common.sh also and change eth to bond


reboot


Troubleshoot VS Build Network:

Please configure the ifcfg-eth files with bootproto=none

Remove the bak files

Change eth0 in the xen/scripts to bond0

Verify modprobe.conf

That is the only magic I find the works – a proper configuration



In the VM Manager - remove the extra bridge for eth VM and rename the first to br0 and br1 (for the second vm if there is one)

while vs is rebooting, paste configs into switch (this is no longer necessary if using mode=1)

interface Port-channel2
 description HCP vs01
 switchport access vlan 308
 switchport mode access


interface GigabitEthernet3/0/5
 description HCPVS01
 switchport access vlan 308
 switchport mode access
 channel-group 2 mode active
 spanning-tree portfast

interface GigabitEthernet4/0/5
 description HCPVS01
 switchport access vlan 308
 switchport mode access
 channel-group 2 mode active
 spanning-tree portfast

After reboot make sure both bridges show up, if not manually run the network-bridges script and troubleshoot: 
/etc/xen/scripts/network-bridges start

It you are doing this to a Windows VM, you will need to logon via the vs server :1 or whatever it is using vnc to configure the adapter.



---How to monitor backups---
Question number one should always be,  what day is it?  This will determine which backups ( Daily/Weekly/Monthly ) have priority and which jobs are important to finish first.
1.  Monthly backups always have top priority.  They always run on the first day of each month.  No daily or weekly jobs should run unless the entire monthly set is completed successfully.
2.  Weekly backups, especially Sunday weekly backups have the next top priority.  This will be the case 95% of the time, except when monthly backups are running.  The Sunday weekly backups must complete before they can be shipped offsite, Every Wednesday AM.  The Thursday weekly backups stay onsite, but they must complete as a set before then next Oracle full backups run on the weekend.
3.  Daily backups should be running anytime after when both the Sunday weekly and Thursday weekly backups sets complete.

After determining which backups should be running when, then you can effectively restart backups.  Every failed backup needs to be restarted, but based on which type ( Daily/Weekly/Monthly ) will determine in what order you restart backups.



Adding an ASA to MRTG, Rancid and Configuring Cisco backups

Cisco backups:
1. sudo su -			<<< Login into ca-sna-mgt01 - use your own AD password >>>
2. cd /u01/cisco_backups/
3. cd /2013/12/16		>>> pick a year, month, day >>>
4. grep 192.168.21. -R *        >>> search recursively in all directories and subdirectories <<<


On ca-sna-mgt01:
cd /u01/net-scripts

Using TRI as an example:
Update tri-riv (tse-riv) edit the following files:
backuphosts/tri.rt (add IP addresses for devices, i.e. asa as needed)
passwordfiles/cust_asa.pw (copy existing section and modify as needed)

Run these commands:
PATH=$PATH:/usr/local/net-sense/bin/;export PATH
cd /u01/net-scripts/
/usr/local/net-sense/bin/encrypt_logins -if passwordfiles/cust_asa.pw -of passwordfiles/cust_asa-en.pw -nokey

The cisco backups require the encrypted password file. Do not delete the unencrypted file when prompted.
Hit <enter> when prompted for a password. They type “no” when prompted to delete the un-encrypted password file.
Add host to backupscript.sh – copy paste and existing ct line and add in alphabetical order. Edit the lowercase cust code as well as the uppercase customer code at the end of the line.

add to asa in ca:
access-list ATT_access_in extended permit udp host xx.xx.xx.xx host 12.130.200.23 eq tftp 
access-list ATT_access_in extended permit udp host xx.xx.xx.xx host 12.130.200.23 eq syslog 

To make sure bb can ping host, add to va asa:
access-list acl-out extended permit icmp host xx.xx.xx.xx  any echo-reply 
Cd to /u01/cisco-backups/current.year/current.month/
Rename the current directory to .1
Mv current.day to current.day.1
run the backupscript (see crontab –l)
/u01/net-scripts/backupscript.sh
Verify the new host is being added to the /u01/cisco-backups/20xx/xx/CT  directory

If backups are failing, verify you can copy run tft from the ct asa. Use 12.130.200.23 as the dest. If it works, then ssh pix@IP from mgt01 - if that works, should be good. If not, you will see the issue.


Mrtg:  
On ca-sna-mgt01:
vi /usr/local/mrtg-cfg/mrtg-config-build
add the following lines and edit the IP address and names:
#
/usr/local/mrtg-2/bin/cfgmaker --global 'WorkDir: /u01/www/html/mrtg/work/MSP'  \
          --global 'Options[_]: bits,growright' \
        -ifref=ip \
          --output /usr/local/mrtg-cfg/pom-asa01.cfg    \
           mtgmsp@ 69.61.137.194

Now paste the lines in…
/usr/local/mrtg-2/bin/cfgmaker --global 'WorkDir: /u01/www/html/mrtg/work/MSP'  \
          --global 'Options[_]: bits,growright' \
        -ifref=ip \
          --output /usr/local/mrtg-cfg/pom-asa01.cfg    \
           mtgmsp@69.61.137.194
OR… copy section that is similar and modify as necessary
*If this fails with "no info could be retrieved", you may need to use port 163 - add :163 after the IP address

Now edit and paste these lines in:
/usr/local/mrtg-2/bin/indexmaker --output=/u01/www/html/mrtg/pom-asa01.html --prefix=work/MSP --title="POM Managed VPN" --sort=name --nolegend /usr/local/mrtg-cfg/pom-asa01.cfg

Now edit and paste these lines in:
# /usr/local/mrtg-2/bin/mrtg /usr/local/mrtg-cfg/pom-asa01.cfg
env LANG=C /usr/local/mrtg-2/bin/mrtg /usr/local/mrtg-cfg/pom-asa01.cfg

Run the above statement it until it returns no errors – usually 3 times.
Edit crontab:
02,07,12,17,22,27,32,37,42,47,52,57 * * * * /usr/local/mrtg-2/bin/mrtg /usr/local/mrtg-cfg/pom-asa01.cfg > /dev/null 2>&1
Cp similar line and modify as necessary

Edit html intranet page:
Y:\Intranet\infrastructure\mrtg.htm
height="9">&nbsp;&nbsp;
          <a href="http://10.201.99.3/mrtg/pom-asa01.html">POM  ASA</a>
          </td></tr>
	  <tr><td align="left"><strong><img src="/images/bullet_r_gray.png" alt="bullet" width="10"
Copy modify as necessary
Verify the link is working (link should be under Reporting and Monitoring > Network Graphs > Managed Devices)

Rancid:  
1. log into ca-sna-mgt01
2. su - rancid
3. if you need to add login information for non-standard devices or cust devices, edit the .cloginrc 
4. As the rancid user, add the device Ip to the /var/SITE/router.db file (if a MTG device), or var/msp for mtg ct-managed devices
5. crontab -l 
6. run the rancid hourly script from the cron output above.
7. once scripts completes, connect to http://10.201.99.3/viewvc to verify new device is added to repository



Router reverse nat

MTG SAvvis Cisco ASA - -need to add to all other ASA using the correct interfaces and correct 

access-list sri-nh-tunnel extended permit ip 10.202.103.96 255.255.255.240 host 172.25.10.228
access-list sri-az-tunnel extended permit ip 10.202.103.96 255.255.255.240 host 172.29.10.110

access-list va-custnet-in extended permit ip 10.202.103.96 255.255.255.240 host 172.25.10.228
access-list va-custnet-in extended permit ip 10.202.103.96 255.255.255.240 host 172.29.10.110

access-list sri-az-printing-nat extended permit ip host 192.168.209.30 10.202.103.96 255.255.255.240   
static (savvis-outside,va-ash-custnet) 172.29.10.110 access-list sri-az-printing-nat 

access-list sri-nh-printing-nat extended permit ip host 192.168.204.30 10.202.103.96 255.255.255.240

static (savvis-outside,va-ash-custnet) 172.25.10.228 access-list sri-nh-printing-nat 

***************


6509 router


ip route vrf SRI 172.25.10.228 255.255.255.255 192.168.203.45 track 1
ip route vrf SRI 172.29.10.110 255.255.255.255 192.168.203.53 track 2


no ip nat inside source static 172.25.10.228 192.168.204.30 vrf SRI
no ip nat inside source static 172.29.10.110 192.168.209.30 vrf SRI

no ip route vrf SRI 192.168.204.30 255.255.255.255 192.168.203.45 track 1
no ip route vrf SRI 192.168.209.30 255.255.255.255 192.168.203.53 track 2


ip route vrf SRI 192.168.204.1 255.255.255.255 10.202.103.97 100
ip route vrf SRI 192.168.204.30 255.255.255.255 10.202.103.97 100
ip route vrf SRI 192.168.209.1 255.255.255.255 10.202.103.97 100
ip route vrf SRI 192.168.209.30 255.255.255.255 10.202.103.97 100
ip route vrf SRI 172.29.10.110 255.255.255.255 10.202.103.97 100
ip route vrf SRI 172.25.10.228 255.255.255.255 10.202.103.97 100




Create a master uid/gid list, pick the SNO server that is most correct and use as the template. Then, figure out all of the discrepancies on the other servers, and fix them manually (edit using vipw and gipw) making sure to make note of the old ID's. Then change ownership of the files using `find` so that they match the new uid/gid using a command similar to this (found on google, seems to work well on my test system):

find / -user olduid -exec chown newuid '{}' \;

find / -group oldgroupid -exec chown newgroupid '{}' \;

So if you change the uid of a passwd entry, you can find the files owned by that userid and modify. You can also do this:

find / -user username -exec chown newuser:group '{}' \;

But that would not be applicable in our case since many files owned by the same user may not belong to the same group. Best to do users and groups independently.

We would probably need downtime to do this since open files will be changed and it could possibly cause issues. Also, not sure what impact this could have on running Oracle processes or scripts. Once all servers have been updated, update the spreadsheet.





VNC as the appl user is required for processes to work - port can be any port.

You must log into the servers

run netstat -anp  | grep 5810

nmetstat -anp | grep 5910

netstat -anp | grep 6010


if there are processes on those ports that belong to CS - report it. If the processes are IT and OS processes, restart them. to clear the port.


However, with net.ipv4.ip_local_port_range = 9000 65000 in the ssysctl.conf, ports below 9000 shuld not be used by OS processes.


In this case, SSH was using port 6010


Hyperion Ports


access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 eq 1423
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 eq 13080
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 range 6800 6890
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 range 8200 8300
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 range 10000 10100
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 eq 45000
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 eq 16000
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 eq 30000
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 range 32768 33768
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 eq 28080
access-list 2346 permit tcp 192.168.68.0 0.0.0.255 host 10.201.103.172 eq 19000

#access-list 2326 deny tcp 192.168.74.0 0.0.0.255 host 10.202.103.244 range 5800 5999
#access-list 2326 permit tcp 192.168.74.0 0.0.0.255 host 10.202.103.244 range 1023 65535


UEK on VM

Label all partitions on VM server (check fstab for correct device names)
e2label /dev/sdb1 /root
e2label /dev/sdb3 /var
e2label /dev/sdb5 /home
mkswap -L swap /dev/sdc1

Edit FSTAB to use Labels:
LABEL=/root      /                       ext3    defaults        1 1
LABEL=/var      /var                    ext3    defaults        1 2
LABEL=/home     /home                    ext3    defaults        1 2
LABEL=swap       swap                    swap    defaults        0 0

Install  ocfs2-tools(if adding shared storage), oracle-linux, oracle-uek
up2date -i oracle-linux oracle-uek ; up2date -i ocfs2-tools

SCP /boot/uek kernel and ramdisk to vs server into /OVS/boot_pool32 or 64

Vi vm.cfg file - edit the kernel and ramdisk lines, also notice the change for root = line and the additional extra = line:

disk = ['phy:/dev/VG_MEGDB11_OS/LV_ROOT,sdc1,w',
'phy:/dev/sdb5,sdc2,w',
'phy:/dev/VG_MEGDB11_OS/LV_VAR,sdc3,w',
'phy:/dev/sdb3,sdc4,w',
'phy:/dev/VG_MEGDB11_OS/LV_HOME,sdc5,w',
'phy:/dev/sdb6,sdc6,w!',
]
kernel = '/OVS/boot_pool64/vmlinuz-2.6.32-300.7.1.el5uek'
ramdisk = '/OVS/boot_pool64/initrd-2.6.32-300.7.1.el5uek.img'
#kernel = '/OVS/boot_pool64/vmlinuz-2.6.18-274.12.1.0.1.el5xen'
#ramdisk = '/OVS/boot_pool64/initrd-2.6.18-274.12.1.0.1.el5xen.img'
#ramdisk = '/OVS/boot_pool32/initrd-2.6.18-274.12.1.0.1.el5xen.img'
#root = '/dev/sdc1 ro'
root = 'LABEL=/root ro'
extra = 'xen_emul_unplug=never'
keymap = 'en-us'
memory = '16000'
name = '352_megdb11'
on_crash = 'restart'
on_reboot = 'restart'
pae = 1
timer_mode = 0

Edit on each VM Server:
/etc/inittab:
#co:2345:respawn:/sbin/agetty xvc0 9600 vt100-nav
co:2345:respawn:/sbin/agetty hvc0 9600 vt100-nav

/etc/securetty:
#xvc0
hvc0

		
xm shut and then start them back up

If adding additional storage, create the LVM on the VS server and present as a block device to the VM. 





FWSM

va-ash-vss01#session switch 1 slot 2 processor 1


sh mod

sh switch 

sh run | inc firewall

va-ash-vss01(config)#firewall vlan-group 1 496,412  




Convert ct from vss to fw (quick cutover)

Paste new acls into FWSM - you need both vlan rules and outside_in rules
Examples
access-list asa_out permit tcp 192.168.74.0 255.255.255.0 10.202.103.240 255.255.255.240 eq 22
access-list asa_in permit tcp 10.202.103.240 255.255.255.240 192.168.74.0 255.255.255.0 eq 9100
access-list outside_in permit ip 192.168.74.0 255.255.255.0 10.202.103.240 255.255.255.240


On FWSM (not VSS)
interface Vlan346
 nameif GTI   
 security-level 50
 ip address 10.202.103.161 255.255.255.240 standby 10.202.103.170
access-group gti_in in interface GTI
access-group gti_out out interface GTI

term mon on fwsm and watch while you do the following:

On VSS (not FWSM)
no int vlan 346
firewall vlan-group 1 346



va-ash-vss01#sh run | inc firewall
firewall switch 1 module 2 vlan-group 1
firewall switch 2 module 2 vlan-group 1
firewall vlan-group 1  16,36,40,66,124,160,241,308,310,316,328,330,344,400,412,464,496
va-ash-vss01#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
va-ash-vss01(config)#firewall vlan-group 1 414


ADD Vlan to FWSM


va-ash-fwsm01(config-if)# sh run int vlan 414
!
interface Vlan414
 description SDM
 nameif SDM
 security-level 50
 ip address 10.202.104.129 255.255.255.240 standby 10.202.104.130


va-ash-fwsm01(config)# sh run icmp                                   
icmp permit 10.202.100.0 255.255.255.0 outside
icmp permit 10.202.99.0 255.255.255.0 outside
icmp permit 10.202.99.0 255.255.255.0 TNT
icmp permit 10.202.104.112 255.255.255.240 TNT
icmp permit 10.202.99.0 255.255.255.0 CLS
icmp permit 10.202.99.0 255.255.255.0 HNI
icmp permit 10.202.104.32 255.255.255.240 A10
icmp permit 10.202.104.128 255.255.255.240 SDM




Process for multipath:

1.	/sbin/scsi_id -g -u -s /block/sda

2.	Cd /sbin
3.	cp mkinitrd mkinitrd.disti
4.	 vi /sbin/mkinitrd
change use_multipath=0 to use_multipath=1
                
change:
    for wwid in $root_wwids ; do
        emit "/bin/multipath -v 0 $wwid"
    done

to

    for wwid in $root_wwids ; do
        emit "/bin/multipath -v 0 $wwid"
    done         
   emit "/bin/multipath -v 0 WWID"

WWID is from step #1  above

5.	edit /etc/sysconfig/mkintrid/multipath
a.	change MULTIPATH=no to MULTIPATH=yes

6.	build ramdisk
a.	mkinitrd  --with=dm-rdac /boot/ initrd-2.6.18-128.2.1.4.44.el5xenmp.img `uname –r`

                *** ensure initrd-2.6.18-128.2.1.4.44.el5xen.img matches your current kernel and add the “mp” 

7.	edit grub - add new section for new ram disk

change :
# Detect64 claims this is 64 bit box
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title Oracle VM server (2.6.18-128.2.1.4.44.el5xen)
        root (hd0,0)
#       kernel /xen-64bit.gz dom0_mem=569M
        kernel /xen-64bit.gz dom0_mem=1024M
        module /vmlinuz-2.6.18-128.2.1.4.44.el5xen ro root=UUID=73ad0ac3-6b42-4d1a-9fb0-3e4ad99038f5
        module /initrd-2.6.18-128.2.1.4.44.el5xen.img

to:

# Detect64 claims this is 64 bit box
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
#hiddenmenu
title Oracle VM server (2.6.18-128.2.1.4.44.el5xen) MP
        root (hd0,0)
        kernel /xen-64bit.gz dom0_mem=1024M
        module /vmlinuz-2.6.18-128.2.1.4.44.el5xen ro root=UUID=73ad0ac3-6b42-4d1a-9fb0-3e4ad99038f5
        module /initrd-2.6.18-128.2.1.4.44.el5xenmp.img
title Oracle VM server (2.6.18-128.2.1.4.44.el5xen)
        root (hd0,0)
        kernel /xen-64bit.gz dom0_mem=1024M
        module /vmlinuz-2.6.18-128.2.1.4.44.el5xen ro root=UUID=73ad0ac3-6b42-4d1a-9fb0-3e4ad99038f5
        module /initrd-2.6.18-128.2.1.4.44.el5xen.img


8.	mv /etc/blkid/blkid.tab  /etc/blkid/blkid.tab.nonmp


IMAP Account

1. Create user account on smtp1, using a description indicating the purpose of the account "INP Prod Workflow Mailer" and make the shell /bin/false. CS may give you the names they want to use. 

useradd -c "INP Prod Workflow Mailer" -s /bin/false inp_wf_prd
Example:
inp_wf_prd:x:10000:10001:INP Prod Workflow Mailer:/home/inp_wf_prd:/bin/false

2. Set password and provide to SM/Requestor

3.  Setup access for IMAP from ct server to IMAP server (on ASA01 in CA or VA) ask if it’s 143 or 993
Example:
On CA ASA If the server is in CA
access-list ca-sna-custnet_access_in permit tcp host ct_server_IP host 10.201.215.11 eq imap4
On VA ASA If the server is in VA
access-list va-custnet-in permit tcp host ct_server_IP host 10.202.215.10 eq imap4
On FWSM in CA if the server is in CA
Access-list `access-list name` permit tcp host `ct_server_ip` host 10.201.215.11 eq imap4
On FWSM in VA If the server is in VA
Access-list `access-list name` permit tcp host `ct_server_ip` host 10.202.215.10 eq imap4

Use the document to ensure your syntax is correct. 

4. Test: from ct server telnet to the imap port on the  IMAP server





Adding SAN storage to NS server

pvcreate /dev/mapper/mpath30p1

vgextend VG_VA_NS /dev/mapper/mpath30p1

lvcreate /dev/VG_VA_NS -n LV_U47 -l 100%FREE


[root@va-ash-ns02 mapper]# mkfs.ocfs2 -C 64K -L u46 /dev/VG_VA_NS/LV_U46

[root@ppivs01 970_ppidb01]# parted /dev/mapper/mpath13
GNU Parted 1.8.1
Using /dev/mapper/mpath13
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) p free                                                           
Warning: /dev/mapper/mpath13 contains GPT signatures, indicating that it has a GPT table.  However, it does not have a valid fake
msdos partition table, as it should.  Perhaps it was corrupted -- possibly by a program that doesn't understand GPT partition tables.
Or perhaps you deleted the GPT table, and are now using an msdos partition table.  Is this a GPT partition table?
parted: invalid token: free
Yes/No? Yes                                                               

Model: Linux device-mapper (dm)
Disk /dev/mapper/mpath13: 145GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End    Size   File system  Name     Flags
 1      17.4kB  145GB  145GB               primary       

(parted) rm 1                                                             
Warning: /dev/mapper/mpath13 contains GPT signatures, indicating that it has a GPT table.  However, it does not have a valid fake
msdos partition table, as it should.  Perhaps it was corrupted -- possibly by a program that doesn't understand GPT partition tables.
Or perhaps you deleted the GPT table, and are now using an msdos partition table.  Is this a GPT partition table?
parted: invalid token: 1
Yes/No? Yes                                                               
Partition number? 1                                                       
(parted) p free                                                           

Model: Linux device-mapper (dm)
Disk /dev/mapper/mpath13: 145GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End    Size   File system  Name  Flags
        17.4kB  145GB  145GB  Free Space              

(parted) mkpart                                                           
Partition name?  []? swap                                                 
File system type?  [ext2]? swap                                           
parted: invalid token: swap
File system type?  [ext2]? none                                           
parted: invalid token: none
File system type?  [ext2]? linux-swap                                     
Start? 0                                                                  
End? 65GB                                                                 
(parted) p free                                                           

Model: Linux device-mapper (dm)
Disk /dev/mapper/mpath13: 145GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End     Size    File system  Name  Flags
 1      17.4kB  65.0GB  65.0GB               swap       
        65.0GB  145GB   80.0GB  Free Space              

(parted) mkpart                                                           
Partition name?  []? OS                                                   
File system type?  [ext2]?                                                
Start? 65GB                                                               
End? 145GB                                                                
(parted) p free                                                           

Model: Linux device-mapper (dm)
Disk /dev/mapper/mpath13: 145GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt

Number  Start   End     Size    File system  Name  Flags
 1      17.4kB  65.0GB  65.0GB               swap       
 2      65.0GB  145GB   80.0GB               OS         

(parted) quit                                                             
Information: Don't forget to update /etc/fstab, if necessary.             

[root@ppivs01 970_ppidb01]# ls /dev/mapper
control  mpath10p1  mpath12p1  mpath13p1  mpath14    mpath7    mpath8    mpath9    VG_PPIDB01_U01-LV_U01
mpath10  mpath12    mpath13    mpath13p2  mpath14p1  mpath7p1  mpath8p1  mpath9p1
[root@ppivs01 970_ppidb01]# fdisk -l /dev/mapper/mpath13

WARNING: GPT (GUID Partition Table) detected on '/dev/mapper/mpath13'! The util fdisk doesn't support GPT. Use GNU Parted.


Disk /dev/mapper/mpath13: 144.9 GB, 144955146240 bytes
255 heads, 63 sectors/track, 17623 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

               Device Boot      Start         End      Blocks   Id  System
/dev/mapper/mpath13p1               1       17624   141557759+  ee  EFI GPT
[root@ppivs01 970_ppidb01]# partprobe /dev/mapper/mpath13
[root@ppivs01 970_ppidb01]# fdisk -l /dev/mapper/mpath13

WARNING: GPT (GUID Partition Table) detected on '/dev/mapper/mpath13'! The util fdisk doesn't support GPT. Use GNU Parted.


Disk /dev/mapper/mpath13: 144.9 GB, 144955146240 bytes
255 heads, 63 sectors/track, 17623 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

               Device Boot      Start         End      Blocks   Id  System
/dev/mapper/mpath13p1               1       17624   141557759+  ee  EFI GPT
[root@ppivs01 970_ppidb01]# mkswap /dev/mapper/mpath13p1
Setting up swapspace version 1, size = 64999976 kB
[root@ppivs01 970_ppidb01]# 

512  parted /dev/mapper/mpath31 
  513  parted /dev/mapper/mpath32
  514  parted /dev/mapper/mpath32
  515  parted /dev/mapper/mpath33
  516  parted /dev/mapper/mpath34
  517  ls
  518  parted /dev/mapper/mpath35
  519  parted /dev/mapper/mpath36
  520  ls
  521  pvscan
  522  ls
  523  pvcreate /dev/mapper/mpath29p1
  524  vgcreate VG_VA_NS /dev/mapper/mpath29p1
  525  vgextend VG_VA_NS /dev/mapper/mpath29p1
  526  lvcreate /dev/VG_VA_NS -n LV_U46 -l 100%FREE
  527  pvcreate /dev/mapper/mpath30p1
  528  vgextend VG_VA_NS /dev/mapper/mpath30p1
  529  lvcreate /dev/VG_VA_NS -n LV_U47 -l 100%FREE
  530  pvcreate /dev/mapper/mpath31p1
  531  vgextend VG_VA_NS /dev/mapper/mpath31p1
  532  lvcreate /dev/VG_VA_NS -n LV_U48 -l 100%FREE
  533  pvcreate /dev/mapper/mpath32p1
  534  vgextend VG_VA_NS /dev/mapper/mpath32p1
  535  lvcreate /dev/VG_VA_NS -n LV_U49 -l 100%FREE
  536  pvcreate /dev/mapper/mpath33p1
  537  vgextend VG_VA_NS /dev/mapper/mpath33p1
  538  lvcreate /dev/VG_VA_NS -n LV_U50 -l 100%FREE
  539  pvcreate /dev/mapper/mpath34p1
  540  vgextend VG_VA_NS /dev/mapper/mpath34p1
  541  lvcreate /dev/VG_VA_NS -n LV_U51 -l 100%FREE
  542  pvcreate /dev/mapper/mpath35p1
  543  vgextend VG_VA_NS /dev/mapper/mpath35p1
  544  lvcreate /dev/VG_VA_NS -n LV_U52 -l 100%FREE
  545  ls
  546  pvcreate /dev/mapper/mpath36p1
  547  vgcreate VG_VA_WIN /dev/mapper/mpath36p1
  548  lvcreate /dev/VG_VA_WIN -n LV_W01 -l 100%FREE


1. Identify space on SAN accessible by the VS 
2. Ensure a full backup before changing the VM servers
3. Create a SAN volume  - I believe Reuben completed this step
4. Map the SAN volume to two Virtual servers
5. Reboot the virtual servers to see the new volume
6. Setup and verify the VS multipath access to the new volume
7. Partition the volume
8. Reboot both VS servers to see the new partition
9. Map the new volume in the VM configs to the virtual machines
10. Restart all virtual machines and log into the consoles
11. Log into virtual machines, complete reboot checks
12. Install the OCFS2 kernel modules on st2db01
13. Add st2db01 to the existing cluster on st2app01
14. Add st2db01 to the existing cluster on st2app03
15. Configure st2db01 in the existing app01/02 cluster but do not allow access to the existing cluster volume.
16. Reboot st2db01, app01 and app03 to restart the cluster and log into the consoles
17. Log into virtual machines, complete reboot checks
18. Format the new volume using ocfs2, set the correct cluster size. 
19. Mount the new volume on st2app01. Verify access and set permissions
20. Set the shared mount to start at next boot
20. Start the cluster services on st2db01 and west to start at reboot
22. Mount the new cluster volume on st2db01 
23. Set permission on st2db01 and verify cluster access
24. Set the shared mount to start at next boot on st2db01
25. Test the cluster with writes and deletes.
26. Release server to CS for acceptance testing, application testing etc



imap.gmail.com

access-list mod_in permit tcp 10.201.96.64 255.255.255.240 64.18.0.0 255.255.240.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 64.233.160.0 255.255.224.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 66.102.0.0 255.255.240.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 66.249.80.0 255.255.240.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 72.14.192.0 255.255.192.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 74.125.0.0 255.255.0.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 173.194.0.0 255.255.0.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 207.126.144.0 255.255.240.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 209.85.128.0 255.255.128.0 eq 143
access-list mod_in permit tcp 10.201.96.64 255.255.255.240 216.239.32.0 255.255.224.0 eq 143

access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 64.18.0.0 255.255.240.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 64.233.160.0 255.255.224.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 66.102.0.0 255.255.240.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 66.249.80.0 255.255.240.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 72.14.192.0 255.255.192.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 74.125.0.0 255.255.0.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 173.194.0.0 255.255.0.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 207.126.144.0 255.255.240.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 209.85.128.0 255.255.128.0 eq 143
access-list ca-sna-custnet_access_in extended permit tcp host 10.201.96.67 216.239.32.0 255.255.224.0 eq 143


64.18.0.0/20
64.233.160.0/19
66.102.0.0/20
66.249.80.0/20
72.14.192.0/18
74.125.0.0/16
173.194.0.0/16
207.126.144.0/20
209.85.128.0/17
216.239.32.0/19




Server Rename

1. Change snoapp01 name to snoapp01-old and give it an available IP in the SNO vlan 
2. Reboot snoapp01-old 
3. Change snoapp01-new to snoapp01 and give it the snoapp01 IP that is in DNS (current server) and reboot 
4. Tell CS how to access the old server 



old server
chattr -i /etc/sysctl.conf
cd /etc
vi sysconfig/network-scripts/ifcfg-bond0 sysctl.conf sysconfig/network

new server
chattr -i /etc/sysctl.conf
cd /etc
vi  sysctl.conf sysconfig/network hosts fstab mail/sendmail.mc passwd /usr/local/bbc/etc/bb-hosts sysconfig/network-scripts/ifcfg-eth0 (or ifcfg-bond0 if physical machine)

halt the servers

Rename servers on VMM


ON VS Server
Rename VG
vgchange -an
vgrename VG_SNODB11_U01 VG_SNODB01_U01
vgrename VG_SNODB11_OS VG_SNODB01_OS
vgrename VG_SNOAPP11_U01 VG_SNOAPP01_U01
vgrename VG_SNOAPP11_OS VG_SNOAPP01_OS
vgchange -ay

edit the vm.cfg config file to reflect new VG names
Bring up server

Don’t forget, u01 sync, crontabs, shadow file updates

Make sure /u01 and NFS mounts are good on the new box

Add server back to domain
cd /var/cache/samba
service winbind stop
rm -f *.tdb
net ads join
service winbind start




VS Server Change IP Address

vi /etc/ocfs2/cluster.conf /etc/sysconfig/network /etc/sysconfig/network-scripts/ifcfg-bond0 /etc/hosts /usr/local/bbc/etc/bb-hosts

Ensure DNS and reverse-DNS are correct





Postfix

Traditionally you use the "sendmail -q" command to flush mail queue under Sendmail MTA. Under Postfix MTA, just enter the following command to flush the mail queue:
# postfix flush

OR
# postfix -f
To see mail queue, enter:
# postqueue -p
To remove all mail from the queue, enter:
# postsuper -d ALL
To remove all mails in the deferred queue, enter:
# postsuper -d ALL deferred
postfix-delete.pl script
Following script deletes all mail from the mailq which matches the regular expression specified as the first argument (Credit: ??? - I found it on an old newsgroup)
For example, delete all queued messages from or to the domain called fackspamdomain.com, enter:
/root/postfix-delete.pl fackspamdomain.com

Delete all queued messages that contain the word "xyz" in the e-mail address:
/root/postfix-delete.pl xyz




Yum Local Repository

In file /etc/sysconfig/rhn/up2date

Change from

keepAfterInstall[comment]=Keep packages on disk after installation
keepAfterInstall=0

to

keepAfterInstall[comment]=Keep packages on disk after installation
keepAfterInstall=1


Change from

enableRollbacks[comment]=Determine if up2date should create rollback rpms
enableRollbacks=0

to 

enableRollbacks[comment]=Determine if up2date should create rollback rpms
enableRollbacks=1


cd /etc/yum.repos.d
mv existing files to /root or .bak
vi reponame.repo
contents:
[reponame]
name=reponame
baseurl=file:///mnt/patch/oel-repo
gpgcheck=0
enabled=1

vi /etc/yum/pluginconf.d/refresh-packagekit.conf or rhnplugin.conf or security.conf
set enabled=0

vi /etc/sysconfig/rhn/sources
#up2date default

createrepo /location/of/files

yum clean all
yum update
yum update --skip-broken (if necessary)


Paul's procedure for UP2date:

Phase I 

The first phase of the process is to copy the update files from the test servers to the prod servers. NOTE: these are all basic UNIX commands that you are expected to know. These are just an example. There are many approaches to accomplish this task. 

1. Log into tgnapp02.
2. su to root
3. cd /var/spool/up2date
4. run ls -lat to sort files by date. All files in the directory should be from the same day. In this case July 20. If you have files from older updates, you must remove them. You can use the find command  (find ./ -type f -mtime +NN -print | xargs rm -rf      NN = number of days - files older than this will be deleted)
for example, on tgndb02, there are files from Jul20, the recent update and May11 2011. You want to remove all the May 11, 2011 files. In this case, NN = anything  greater than 16 days - 7/20 - 7/31 ==11 days plus  8/1 - 8/4 = 4 days  for a total of 15 days. !^ days will remove all files older than July 20th
.
5. tar the update files to /mnt/patch.  example for tgnapp02
                cd /var/spool 
                tar -cvzf tgnapp02-updates.tgz up2date/
6. scp the tar file to the CA server 
                scp -P 24 /mnt/patch/ tgnapp02-updates.tgz tgnapp01:/mnt/patch/
7. log into tgnapp01
8. su to root
9. Extract the up2date tar file to a directory in /mnt/patch
                cd /mnt/patch
                mkdir app01_up2date
                cd /mnt/patch/app01_up2date
                pwd to verify you are in the correct directory
                tar -xvzf /mnt/patch/ tgnapp02-updates.tgz
                if the extraction is successful, remove the tar file, otherwise return to step 1
                rm /mnt/patch/ tgnapp02-updates.tgz 
                 
Files for tgnapp01 should not be staged. You are expected to fully understand these 9 steps and they should be accomplished by simply stating stage tgnapp02's update files on tgnapp01.

Phase II

Apply the updates from the staged files.

1. log into tganapp01, su to root 
2. get the repository parameter name file from the repo
                a. cd /mnt/patch/app01_up2date/    this directory is named in step 9 above 
                b ls -lat
                c ol5_i386_latest.20120719191125  :  the repo parameter file will always be the non-rpm, non-header file - the last one to display y ls -lat 
3. vi /etc/sysconfig/rhn/sources
                comment out the default
                                a,  change
                                ### The default RHN (using "default" as the url means use the one in the
                                ### up2date config file). This is required.
                                up2date default

                to            
                                ### The default RHN (using "default" as the url means use the one in the
                                ### up2date config file). This is required.
                                #up2date default

                Add your new directory source
                                ### A local directory full of packages (a "dir" repo). For example:
                                #dir my-favorite-rpms-i386-9 /var/spool/RPMS/
                                ### Note: this is where you extracted the  files from step 9 above
                                dir ol5_i386_latest.20120719191125  /mnt/patch/app01_up2date/      

4. Edit the /etc/sysconfig/rhn/up2date files and remove the proxy access. this will ensure there is no possible chance thath the up2date process can use the Internet sources
            vi /etc/sysconfig/up2date
            change  
                        enableProxy=1
            to         
                        enableProxy=0

5. run up2date -u
            updates should run from the /mnt/patch/app01_up2date sources

6. follow all other OS update steps and checklists

7. repeat the process for tgnadb01 using tgndb02 as the source.














Inventory

309 physical servers:  180 servers in ca 129 physical servers in VA
206 virtual servers: 	177 Oracle Virtual Machines, 29 VM ware hosts

515 total servers

671 TB 	storage 389TB VA, 282 in CA

23 SANs

14 Fiber Channel switches

52 Total firewalls/VPN devices: 38 Client managed Firewalls, 14 MTG Firewalls

61,080+ Access-list on firewalls

6 IPS/IDS modules

59 total routers and switches     

344 management devices: 184 CA management devices, 158 VA management devices (remote access consoles, console servers, PDUs



We have agreements in place with other customers. 

SFTP is a path out of our data centers. It is encrypted so we cannot guarantee the confidentially of their data. The customer needs to sign off that we cannot and will not monitor this connection and are not responsible for data transferred

Who is the Sm responsible for this customer's change control?  What type of data is on the system? If IT opens access and privacy laws regarding data are broken, the change approver can be held personally liable. The IT service desk staff that opens the access will not have any legal accountability. This should be a very serious concern for all Service managers and change approvers. We are trying to protect you and the company.

I recommend researching all your local laws and the laws where our customers do business. In addition, look at all the laws pending in all states and the federal level. Corporations cannot protect individual employees when privacy laws are broken. The corporations will have their own legal and financial issues.


Add vlan to 3130 and setup trunking to vss

va-ash-3130-03(config)#interface Port-channel62
va-ash-3130-03(config-if)#switchport trunk allowed vlan add 180

va-ash-vss01(config)#int po62
va-ash-vss01(config-if)#switchport trunk allowed vlan add 180




MTG San to SAN replication:

97   mtg-comp-01                      active    Gi4/37, Gi4/38
98   mtg-comp-02                      active    Gi3/37, Gi3/38


vlan 97 
name mtg-comp-01

vlan 98
name mtg-comp-02



interface Vlan97
 description MTG Compellent 01 interface 
 ip vrf forwarding MTGSAN
 ip address 10.202.97.97 255.255.255.248
no shut


interface Vlan98
 description MTG Compellent 02 interface 
 ip vrf forwarding MTGSAN
 ip address 10.202.97.105 255.255.255.248
no shut

interface fa4/11
 description compellent 97.99
 switchport
 switchport access vlan 97
 switchport mode access
 ip vrf forwarding MTGSAN



interface fa4/12
 description compellent 97.99
 switchport
 switchport access vlan 97
 switchport mode access
 ip vrf forwarding MTGSAN


interface fa3/11
 description compellent 97.107
 switchport
 switchport access vlan 98
 switchport mode access
 ip vrf forwarding MTGSAN


interface fa3/12
 description compellent 97.107
 switchport
 switchport access vlan 98
 switchport mode access
 ip vrf forwarding MTGSAN



interface Port-channel6
 description MTGSAN po 6 to 3750 TWT ELAN VRF
 ip vrf forwarding MTGSAN
 ip address 192.168.195.222 255.255.255.252
shut


interface FastEthernet3/48
 description MTGSAN po 6 to 3750 TWT ELAN
 ip vrf forwarding MTGSAN
 no ip address
 channel-group 6 mode on


interface FastEthernet3/48
 description MTGSAN po 6 to 3750 TWT ELAN 
 ip vrf forwarding MTGSAN
 no ip address
 channel-group 6 mode on


!
interface Tunnel97
 description MTGSAN ELAN GRE Tunnel to CA
 ip vrf forwarding MTGSAN
 ip address 192.168.195.226 255.255.255.252
 keepalive 10 3
 tunnel source 192.168.195.222
 tunnel destination 192.168.195.230
 tunnel vrf MTGSAN


ip route vrf MTGSAN 192.168.195.230 255.255.255.255 192.168.195.221



interface Port-channel6
 description PO interface to MTGSAN 6509 Router
 no switchport
 ip vrf forwarding TWT
 ip address 192.168.195.221 255.255.255.252
no shut


interface FastEthernet1/0/48
 description PO interface to MTGSAN VRF 6509 Router
 no switchport
 no ip address
 channel-group 6 mode on

interface FastEthernet2/0/48
 description PO interface to MTGSAN VRF 6509 Router
 no switchport
 no ip address
 channel-group 6 mode on

9



interface Port-channel6
 description MTGSAN po 6 to 3750 TWT ELAN VRF
 ip vrf forwarding MTGSAN
 ip address 192.168.195.230 255.255.255.252
shut


interface gi3/20
 description MTGSAN po 6 to 3750 TWT ELAN
 ip vrf forwarding MTGSAN
 no ip address
 channel-group 6 mode on


interface Gi4/20
 description MTGSAN po 6 to 3750 TWT ELAN 
 ip vrf forwarding MTGSAN
 no ip address
 channel-group 6 mode on


!
interface Tunnel97
 description MTGSAN ELAN GRE Tunnel to VA
 ip vrf forwarding MTGSAN
 ip address 192.168.195.225 255.255.255.252
 keepalive 10 3
 tunnel source 192.168.195.230
 tunnel destination 192.168.195.222
 tunnel vrf MTGSAN


ip route vrf MTGSAN 192.168.195.222 255.255.255.255 192.168.195.229



interface Port-channel6
 description PO interface to MTGSAN 6509 Router
 no switchport
 ip vrf forwarding TWT
 ip address 192.168.195.229 255.255.255.252
no shut


interface FastEthernet1/0/15
 description PO interface to MTGSAN VRF 6509 Router
 no switchport
 no ip address
 channel-group 6 mode on

interface FastEthernet2/0/15
 description PO interface to MTGSAN VRF 6509 Router
 no switchport
 no ip address
 channel-group 6 mode on





router eigrp 16
 no auto-summary
 !        
 address-family ipv4 vrf MTGSAN
  redistribute connected
  redistribute static
  network 10.201.97.96 0.0.0.7
  network 192.168.195.228 0.0.0.3
  network 192.168.195.224 0.0.0.3
  no auto-summary
  autonomous-system 16
 exit-address-family

################### VA EIGRG for VRF MTGSAN


router eigrp 16
 no auto-summary
 !        
 address-family ipv4 vrf MTGSAN
  redistribute connected
  redistribute static
  network 10.202.97.96 0.0.0.7
network 10.202.97.104 0.0.0.7
  network 192.168.195.220 0.0.0.3
  network 192.168.195.224 0.0.0.3
  no auto-summary
  autonomous-system 16
 exit-address-family







Process for multipath on clone (root boot MP off SAN):

1.	/sbin/scsi_id -g -u -s /block/sdN        sdN = the OS device

2.	 vi /sbin/mkinitrd
change WWID (2nd instance - CAP WWID below just search for "360")

    for wwid in $root_wwids ; do
        emit "/bin/multipath -v 0 $wwid"
    done         
   emit "/bin/multipath -v 0 WWID"


3.	build ramdisk
a.	mkinitrd  --with=dm-rdac /boot/initrd-2.6.18-128.2.1.4.44.el5xenmp.img `uname –r`

                *** ensure initrd-2.6.18-128.2.1.4.44.el5xen.img matches your current kernel and add the “mp” 

edit the grub.conf to use the init file
mv /etc/blkid/blkid.tab /etc/blkid/blkid.tab.bak
after it boots verify using df (should see /dev/mapper/mpathNpN for boot root)

Process for multipath on new installs:

4.	/sbin/scsi_id -g -u -s /block/sda

5.	Cd /sbin
6.	cp mkinitrd mkinitrd.disti
7.	 vi /sbin/mkinitrd
change use_multipath=0 to use_multipath=1
                
change:
    for wwid in $root_wwids ; do
        emit "/bin/multipath -v 0 $wwid"
    done

to

    for wwid in $root_wwids ; do
        emit "/bin/multipath -v 0 $wwid"
    done         
   emit "/bin/multipath -v 0 WWID"

WWID is from step #1  above

8.	edit /etc/sysconfig/mkintrid/multipath
a.	change MULTIPATH=no to MULTIPATH=yes

9.	build ramdisk
a.	mkinitrd  --with=dm-rdac /boot/ initrd-2.6.18-128.2.1.4.44.el5xenmp.img `uname –r`

                *** ensure initrd-2.6.18-128.2.1.4.44.el5xen.img matches your current kernel and add the “mp” 

10.	edit grub - add new section for new ram disk

change :
# Detect64 claims this is 64 bit box
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title Oracle VM server (2.6.18-128.2.1.4.44.el5xen)
        root (hd0,0)
#       kernel /xen-64bit.gz dom0_mem=569M
        kernel /xen-64bit.gz dom0_mem=1024M
        module /vmlinuz-2.6.18-128.2.1.4.44.el5xen ro root=UUID=73ad0ac3-6b42-4d1a-9fb0-3e4ad99038f5
        module /initrd-2.6.18-128.2.1.4.44.el5xen.img

to:

# Detect64 claims this is 64 bit box
default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
#hiddenmenu
title Oracle VM server (2.6.18-128.2.1.4.44.el5xen) MP
        root (hd0,0)
        kernel /xen-64bit.gz dom0_mem=1024M
        module /vmlinuz-2.6.18-128.2.1.4.44.el5xen ro root=UUID=73ad0ac3-6b42-4d1a-9fb0-3e4ad99038f5
        module /initrd-2.6.18-128.2.1.4.44.el5xenmp.img
title Oracle VM server (2.6.18-128.2.1.4.44.el5xen)
        root (hd0,0)
        kernel /xen-64bit.gz dom0_mem=1024M
        module /vmlinuz-2.6.18-128.2.1.4.44.el5xen ro root=UUID=73ad0ac3-6b42-4d1a-9fb0-3e4ad99038f5
        module /initrd-2.6.18-128.2.1.4.44.el5xen.img


11.	mv /etc/blkid/blkid.tab v /etc/blkid/blkid.tab.nonmp



VS Server Stuff


vi /etc/hosts /etc/sysconfig/network /etc/resolv.conf /etc/mail/mailertable /etc/mail/sendmail.mc 
  503  more /etc/modprobe.conf
  504  vi /etc/modprobe.conf
  505  cd /etc/sysconfig/network-scripts/
  506  ls
  507  vi ifcfg-eth*
  508  ls
  509  df 
  510  vi /etc/fstab
  511  cd /usr/local/bbc/
  512  vi etc/bb-hosts
  513  reboot
  514  ps -ef
  515  df
  516  ifconfig -a
  517  vi /etc/sysconfig/network-scripts/ifcfg-bon0
  518  vi /etc/sysconfig/network-scripts/ifcfg-bon0\
  519  cd /etc/sysconfig/network0-
  520  cd /etc/sysconfig/network-scripts/
  521  ls
  522  ifcfg-bond00
  523  ifcfg-bond0
  524  vi ifcfg-bond0
  525  netstat -rn
  526  service netwrok restart 
  527  service network restart 
  528  cd /etc/xen/scripts/
  529  ls
  530  ./network-bridge
  531  ./network-bridge start
  532  reboot
  533  ls
  534  ls
  535  ls -la
  536  lz
  537  cd /dev/mapper/
  538  ls
  539  ls -la
  540  df
  541  ls
  542  fdisk -l /dev/mapper/mpath10
  543  fdisk -l /dev/mapper/mpath11
  544  fdisk -l /dev/mapper/mpath12
  545  las
  546  ls
  547  fdisk -l /dev/mapper/mpath8
  548  fdisk -l /dev/mapper/mpath9
  549  fdisk -l /dev/mapper/mpath10
  550  df
  551  parted /dev/mapper/mpath10
  552  mkfs.ocfs2 /dev/mapper/mpath10p1 
  553  /opt/ovs-agent-latest/utils/repos.py -n /dev/mapper/mpath10p1 
  554  /opt/ovs-agent-latest/utils/repos.py -r 8bb620fd-e85d-43bc-bf5e-219ab95eabe0
  555  /opt/ovs-agent-latest/utils/repos.py -i
  556  df
  557  cd /etc/
  558  more hosts
  559  cd /etc/ocfs2/
  560  ls
  561  more cluster.conf 
  562  /opt/ovs-agent-latest/utils/repos.py -l
  563  /opt/ovs-agent-latest/utils/repos.py 
  564  /opt/ovs-agent-latest/utils/repos.py -d 8a5e2542-7a2d-4783-b78c-d6c26892b24b
  565  /opt/ovs-agent-latest/utils/repos.py -i
  566  /opt/ovs-agent-latest/utils/repos.py -l
  567  /opt/ovs-agent-latest/utils/repos.py -d 8a5e2542-7a2d-4783-b78c-d6c26892b24b
  568  /opt/ovs-agent-latest/utils/cleanup.py 
  569  /opt/ovs-agent-latest/utils/repos.py -n /dev/mapper/mpath10p1 
  570  /opt/ovs-agent-latest/utils/repos.py -r  8bb620fd-e85d-43bc-bf5e-219ab95eabe0
  571  /opt/ovs-agent-latest/utils/repos.py -i
  572  df
  573  cd /dev/mapper/
  574  ls
  575  fdisk -l /dev/mapper/mpath11
  576  parted /dev/mapper/mpath11
  577  fdisk -l /dev/mapper/mpath8
  578  parted /dev/mapper/mpath8
  579  ls
  580  pvcreate /dev/mapper/mpath8p2
  581  vgcreate VG_HNIDB01_OS /dev/mapper/mpath8p2
  582  lvcreate /dev/VG_HNIDB01_OS -n LV_ROOT -L 10G
  583  lvcreate /dev/VG_HNIDB01_OS -n LV_VAR -L 10G
  584  lvcreate /dev/VG_HNIDB01_OS -n LV_TMP -L 10G
  585  lvcreate /dev/VG_HNIDB01_OS -n LV_USR -L 15G
  586  lvcreate /dev/VG_HNIDB01_OS -n LV_HOME -l 100%FREE
  587  lvscan
  588  mkfs.ext3 /dev/VG_HNIDB01_OS/LV_ROOT ; mkfs.ext3 /dev/VG_HNIDB01_OS/LV_TMP ; mkfs.ext3 /dev/VG_HNIDB01_OS/LV_USR ; mkfs.ext3 /dev/VG_HNIDB01_OS/LV_VAR ; mkfs.ext3 /dev/VG_HNIDB01_OS/LV_HOME 
  589  cd /mnt
  590  ls
  591  rm backup
  592  rmdir backup1/ tmp/
  593  rm- r backup1/ tmp/
  594  rm -r backup1/ tmp/
  595  ls
  596  mkdir d01
  597  cd d01
  598  ls /mnt/backups/hnidb02/
  599  mkdir home root var usr
  600  mount /dev/VG_HNIDB01_OS/LV_ROOT /mnt/d01/root/
  601  mount /dev/VG_HNIDB01_OS/LV_USR /mnt/d01/usr/
  602  mount /dev/VG_HNIDB01_OS/LV_VAR /mnt/d01/var/
  603  mount /dev/VG_HNIDB01_OS/LV_HOME /mnt/d01/home/
  604  cd rot
  605  ls
  606  cd root/
  607  ls
  608  restore -rf /mnt/backups/hnidb02/root.0.bkup 
  609  cd ..
  610  rm root/restoresymtable 
  611  cd var
  612  ls
  613  restore -rf /mnt/backups/hnidb02/var.0.bkup 
  614* rm restoresymtable
  615  cd ..
  616  cd home/
  617  restore -rf /mnt/backups/hnidb02/home.0.bkup 
  618  rm restoresymtable 
  619  ls
  620  rm -f mtg/*
  621  cd ..
  622  ls
  623  cd usr/
  624  ls
  625  restore -rf /mnt/backups/hnidb02/usr.0.bkup 
  626  ls
  627  rm restoresymtable

  629  df
  630  /sbin/scsi_id -g -u -s /block/sda
  631  vi /sbin/mkinitrd
  632  history | grep mkin
  633   mkinitrd -f --rootdev LABEL=/root --with=dm-rdac /boot/initrd-2.6.18-128.2.1.4.44.el5xenmp.img 2.6.18-128.2.1.4.44.el5xen
  634  hisotyr

Clean var

Cd /mnt/d01/var

rm -rf spool/cron/[admo]* spool/mail/* tmp/* log/boot.log* log/anaconda.* log/cron* log/maillog* log/messages* log/up2date* log/secure* log/spooler* log/Xorg.0.log* log/samba/*  log/cups/



Clean Root and rename: 

Cd /mnt/d01/root


vi etc/hosts etc/sysctl.conf etc/aliases etc/motd etc/issue etc/issue.net etc/sysconfig/network  etc/pam.d/system-auth etc/krb5.conf etc/ssh/sshd_config ssh/sshd_config.mtg etc/samba/smb.conf etc/resolv.conf etc/passwd etc/shadow etc/group  etc/fstab  etc/sysconfig/network-scripts/ifcfg-eth* usr/local/bbc/etc/bb-hosts


OMPLUS
cpio -iv < cpiorel2
 1013  ls
 1014  ./ominstall 
 1015  ./ominstall 
 1016  ls
 1017  cd /usr/lpplus/
 1018  ls
 1019  ls printers/
 1020  tar -xzvf /root/printers.tgz 
 1021  which lp
 1022  cd /usr/bin
 1023  unlink lp
 1024  ln -s /usr/lpplus/bin/dcclp /usr/bin/lp
 1025  ll /usr/bin/lp
 1026  ll lpstat
 1027  unlink lpstat
 1028  ln -s /usr/lpplus/bin/lpstat /usr/bin/lpstat
 1029  unlink lpr
 1030  ln -s /usr/lpplus/bin/dcclpr /usr/bin/lpr
dcchealth
chmod 755 /usr/lpplus/uf_pdf2ps1.dat
cd /usr/lpplus/system/
chown ompsys2 lock.snoapp01.sunopta.com
mv start_lpd.snoapp11.sunopta.com start_lpd.snoapp01.sunopta.com
mv start_remote.snoapp11.sunopta.com start_remote.snoapp01.sunopta.com

/usr/lpplus/constants/enable_file
Then run command dccfree and selected option 15

[root@snoapp01 constants]# dccfree

Restarts and Utilities
    Menu

Free trial resets:
    0 - OMPlus product
    1 - Archive product
    2 - HTML interface
    3 - LPPlus product
    4 - RDPlus product
    5 - R/3 (SAP) interface
    6 - VSIFAX interface
    7 - Pager interface
    8 - QAPlus agents
    9 - RBPlus
   10 - Paxar support
   11 - CDPlus product
   12 - PDPlus
   13 - Click Charge
   14 - PrintRelease
Other operations:
   15 - Enable products (Enable file in place)
   16 - Display product status
    X - Exit

Enter Code: 15
Enable codes for the OMPlus product replaced.
The registration file is successfully updated.

OMPlus product --- present, enabled for 125 destinations.
Archive product --- not present
HTML interface --- not present
LPPlus product --- not present
RDPlus product --- not present
R/3 (SAP) interface --- not present
VSIFAX interface --- not present
Pager interface --- not present
QAPlus agents --- not present
RBPlus --- not present
Paxar support --- not present
CDPlus product --- not present
PDPlus --- not present
Click Charge --- not present
PrintRelease --- not present
[root@snoapp01 constants]#



1007  rpm -ihv openmotif-2.3.1-6.1.el5_8.i386.rpm 
 1008  rpm -ihv openmotif-devel-2.3.1-6.1.el5_8.i386.rpm 
 1009  rpm -ihv libXp-1.0.0-8.1.el5.i386.rpm 
 1010  rpm -ihv libXp-devel-1.0.0-8.1.el5.i386.rpm 
 1011  rpm -ihv libXpm-3.5.5-3.i386.rpm 
 1012  rpm -Uhv libXpm-3.5.5-3.i386.rpm 
 1013  rpm -Uhv libXpm-devel-3.5.5-3.i386.rpm 
 1014  rpm -ihv libXmu-1.0.2-5.i386.rpm 
 1015  rpm -ihv libXmu-devel-1.0.2-5.i386.rpm 
 1016  rpm -ihv xorg-x11-util-macros-1.0.2-4.fc6.i386.rpm 
 1017  rpm -ihv libXmu-devel-1.0.2-5.i386.rpm 
 1018  rpm -ihv openmotif-devel-2.3.1-6.1.el5_8.i386.rpm 
 1019  rpm -ihv openmotif22-2.2.3-20.i386.rpm 
 1020  ls
 1021  rpm -ihv freetype-2.2.1-31.el5_8.1.i386.rpm 
 1022  rpm -ihv freetype-devel-2.2.1-31.el5_8.1.i386.rpm 
 1023  ls
 1024  cd xpdf-3.02
 1025  ./configure
 1026  more INSTALL 
 1027  ls /usr/lib/*free*
 1028  ./configure --with-freetype2-library=PATH
 1029  ./configure --with-freetype2-library=/usr/lib
 1030  ./configure --with-freetype2-library=/usr/lib/
 1031  cd ..
 1032  rpm -ihv freetype-demos-2.2.1-31.el5_8.1.i386.rpm 
 1033  ls -la *rpm
 1034  ls
 1035  cd xpdf-3.02
 1036  more INSTALL 
 1037  ./configure --with-freetype2-library=/usr/lib/ -with-freetype2-includes=/usr/include/freetype2/
 1038  make
 1039  ls
 1040  cd xpdf/
 1041  ls
 1042  cp pdftops /usr/lpplus/




All there was a request in the Urgent queues to move printers from ndca1 (rhel 4.x) to ndca2 (rhel 5.x)

Background:
                NDCA2 had 10 printers that were not on ndca1 and SM wanted those to stay but setup all printers from ndca1 on ndca2.

Resolution:
                Stopped cups service on both servers
made a backup of the /etc/cups dir on ndca2 to /etc/cups.backup
Copied from ndca1 to ndca2:
                /etc/cups/ppd (all PPD files)
                /etc/cups/printers.conf

                Test to make sure the printers are now in place:
                                Start the cups service
                                Open up the printer icon and you should see the printers.

Only issue was that this way removed the 10 printers that were on this server to begin with.  So what was done to put them back on was this.
                Stop cups service on ndca2 again
                Copy the PPD files from /etc/cups.backup/ppd to /etc/cups/ppd (this just added those files back to the dir since none were there)
                Edited the /etc/cups/printers.conf file
                Went to the bottom of the file, and copied the all info from /etc/cups.backup/printer.conf file to /etc/cups/printers.conf
                Saved the changes
                Started the cups service 
                Verified all the printers that were copied from NDCa1 and the original 10 printers from ndca2 were all in ndca2.

Released back to CS for them to have the customer test all printers on NDCA2 to work.

If CS comes back and says they are not working, then what  we did will have to get backed out and then manually add them.



Steve,

I can understand the confusion. Elise’s documentation is correct. Deloitte globally uses the entire 10.0.0.0/8 range internally, meaning that some member firm, be it the UK, Japan, etc, will own the 10.92.x.x range. What we do internally is perform one-to-one destination NATs so we can route traffic bound for you internally to the proper set of perimeter firewalls. If I tried natively routing from my desk to 10.92.102.3, for example, I would route directly to the member firm within Deloitte that owns that address space, and not toward your VPN device. 

So, for example, what I’d do is ssh to 167.219.144.144, which does route me the proper direction. In most cases, what we do is terminate the VPN directly on our firewall and the customer’s  firewall at the remote site. What that allows is to route the traffic all the way to the customer’s firewall (obviously they have to configure their unit to accept 167.219.x.x in their encryption domain), and once they receive it, the traffic can be NAT’d into its proper address. 

What’s unique about this situation, and this should have been explained, is that Elise has assigned addresses from the same network in which your device sits. That adds a new hurdle, where your device will have to proxy ARP for the traffic, as both my firewall and yours sit on the 167.219.144.x network. Since my firewall believes, in this case, 167.219.144.144 is off of his local interface, it will not attempt to route, but instead will ARP to deliver the traffic directly to the address. 

Now, if you have no way to support this, I don’t see a problem with me having Elise hand you addressing from a different subnet. That way we can route the traffic over to your 167.219.144.x  interface directly. At that point, you’d still have to NAT it for things to work. 

I know that’s a lot to absorb. Does it make sense?

Michael 



xserver
vi /root/.vnc/xstartup
uncomment the two lines




DFTAB BB
/u01 is reporting red for several days:

http://va-ash-ns01/bb/html/a10db11.disk.html

to resolve, see instructions at: http://va-ash-ns01/bb/help/bb-man.html#6.1  or  follow steps below
 
1. log into a10db11 and su to root

 

then su to "bb"

 

edit the ~/etc/bb-dftab, if one does not exist, copy the /usr/local/bbc/etc/bb-dftab.DIST  /usr/local/bbc/etc/bb-dftab

 

read the file

 

remove the default entries for usr, home. db and add one for /u01

add this: 

/u01:97:99

Save the file

go to BB and watch the red turn green ....

we covered this last month in our team meeting so please keep these instructions. You can apply the same for the other files (bb-cputab, bb-proctab etc



SAR

cd /tmp

sar -A  >> sar.out

or 

sar -u  >> sar.out   ** just totals for all CPUs

or

sar and any option you choose

java -jar /root/ksar/kSar.jar -input sar.out -outputPDF hnidb12-sar.pdf

 zip hnidb12-sar.zip hnidb12-sar.pdf 

echo "hnidb12 sar" | mutt -s "hnidb12 SAR" -a hnidb12-sar.zip  NAME@mercurytechnology.com


Paul's note:
All sar output is captured each day in the /mnt/backups/sar-out folder


To generate reports, cd /mnt/backups/sar-out

Find the day you require – 9/15 in example.

java -jar /root/ksar/kSar.jar -input sar.201209152353 -outputPDF sriapp01-20120915-sar.pdf

zip sriapp01-20120915-sar.zip sriapp01-20120915-sar.pdf

echo "sriapp01 sar 09152012" | mutt -s "sriapp01 SAR 9/15" -a sriapp01-20120915-sar.zip  NAME@mercurytechnology.com


NOTE change sriapp01-20120915-sar.zip to sriapp01-DATE-sar.zip for each day you run

Note – if you receive errors running ksar -0 run it from the NS server on /u0X/baclkups/XXX/xxxxxxx

Some server have bad libraries because we implemented changes per sm request that were not correct 



More SAR:

Log into va-ash-ns01

cd /u26/backup/SRI/sriapp01/OS/sar-out

For each date 9/20, 9/14, 9/11, 8/23, 8/20, 8/1 run:


java -jar /root/ksar/kSar.jar -input sar.201209202352 -outputPDF sriapp01-sar.201209202352.pdf

zip sriapp01-sar.201209202352.zip sriapp01-sar.201209202352.pdf 

echo sriapp01-sar | mutt -s "sriapp01 SAR DATE" -a sriapp01-sar.201209202352.zip  paul.weyman@mercurytechnology.com


**** Change sar.201209202352, sriapp01-sar.201209202352.pdf and sriapp01-sar.201209202352.zip  to the correct date requested below 

Change DAT in subject field to the correct date





fdisk shows dm devices instead of mpath devices:
Fix = edit the /etc/lvm/lvm.conf file

 # list of regular expressions in turn and the first match is used.
    #preferred_names = [ ]

    # Try to avoid using undescriptive /dev/dm-N names, if present.
    preferred_names = [ "^/dev/mpath/", "^/dev/mapper/mpath", "^/dev/[hs]d" ]





FWSM on Router

For the router in VA, you need to logon to the FWSM (not the one in the VSS, the one in the 6509RTR)

va-ash-6509-rtr#sh mod
Mod Ports Card Type                              Model              Serial No.
--- ----- -------------------------------------- ------------------ -----------
  1    0  2 port adapter Enhanced FlexWAN        WS-X6582-2PA       JAB0819089R
  2    0  2 port adapter Enhanced FlexWAN        WS-X6582-2PA       JAE11043Q0H
  3   48  48-port 10/100 mb RJ45                 WS-X6148-RJ45V     SAL08207WYJ
  4   48  48-port 10/100 mb RJ45                 WS-X6148-RJ45V     SAL08207X5Q
  5    2  Supervisor Engine 720 (Hot)            WS-SUP720-BASE     SAD081103E3
  6    2  Supervisor Engine 720 (Active)         WS-SUP720-BASE     SAD08490ELF
  7    6  Firewall Module                        WS-SVC-FWM-1       SAD10510BEV
  8    6  Firewall Module                        WS-SVC-FWM-1       SAD094609NX
  9    8  Intrusion Detection System             WS-SVC-IDSM-2      SAD11050AZU

Logon to module 7 – we are not using FWSM in slot 8 yet:

va-ash-6509-rtr#session slot 7 processor 1
The default escape character is Ctrl-^, then x.
You can also type 'exit' at the remote prompt to end the session
Trying 127.0.0.71 ... Open


User Access Verification

Use standard Cisco logon until we get AD auth setup on this device

Password: 
Type help or '?' for a list of available commands.
va-fwsm-rtr-01-pri> ena
Password: ********
va-fwsm-rtr-01-pri#
va-fwsm-rtr-01-pri# sh run | grep context
admin-context admin
context admin
context RTI-FW
prompt hostname context 
va-fwsm-rtr-01-pri# changeto context RTI-FW
va-fwsm-rtr-01-pri/RTI-FW# sh run
: Saved
:
FWSM Version 4.1(8) <context>
!
hostname RTI-FW
enable password 8Ry2YjIyt7RRXU24 encrypted
names
dns-guard
!
interface Vlan310
 nameif RTI_inside
 security-level 100
 ip address 10.202.104.14 255.255.255.240 standby 10.202.104.12 
!
interface Vlan311
 nameif RTI_outside
 security-level 0
 ip address 216.149.252.10 255.255.255.252 
!
passwd 2KFQnbNIdI.2KYOU encrypted
access-list rti_inside_in extended permit tcp 10.202.104.0 255.255.255.240 192.168.80.0 255.255.255.0 eq 1420 
access-list rti_inside_in extended permit tcp 10.202.104.0 255.255.255.240 172.21.0.0 255.255.0.0 eq 1420 
access-list rti_inside_in extended permit tcp 10.202.104.0 255.255.255.240 10.0.0.0 255.0.0.0 eq 1420 
access-list rti_inside_in extended permit tcp 10.202.104.0 255.255.255.240 192.168.80.0 255.255.255.0 eq 9100 
access-list rti_inside_in extended permit icmp 10.202.104.0 255.255.255.240 192.168.80.0 255.255.255.0 echo 
va-fwsm-rtr-01-pri/RTI-FW#




NetAPP


On the Net app filer CLI:

disk show -a
 Shows all disks that have an owner
 
disk show [-o hostname | -s nvram_id] 

 Shows all disks owned by a specified host or its NVRAM ID (the NVRAM number shipped with the filer head)
 
disk show -n
 Shows all the disks that do not have an owner
 
disk show -v
 Shows all the visible disks

Once you determine the ownership of the bad drive, replace it, then assign it to the host's spare pool.


Use the following command to assign the disks that are labeled "not owned" to one of the filer heads.

disk show -n

disk assign {disk1 [disk2] [...]|all} 

disk1 [disk2] [...] are the names of the disks to which you want to assign ownership.

all is the option to assign all of the unowned disks to the current filer head.

Example
The following command assigns six disks on the FAS270c to the filer fh1:

fh1> disk assign 0b.43 0b.41 0b.39 0b.37 0b.35 0b.33

Result
The specified disks are assigned as disks to the specified filer.



ppi-hq-asa(config)# packet-tracer input outside udp 172.17.10.245 isakmp 174.47.15.5.isakmp detailed

Phase: 1
Type: ROUTE-LOOKUP
Subtype: input
Result: ALLOW
Config:
Additional Information:
in   0.0.0.0         0.0.0.0         outside

Phase: 2
Type: ACCESS-LIST
Subtype: 
Result: DROP
Config:
Implicit Rule
Additional Information:
 Forward Flow based lookup yields rule:
 in  id=0xc95ed6b0, priority=500, domain=permit, deny=true
        hits=1, user_data=0x6, cs_id=0x0, reverse, flags=0x0, protocol=0
        src ip=172.17.10.245, mask=255.255.255.255, port=0
        dst ip=0.0.0.0, mask=0.0.0.0, port=0, dscp=0x0

Result:
input-interface: outside
input-status: up
input-line-status: up
output-interface: outside
output-status: up
output-line-status: up
Action: drop  
Drop-reason: (acl-drop) Flow is denied by configured rule




JDK - upgrade

copy jdk-6u31-linux-x64.bin from /mnt/patch/patches/Disco to /usr/lib/jvm as root, chmod a+x jdk-6u31-linux-x64.bin ./ jdk-6u31-linux-x64.bin

After JDK in installed run following two commands

alternatives --install /usr/bin/java java /usr/lib/jvm/jdk1.6.0_31/bin/java 120 --slave /usr/bin/keytool keytool /usr/lib/jvm/jdk1.6.0_31/bin/keytool --slave /usr/bin/rmiregistry rmiregistry /usr/lib/jvm/jdk1.6.0_31/bin/rmiregistry

alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk1.6.0_31/bin/javac 120 --slave /usr/bin/jar jar /usr/lib/jvm/jdk1.6.0_31/bin/jar --slave /usr/bin/rmic rmic /usr/lib/jvm/jdk1.6.0_31/bin/rmic

Then run following command and which will show you to set current JDK env.
alternatives --config java

Choose new installed JDK 31





WIKI


URL is actually http://wiki.mercurytechnology.com/index.php/Infrastructure:How-to:Starting_SSH_on_Sun_Solaris

Need the index.php/

To keep IT pages in the IT namespace, new pages should start like the following:


“:” instead of / will put the pages in the Infrastructure name space.


The underscore “_” in the URL will translate to spaces in the newly created page title.  Entering a page like above is all that is required to create a new Wiki page. 

When the page displays, you have successfully created a new page. At that point, select Edit to enter you text. You can use the wiki wysiwyg editor and can enter most HTML code for more advanced formatting.



When you create a page, you can add a category to the bottom of your pages:

[[Category:Name]]

Name = FAQ, How-to, Procedure, Policy, Process, Vendor, or Doc


AWK

tar -tzvf openssh6.0p1.tgz > tmp.lst
 1036  more tmp.lst 
 1037    cat tmp.lst | awk '{print $NF}' > tmp.lst2
 1038  more tmp.lst2
 1039  rm `cat tmp.lst2`
 1040  rm -f `cat tmp.lst2`
 1041  ls
 1042  rm -rf BACK*
 1043  rm -rf contrib/ openbsd-compat/ regress scard
 1044  ls
 1045  mkdir openssh6
 1046  mv openssh6.0p1.tgz openssh6
 1047  cd openssh6/
 1048  history



VS Server - after IP change of VS server

Force removal but do not remove files

log into each VS server and set the ovs passwd by running service ovs-agent configure. Hit enter for all optiopns until password question. When you recreate the server pools, use the password you set in the server agent password. Use root and the root passed for utility.

Once the server pools are up, import the Vm in the resources tab



SMB Ports
access-list yme_in permit tcp host 10.202.102.3 host 192.168.102.21 eq 445
access-list yme_in permit tcp host 10.202.102.3 host 192.168.102.21 eq 139
access-list yme_in permit udp host 10.202.102.3 host 192.168.102.21 range 137 138



Winbind AD Auth on OEL 6

yum install nss-pam-ldapd
env LANG=C authconfig-tui


NFS Automounter

1. edit fstab - comment out the VA-ASH_NS0X mounts

2. edit the /etc/auto.master and add /mnt /etc/auto.nfs

Should only have these two lines when complete:

/export/home /etc/auto.home
/mnt /etc/auto.nfs


3. create the /etc/auto.nfs

add below entries *** these are for BAS. substitute the server name and cust code for you editing

backups  -proto=tcp,hard,intr,bg,nfsvers=3,rsize=65536,wsize=65536  va-ash-ns04,va-ash-ns01n,va-ash-ns05,va-ash-ns06:/CUST/BAS01/backup/basdb11
failover  -proto=tcp,hard,intr,bg,nfsvers=3,rsize=65536,wsize=65536  a-ash-ns04,va-ash-ns01n,va-ash-ns05,va-ash-ns06:/CUST/BAS01/failover/basdb11
rman  -proto=tcp,hard,intr,bg,nfsvers=3,rsize=65536,wsize=65536  a-ash-ns04,va-ash-ns01n,va-ash-ns05,va-ash-ns06:/CUST/BAS01/rman/basdb11
retention  -proto=tcp,hard,intr,bg,nfsvers=3,rsize=65536,wsize=65536  a-ash-ns04,va-ash-ns01n,va-ash-ns05,va-ash-ns06:/CUST/BAS01/retention/basdb11
patch -proto=tcp,hard,intr,bg,nfsvers=3,rsize=65536,wsize=65536  va-ash-ns01:/u01/patch/BAS


4. Add /etc/host file entries for ns01n and ns04


10.202.90.21            va-ash-ns04.mercurytechnology.com       va-ash-ns04
10.202.90.28            va-ash-ns05.mercurytechnology.com       va-ash-ns05
10.202.90.2             va-ash-ns01n.mercurytechnology.com      va-ash-ns01n
10.202.90.29            va-ash-ns06.mercurytechnology.com       va-ash-ns06
10.202.90.9            va-ash-ad03.mercurytechnology.com       va-ash-ad03


CERU ACLS

Request is to open port 1523 from solapp01,solapp02 -> mrvdb11 

Solapp01 = 10.201.102.52
Solapp02 = 10.202.102.52
Mrvdb11 = 10.201.96.164


CA FWSM1
Access-list mrv_out permit tcp host 10.201.102.52 host 10.201.96.164 eq 1523
Access-list mrv_out permit tcp host 10.202.102.52 host 10.201.96.164 eq 1523

Access-list outside_in permit tcp host 10.201.102.52 host 10.201.96.164 eq 1523
Access-list outside_in permit tcp host 10.202.102.52 host 10.201.96.164 eq 1523

ca-fwsm2
access-list ceru_in permit tcp host 10.201.102.52 host 10.201.96.164 eq 1523

va-fwsm1
access-list ceru_in permit tcp host 10.202.102.52 host 10.201.96.164 eq 1523
 

Edit acl-scripts special-lists

rerun acl-scripts and drop/re-apply ca-va tunnel with new lists


Verify the following have been added:

VA-ASA's

access-list va-custnet-in extended permit tcp host 10.202.102.52 host 10.201.96.164 eq 1523 
access-list vpn-nonat extended permit ip host 10.202.102.52 host 10.201.96.164 
access-list mtg_att_to_ca_vpn3 extended permit ip host 10.202.102.52 host 10.201.96.164 


ca-asa's

access-list vpn-nonat extended permit ip host 10.201.96.164 host 10.202.102.52 
access-list mtg_ca_to_att_vpn3 extended permit ip host 10.201.96.164 host 10.202.102.52


Joe opens a IM window and double clicks on jaynes name, which opens a conversation window with jayne,
Joe types in “Hi Jayne” into the Instant Messenger application, at the application layer,
The Application layer hands the data to the presentation layer, the presentation layer formats the data into a generic format understandable to the other end in this case ASCII and applies any on board generic encyrytion services to the data if required by the application, it is then handed down to the Session layer.
The Session layer initiates the session then separates the data stream from other data streams and hands the data to the Transport layer
The Transport layer determines that the data is TCP in this case and assign’s a source and destination port number destination being a well known port 531 and source port random? between port numbers1024 and 65535, the data is then handed down to the Network layer.
The Network layer then adds the logical addressing looks at the routing table and adds control information depending on how the message is to be routed, the logical address was obtained at the application layer through DNS, the data is encapsulated as a packet and handed to the data link layer for further processing.
The data link layer broadcasts an ARP to find the physical address of the logical ip address and then adds the physical addresses to the packet, the source address being the host that Joe is sitting on and the destination being the default gateway of Joe’s network and an FCS is thrown on the tail of the frame, it is then passed to the physical layer for transmission.
The Physical layer then converts the frame into bytes then the bytes into bits and transmits the none’s and one’s across the physical wire.
The frame arrives at layer 2 of Joe’s default gateway, layer 2 looks at it, and thinks, yep this is for me, it rips off the data link layer control information and hands it to the network layer for processing, the network layer then looks at the destination ip address and checks to see if there are any routes in the routing table for the network that the packet is destined, in this case there are none, but It does know that it has a route to someone who might know, so it leaves the original source and destination logical addresses alone (the logical address never change), it attaches control information to the packet and passes it to the data link layer, the data link layer attaches a source mac of its outgoing interface and a destination mac of the next hop router interface after it ARP’s to find it, and passes it once again through the physical layer as none’s and one’s to the next hop router.
The frame arrives at the next hop router, layer 2 looks at the destination mac and says yes this is mine, rips off the layer 2 information and hands it to layer 3, this time the network layer looks at its routing table and compares the destination ip add to its available routes, it finds that it has a directly connected route for the destination ip, it attaches control information(what interface it is to be transmitted out of) and hands it to layer 2 for processing, layer 2 ARP's for the mac address of the destination host being jayne (jayne is directly connected via crossover), jaynes pc replies to the ARP. Layer 2 then attaches the the source and destination macs and the FCS and forwards to layer 1 for transmission. The data arrives at Jaynes PC all the upper layer header information is actioned and ripped off and "Hi Jayne" appears on Jaynes screen. Whala!
I couldn't be bothered finishing off the rest just in case im on the wrong track.......
Please offer suggestions and corrections as required
Regards
Warren



SSH Public Key Auth for Password-free SSH

home dir for user needs a .ssh dir owned by the user, group users. Permissions are 700
in the .ssh dir add the public key file using 600 permissions (ownership same as above)

[root@sridb02 labels]# ls -la
total 40
drwxr-xr-x 10 root      root   4096 Aug  6 22:48 .
drwxr-xr-x  7 oradev    dbadev 4096 Jul 29 22:43 ..
drwxr-xr-x  2 root      root   4096 May 11  2012 bin
drwxr-xr-x  2 root      root   4096 May 11  2012 dev
drwxr-xr-x  4 root      root   4096 Aug  6 20:03 etc
drwxr-xr-x  2 root      root   4096 May 11  2012 lib
drwxr-xr-x  2 root      root   4096 May 11  2012 lib64
drwx------  2 cipherdev users  4096 Aug  7 05:05 .ssh
drwxr-xr-x  3 root      root   4096 Jul 30 16:45 u01
drwxr-xr-x  6 root      root   4096 May 11  2012 usr
[root@sridb02 labels]# pwd
/u01/dev/labels
[root@sridb02 labels]# cd .ssh
[root@sridb02 .ssh]# ls -la
total 16
drwx------  2 cipherdev users 4096 Aug  7 05:05 .
drwxr-xr-x 10 root      root  4096 Aug  6 22:48 ..
-rw-------  1 cipherdev users  402 Aug  6 21:50 cipher_keys
[root@sridb02 labels]# 


key file name must match the ssh config file (this will create new ssh service running on port 26:


[root@sridb02 .ssh]# more /etc/ssh/sshd_config.cipher 
#       $OpenBSD: sshd_config,v 1.69 2004/05/23 23:59:53 dtucker Exp $

# This is the sshd server system-wide configuration file.  See
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/local/bin:/bin:/usr/bin

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options change a
# default value.

Port 26
#Protocol 2,1
#ListenAddress 0.0.0.0
#ListenAddress ::

# HostKey for protocol version 1
#HostKey /etc/ssh/ssh_host_key
# HostKeys for protocol version 2
#HostKey /etc/ssh/ssh_host_rsa_key
#HostKey /etc/ssh/ssh_host_dsa_key

# Lifetime and size of ephemeral version 1 server key
#KeyRegenerationInterval 1h
#ServerKeyBits 768

# Logging
#obsoletes QuietMode and FascistLogging
#SyslogFacility AUTH
SyslogFacility AUTHPRIV
#LogLevel INFO

# Authentication:

#LoginGraceTime 2m
PermitRootLogin no
#StrictModes yes
#MaxAuthTries 6
AllowUsers cipherprd
#AllowGroups cipher
#DenyUsers mtg bb

RSAAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile      .ssh/cipher_keys

# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
RhostsRSAAuthentication no
# similar for protocol version 2
HostbasedAuthentication no
# Change to yes if you don't trust ~/.ssh/known_hosts for
# RhostsRSAAuthentication and HostbasedAuthentication
IgnoreUserKnownHosts yes
# Don't read the user's ~/.rhosts and ~/.shosts files
IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!
#PasswordAuthentication yes
#PermitEmptyPasswords no
PasswordAuthentication yes

# Change to no to disable s/key passwords
#ChallengeResponseAuthentication yes
ChallengeResponseAuthentication no

# Kerberos options
#KerberosAuthentication no
#KerberosOrLocalPasswd yes
#KerberosTicketCleanup yes
#KerberosGetAFSToken no

# GSSAPI options
#GSSAPIAuthentication no
GSSAPIAuthentication yes
#GSSAPICleanupCredentials yes
GSSAPICleanupCredentials yes

# Set this to 'yes' to enable PAM authentication, account processing, 
# and session processing. If this is enabled, PAM authentication will 
# be allowed through the ChallengeResponseAuthentication mechanism. 
# Depending on your PAM configuration, this may bypass the setting of 
# PasswordAuthentication, PermitEmptyPasswords, and 
# "PermitRootLogin without-password". If you just want the PAM account and 
# session checks to run without PAM authentication, then enable this but set 
# ChallengeResponseAuthentication=no
#UsePAM no
UsePAM yes

AllowTcpForwarding yes
#GatewayPorts no
#X11Forwarding no
X11Forwarding no
#X11DisplayOffset 10
#X11UseLocalhost yes
PrintMotd yes
#PrintLastLog yes
#TCPKeepAlive yes
#UseLogin no
#UsePrivilegeSeparation yes
#PermitUserEnvironment no
#Compression yes
#ClientAliveInterval 0
#ClientAliveCountMax 3
UseDNS no
#PidFile /var/run/sshd.pid
#MaxStartups 10
#ShowPatchLevel no

# no default banner path
#Banner /some/path

# override default of no subsystems
Subsystem       sftp    /usr/libexec/openssh/sftp-server
[root@sridb02 .ssh]#


add to /etc/init.d/sshd startup script:

[root@sridb01 ~]# vi /etc/init.d/sshd

#!/bin/bash
#
# Init file for OpenSSH server daemon
#
# chkconfig: 2345 55 25
# description: OpenSSH server daemon
#
# processname: sshd
# config: /etc/ssh/ssh_host_key
# config: /etc/ssh/ssh_host_key.pub
# config: /etc/ssh/ssh_random_seed
# config: /etc/ssh/sshd_config
# pidfile: /var/run/sshd.pid

# source function library
. /etc/rc.d/init.d/functions

# pull in sysconfig settings
[ -f /etc/sysconfig/sshd ] && . /etc/sysconfig/sshd

RETVAL=0
prog="sshd"

# Some functions to make the below more readable
KEYGEN=/usr/bin/ssh-keygen
SSHD=/usr/sbin/sshd
RSA1_KEY=/etc/ssh/ssh_host_key
RSA_KEY=/etc/ssh/ssh_host_rsa_key
DSA_KEY=/etc/ssh/ssh_host_dsa_key
PID_FILE=/var/run/sshd.pid

do_rsa1_keygen() {
        if [ ! -s $RSA1_KEY ]; then
                echo -n $"Generating SSH1 RSA host key: "
                if $KEYGEN -q -t rsa1 -f $RSA1_KEY -C '' -N '' >&/dev/null; then
                        chmod 600 $RSA1_KEY
                        chmod 644 $RSA1_KEY.pub
                        if [ -x /sbin/restorecon ]; then
                            /sbin/restorecon $RSA1_KEY.pub
                        fi
                        success $"RSA1 key generation"
                        echo
                else
                        failure $"RSA1 key generation"
                        echo
                        exit 1
                fi
        fi
}

do_rsa_keygen() {
        if [ ! -s $RSA_KEY ]; then
                echo -n $"Generating SSH2 RSA host key: "
                if $KEYGEN -q -t rsa -f $RSA_KEY -C '' -N '' >&/dev/null; then
                        chmod 600 $RSA_KEY
                        chmod 644 $RSA_KEY.pub
                        if [ -x /sbin/restorecon ]; then
                            /sbin/restorecon $RSA_KEY.pub
                        fi
                        success $"RSA key generation"
                        echo
                else
                        failure $"RSA key generation"
                        echo
                        exit 1
                fi
        fi
}

do_dsa_keygen() {
        if [ ! -s $DSA_KEY ]; then
                echo -n $"Generating SSH2 DSA host key: "
                if $KEYGEN -q -t dsa -f $DSA_KEY -C '' -N '' >&/dev/null; then
                        chmod 600 $DSA_KEY
                        chmod 644 $DSA_KEY.pub
                        if [ -x /sbin/restorecon ]; then
                            /sbin/restorecon $DSA_KEY.pub
                        fi
                        success $"DSA key generation"
                        echo
                else
                        failure $"DSA key generation"
                        echo
                        exit 1
                fi
        fi
}

do_restart_sanity_check()
{
        $SSHD -t
        RETVAL=$?
        if [ ! "$RETVAL" = 0 ]; then
                failure $"Configuration file or keys are invalid"
                echo
        fi
}

start()
{
        # Create keys if necessary
        do_rsa1_keygen
        do_rsa_keygen
        do_dsa_keygen
        cp -af /etc/localtime /var/empty/sshd/etc

        echo -n $"Starting $prog:"
        $SSHD $OPTIONS && success || failure
        RETVAL=$?
        [ "$RETVAL" = 0 ] && touch /var/lock/subsys/sshd
        echo

        echo -n $"Starting MTG $prog:"
        $SSHD $OPTIONS -f /etc/ssh/sshd_config.mtg && success || failure
        RETVAL=$?
        [ "$RETVAL" = 0 ] && touch /var/lock/subsys/sshd_mtg
        echo

        echo -n $"Starting SOL $prog:"
        $SSHD $OPTIONS -f /etc/ssh/sshd_config.sol && success || failure
        RETVAL=$?
        [ "$RETVAL" = 0 ] && touch /var/lock/subsys/sshd_sol
        echo

        echo -n $"Starting CIPHER $prog:"
        $SSHD $OPTIONS -f /etc/ssh/sshd_config.cipher && success || failure
        RETVAL=$?
        [ "$RETVAL" = 0 ] && touch /var/lock/subsys/sshd_cipher
        echo
}

stop()
{
        echo -n $"Stopping $prog:"
        if [ -n "`pidfileofproc $SSHD`" ] ; then
            killproc $SSHD -TERM
        else
            failure $"Stopping $prog"
        fi
        RETVAL=$?
        [ "$RETVAL" = 0 ] && rm -f /var/lock/subsys/sshd
        echo

        echo -n $"Stopping MTG $prog:"
        if [ -n "/var/lock/subsys/sshd_mtg" ] ; then
            killproc sshd_mtg -TERM
        else
            failure $"Stopping MTG $prog"
        fi
        RETVAL=$?
        [ "$RETVAL" = 0 ] && rm -f /var/lock/subsys/sshd_mtg
        echo

        echo -n $"Stopping SOL $prog:"
        if [ -n "/var/lock/subsys/sshd_sol" ] ; then
            killproc sshd_sol -TERM
        else
            failure $"Stopping SOL $prog"
        fi
        RETVAL=$?
        [ "$RETVAL" = 0 ] && rm -f /var/lock/subsys/sshd_sol
        echo
}

reload()
{
        echo -n $"Reloading $prog:"
        if [ -n "`pidfileofproc $SSHD`" ] ; then
            killproc $SSHD -HUP
        else
            failure $"Reloading $prog"
        fi
        RETVAL=$?
        echo
}

case "$1" in
        start)
                start
                ;;
        stop)
                stop
                ;;
        restart)
                stop
                start
                ;;
        reload)
                reload
                ;;
        condrestart)
                if [ -f /var/lock/subsys/sshd ] ; then
                        do_restart_sanity_check
                        if [ "$RETVAL" = 0 ] ; then
                                stop
                                # avoid race
                                sleep 3
                                start
                        fi
                fi
                ;;
        status)
                status $SSHD
                RETVAL=$?
                ;;
        *)
                echo $"Usage: $0 {start|stop|restart|reload|condrestart|status}"
                RETVAL=1
esac
exit $RETVAL



Route Tracking

ip sla monitor 3

 type echo protocol ipIcmpEcho 192.168.192.61
 vrf BTS
ip sla monitor schedule 3 life forever start-time now

!
track 3 rtr 3 reachability

ip route vrf BTS 0.0.0.0 0.0.0.0 192.168.192.65
ip route vrf BTS 192.168.100.0 255.255.255.0 192.168.192.61 track 3





Server Load Balancing on 6509 VSS

ip slb serverfarm SRI_VA_8000
 nat server
 real 10.202.103.101
  inservice

 real 10.202.103.98
  inservice

ip slb vserver VT_SRI_VA_8000
 virtual 10.202.103.105 tcp 8000
 serverfarm SRI_VA_8000
 inservice

Another example:

va-ash-att-vss01:

ip slb probe SRI_APP tcp
 port 8000
!
ip slb serverfarm SRI_APP_PROD
 nat server
 probe SRI_APP
 !
 real 10.202.103.98
  inservice
 !
 real 10.202.103.101
  inservice
!
ip slb vserver VT_SRI_APP_PROD
 virtual 10.202.103.105 tcp 0
 serverfarm SRI_APP_PROD
 no advertise
 inservice


On 6509RTR

ip slb probe SRI_APP tcp
 port 8000
!
ip slb serverfarm SRI_APP_PROD
 nat server
 probe SRI_APP
 access Port-channel16
 !
 real 10.202.103.98
  inservice
 !
 real 10.202.103.101
  inservice
!
ip slb vserver VT_SRI_APP_PROD
 virtual 10.202.103.105 tcp 0
 serverfarm SRI_APP_PROD
 access Port-channel16
 inservice



QoS on Cisco ASA

priority-queue outside
class-map VOIP-TRAFFIC
 match dscp ef
policy-map QOS-TRAFFIC-OUT
 class VOIP-TRAFFIC
 priority
service-policy QOS-TRAFFIC-OUT interface outside



Proxy Access
CA-SNA-SSL02
VA-ASH-SSL02

Type vp - alias

Shift G - goes to the end of page
cw - change word

TYpe kp	- kill process

Type sp - start process


























